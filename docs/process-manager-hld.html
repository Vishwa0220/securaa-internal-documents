<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Manager - High Level Design - Zona Platform Documentation</title>
    <link rel="stylesheet" href="assets/css/documentation.css">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header class="main-header">
        <h1>Zona Platform Documentation</h1>
        <p>Comprehensive documentation for Zona security platform services</p>
    </header>
    <nav class="documentation-nav">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="securaa-playbook-hld.html">Zona Playbook HLD</a></li>
            <li><a href="securaa-playbook-lld.html">Zona Playbook LLD</a></li>
            <li><a href="optimization-guide.html">Optimization Guide</a></li>
            <li><a href="securaa-siem-hld.html">Zona SIEM HLD</a></li>
            <li><a href="securaa-hld.html">Securaa Platform</a></li>
            <li><a href="process-manager-hld.html">Process Manager HLD</a></li>
            <li><a href="process-manager-lld.html">Process Manager LLD</a></li>
            <li><a href="zona-user-hld.html">Zona User HLD</a></li>
            <li><a href="zona-user-lld.html">Zona User LLD</a></li>
        </ul>
    </nav>
    <main class="main-content">
        <h1>Process Manager - High Level Design Document</h1>
        <h2 id="overview">1. Overview</h2>
        <h3>Purpose & Objectives</h3>
        <ul>
            <li><strong>zona_process_manager</strong> orchestrates and manages the lifecycle of microservices and integrations in the Zona platform.</li>
            <li>Automates deployment, scaling, and health management of services using Docker and MongoDB.</li>
            <li>Dynamically configures integrations for multi-tenant environments.</li>
        </ul>
        <h3>Architecture Pattern</h3>
        <ul>
            <li><strong>Layered Modular Architecture</strong></li>
            <li>Separation of concerns: main orchestration, configuration/state, service management, integration logic.</li>
            <li>Microservices managed as Docker containers.</li>
        </ul>
        <h3>Technology Stack</h3>
        <ul>
            <li><strong>Language:</strong> Go</li>
            <li><strong>Containerization:</strong> Docker</li>
            <li><strong>Database:</strong> MongoDB</li>
            <li><strong>Logging/Config:</strong> securaa_lib (shared library)</li>
            <li><strong>Other:</strong> Makefile for build/run automation</li>
        </ul>
        <h2 id="system-architecture">2. System Architecture</h2>
        <h3>2.1 High-Level Architecture</h3>
        <div class="mermaid">
flowchart TD
    A[main.go\nOrchestrator] --> B[common/\nGlobal State]
    A --> C[models/\nBusiness Logic & Integrations]
    A --> D[docker/\nService Management]
    C --> E[integrations.go]
    C --> F[models.go]
    D --> G[docker_functions.go]
    B --> H[globals.go]
    A --> I[securaa_lib\nExternal Libs]
    A --> J[MongoDB]
    D --> K[Docker Engine]
        </div>
        <h3>2.2 Component Interaction Diagram</h3>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Main
    participant Common
    participant Docker
    participant Models
    participant MongoDB
    User->>Main: CLI command (start/stop/restart)
    Main->>Common: Load config, set global state
    Main->>Docker: Create/cleanup services
    Main->>Models: Fetch integrations, resolve ports
    Models->>MongoDB: Query tenant/integration data
    Docker-->>Main: Service status
    Models-->>Main: Integration data
    Main->>User: Status/result
        </div>
        <h3>2.3 Data Flow Diagram</h3>
        <div class="mermaid">
flowchart LR
    UserRequest[User Request]
    MainApp[main.go]
    Config[common/globals.go]
    DockerMgmt[docker/docker_functions.go]
    ModelsLogic[models/models.go & integrations.go]
    MongoDB[(MongoDB)]
    DockerEngine[(Docker Engine)]
    Response[Response]

    UserRequest --> MainApp
    MainApp --> Config
    MainApp --> DockerMgmt
    MainApp --> ModelsLogic
    ModelsLogic --> MongoDB
    DockerMgmt --> DockerEngine
    DockerMgmt --> ModelsLogic
    MainApp --> Response
        </div>
        <h2>3. Component Analysis</h2>
        <h3>Major Modules/Components</h3>
        <h4>main.go (Orchestrator)</h4>
        <ul>
            <li><strong>Purpose:</strong> Entry point, parses commands, coordinates deployment, restart, and cleanup.</li>
            <li><strong>Responsibilities:</strong>
                <ul>
                    <li>Loads configuration</li>
                    <li>Initializes global state</li>
                    <li>Orchestrates Docker and integration logic</li>
                    <li>Handles patch-based restarts</li>
                </ul>
            </li>
        </ul>
        <h4>common/ (Global State & Utilities)</h4>
        <ul>
            <li><strong>Purpose:</strong> Shared state, configuration, and utility functions.</li>
            <li><strong>Responsibilities:</strong>
                <ul>
                    <li>Holds service maps (system, core, batch, app)</li>
                    <li>Manages DB sessions and integration lists</li>
                    <li>Provides server role detection and feature toggles</li>
                </ul>
            </li>
        </ul>
        <h4>docker/ (Service Management)</h4>
        <ul>
            <li><strong>Purpose:</strong> Docker orchestration and lifecycle management.</li>
            <li><strong>Responsibilities:</strong>
                <ul>
                    <li>Initializes service contexts</li>
                    <li>Verifies/creates Docker volumes</li>
                    <li>Creates/updates Docker services and replicas</li>
                    <li>Manages Zookeeper/Kafka for event streaming</li>
                </ul>
            </li>
        </ul>
        <h4>models/ (Business Logic & Integrations)</h4>
        <ul>
            <li><strong>Purpose:</strong> Data models and integration logic.</li>
            <li><strong>Responsibilities:</strong>
                <ul>
                    <li>Defines tenant, integration, and session structures</li>
                    <li>Fetches active integrations per tenant</li>
                    <li>Resolves ports and parameters for services</li>
                </ul>
            </li>
        </ul>
        <h3>Inter-Component Relationships</h3>
        <ul>
            <li><code>main.go</code> coordinates all modules</li>
            <li><code>common/</code> provides shared state to all</li>
            <li><code>docker/</code> and <code>models/</code> interact via service contexts and integration data</li>
            <li>All modules use shared config and session objects</li>
        </ul>
        <h2>4. External Integrations</h2>
        <h3>Third-Party Services & APIs</h3>
        <ul>
            <li><strong>Docker Engine:</strong> Container orchestration</li>
            <li><strong>MongoDB:</strong> Tenant/integration data storage</li>
            <li><strong>securaa_lib:</strong> Logging, config, Docker, MongoDB, utilities</li>
        </ul>
        <h3>Database Systems</h3>
        <ul>
            <li><strong>MongoDB:</strong> Used for storing tenant, integration, and system data</li>
        </ul>
        <h3>External Dependencies</h3>
        <ul>
            <li><strong>Go Modules:</strong> Dependency management</li>
            <li><strong>Makefile:</strong> Build/run automation</li>
        </ul>
        <h2>5. High-Level Data Flow</h2>
        <h3>User Request Processing Flow</h3>
        <ol>
            <li>User issues a CLI command (<code>start</code>, <code>stop</code>, <code>restart</code>).</li>
            <li><code>main.go</code> parses the command and loads configuration.</li>
            <li>Global state is initialized in <code>common/</code>.</li>
            <li>Docker services are created/cleaned up via <code>docker/</code>.</li>
            <li>Integrations are fetched and configured via <code>models/</code>.</li>
            <li>MongoDB is queried for tenant/integration data.</li>
            <li>Services are deployed as Docker containers.</li>
            <li>Status/result is returned to the user.</li>
        </ol>
        <h3>Business Logic Execution Flow</h3>
        <ul>
            <li>Integrations are dynamically resolved per tenant.</li>
            <li>Service contexts are updated based on integration and config data.</li>
            <li>Docker services are orchestrated for each required component.</li>
        </ul>
        <h3>Response Generation Flow</h3>
        <ul>
            <li>Service status and integration results are aggregated in <code>main.go</code>.</li>
            <li>Final status/result is output to the user (CLI or API).</li>
        </ul>
        <h2>Summary</h2>
        <p>This HLD provides a comprehensive overview of the zona_process_manager system, its architecture, major components, external integrations, and high-level data flows. The modular, layered design enables extensibility and robust orchestration of microservices and integrations in a multi-tenant environment.</p>
    </main>
</body>
</html>
