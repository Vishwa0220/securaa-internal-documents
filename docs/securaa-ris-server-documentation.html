<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Securaa RIS Server Documentation">
    <title>Securaa RIS Server Documentation - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 18, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="ris-server-documentation">RIS Server Documentation</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#installation--setup">Installation &amp; Setup</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#api-reference">API Reference</a></li>
<li><a href="#client-management">Client Management</a></li>
<li><a href="#task-orchestration">Task Orchestration</a></li>
<li><a href="#multi-tenant-architecture">Multi-Tenant Architecture</a></li>
<li><a href="#security-framework">Security Framework</a></li>
<li><a href="#database-management">Database Management</a></li>
<li><a href="#monitoring--observability">Monitoring &amp; Observability</a></li>
<li><a href="#deployment-strategies">Deployment Strategies</a></li>
<li><a href="#performance--scaling">Performance &amp; Scaling</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#administration-guide">Administration Guide</a></li>
</ol>
<h2 id="overview">Overview</h2>
<p>The RIS (Remote Integrated Services) Server is the central command and control hub for the distributed RIS ecosystem. It provides unified management, orchestration, and monitoring capabilities for multiple remote RIS clients across different environments. The server implements a sophisticated hub-and-spoke architecture with enterprise-grade security, scalability, and reliability features.</p>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>Centralized Management</strong>: Unified control plane for all remote RIS clients</li>
<li><strong>Real-time Communication</strong>: WebSocket-based persistent connections with clients</li>
<li><strong>Multi-Tenant Support</strong>: Complete tenant isolation with secure data separation</li>
<li><strong>Task Orchestration</strong>: Intelligent task routing and execution across clients</li>
<li><strong>High Availability</strong>: Clustered deployment with automatic failover</li>
<li><strong>Security</strong>: End-to-end encryption, authentication, and comprehensive audit logging</li>
<li><strong>Scalability</strong>: Horizontal scaling supporting 1000+ concurrent client connections</li>
<li><strong>Monitoring</strong>: Real-time monitoring, metrics collection, and alerting</li>
</ul>
<h3 id="system-requirements">System Requirements</h3>
<h4 id="minimum-requirements">Minimum Requirements</h4>
<ul>
<li><strong>Operating System</strong>: Linux (Ubuntu 20.04+, CentOS 8+, RHEL 8+)</li>
<li><strong>CPU</strong>: 2 vCores</li>
<li><strong>Memory</strong>: 4 GB RAM</li>
<li><strong>Storage</strong>: 20 GB SSD</li>
<li><strong>Network</strong>: High-speed internet with static IP</li>
</ul>
<h4 id="recommended-requirements">Recommended Requirements</h4>
<ul>
<li><strong>Operating System</strong>: Linux (Ubuntu 22.04+, CentOS 9+, RHEL 9+)</li>
<li><strong>CPU</strong>: 8 vCores</li>
<li><strong>Memory</strong>: 16 GB RAM</li>
<li><strong>Storage</strong>: 100 GB SSD NVMe</li>
<li><strong>Network</strong>: Dedicated network with load balancer</li>
</ul>
<h4 id="dependencies">Dependencies</h4>
<ul>
<li><strong>MongoDB</strong>: Version 6.0+ (Primary database)</li>
<li><strong>Redis</strong>: Version 7.0+ (Caching and session management)</li>
<li><strong>Docker</strong>: Version 20.10+ (Containerization)</li>
<li><strong>Go Runtime</strong>: Version 1.19+ (for development)</li>
<li><strong>TLS Certificates</strong>: Valid certificates for HTTPS/WSS</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="high-level-architecture">High-Level Architecture</h3>
<div class="mermaid">
graph TB
    subgraph "Load Balancer Tier"
        LB[Load Balancer<br/>NGINX/HAProxy]
        WAF[Web Application Firewall]
    end

    subgraph "RIS Server Cluster"
        RS1[RIS Server 1<br/>Primary]
        RS2[RIS Server 2<br/>Secondary]
        RS3[RIS Server 3<br/>Backup]
    end

    subgraph "Data Layer"
        subgraph "MongoDB Cluster"
            MDB1[(MongoDB Primary)]
            MDB2[(MongoDB Secondary)]
            MDB3[(MongoDB Arbiter)]
        end

        subgraph "Cache Layer"
            REDIS1[Redis Master]
            REDIS2[Redis Replica]
        end
    end

    subgraph "Monitoring Stack"
        PROM[Prometheus]
        GRAF[Grafana]
        ALERT[AlertManager]
        ELK[ELK Stack]
    end

    subgraph "RIS Clients"
        RC1[RIS Client 1]
        RC2[RIS Client 2]
        RCN[RIS Client N]
    end

    subgraph "External Systems"
        EXT[External APIs]
        LDAP[LDAP/AD]
        SMTP[SMTP Server]
    end

    %% Traffic flow
    WAF --> LB
    LB --> RS1
    LB --> RS2
    LB --> RS3

    %% Database connections
    RS1 --> MDB1
    RS2 --> MDB1
    RS3 --> MDB1
    MDB1 -.-> MDB2
    MDB2 -.-> MDB3

    %% Cache connections
    RS1 --> REDIS1
    RS2 --> REDIS1
    RS3 --> REDIS1
    REDIS1 -.-> REDIS2

    %% WebSocket connections
    RS1 -.->|WSS| RC1
    RS2 -.->|WSS| RC2
    RS3 -.->|WSS| RCN

    %% Monitoring
    RS1 --> PROM
    RS2 --> PROM
    RS3 --> PROM
    PROM --> GRAF
    PROM --> ALERT

    %% External integrations
    RS1 -.-> EXT
    RS1 -.-> LDAP
    RS1 -.-> SMTP

    style LB fill:#e1bee7
    style RS1 fill:#e8f5e8
    style MDB1 fill:#fff9c4
    style REDIS1 fill:#ffcdd2
    style RC1 fill:#e3f2fd
</div>

<h3 id="component-architecture">Component Architecture</h3>
<div class="mermaid">
graph TB
    subgraph "RIS Server Core"
        subgraph "API Layer"
            REST[REST API Gateway]
            WS[WebSocket Gateway]
            MW[Middleware Stack]
        end

        subgraph "Business Logic"
            RC[RIS Controller]
            TC[Tenant Controller]
            ORCH[Task Orchestrator]
            CM[Client Manager]
        end

        subgraph "Data Access"
            MDA[MongoDB Adapter]
            RDA[Redis Adapter]
            CACHE[Cache Manager]
        end

        subgraph "Infrastructure"
            AUTH[Auth Service]
            LOG[Logging Service]
            METRICS[Metrics Service]
            CONFIG[Config Manager]
        end
    end

    REST --> MW
    WS --> MW
    MW --> RC
    MW --> TC
    RC --> ORCH
    RC --> CM

    ORCH --> MDA
    CM --> MDA
    ORCH --> RDA
    CM --> CACHE

    MW --> AUTH
    RC --> LOG
    ORCH --> METRICS

    style REST fill:#e8f5e8
    style WS fill:#fff3e0
    style ORCH fill:#e1bee7
    style AUTH fill:#ffcdd2
</div>

<h3 id="detailed-component-design">Detailed Component Design</h3>
<h4 id="1-api-gateway-layer">1. API Gateway Layer</h4>
<ul>
<li><strong>REST API Gateway</strong>: HTTP/HTTPS endpoint management</li>
<li><strong>WebSocket Gateway</strong>: Real-time client communication</li>
<li><strong>Middleware Stack</strong>: Authentication, authorization, logging, rate limiting</li>
<li><strong>Request Router</strong>: Intelligent request routing and load balancing</li>
</ul>
<h4 id="2-business-logic-layer">2. Business Logic Layer</h4>
<ul>
<li><strong>RIS Controller</strong>: Client lifecycle and status management</li>
<li><strong>Tenant Controller</strong>: Multi-tenant data and operation isolation</li>
<li><strong>Task Orchestrator</strong>: Task routing, execution, and monitoring</li>
<li><strong>Client Manager</strong>: Connection management and health monitoring</li>
</ul>
<h4 id="3-data-management-layer">3. Data Management Layer</h4>
<ul>
<li><strong>MongoDB Integration</strong>: Primary data persistence</li>
<li><strong>Redis Integration</strong>: Caching and session management</li>
<li><strong>Cache Manager</strong>: Intelligent caching strategies</li>
<li><strong>Data Access Objects</strong>: Abstracted data access patterns</li>
</ul>
<h2 id="installation-setup">Installation &amp; Setup</h2>
<h3 id="docker-deployment-recommended">Docker Deployment (Recommended)</h3>
<h4 id="docker-compose-configuration">Docker Compose Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ris-server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">securaa/ris-server:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8057:8057&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span><span class="w">  </span><span class="c1"># Metrics</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RIS_ENV=production</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGODB_URI=mongodb://mongo1:27017,mongo2:27017,mongo3:27017/ris?replicaSet=rs0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URI=redis://redis-master:6379</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TLS_CERT_FILE=/app/certs/server.crt</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TLS_KEY_FILE=/app/certs/server.key</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./certs:/app/certs</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-network</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis</span>
<span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
<span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;https://localhost:8057/health&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">      </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>

<span class="w">  </span><span class="nt">mongodb</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo:6.0</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-mongo</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;27017:27017&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME=admin</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD=secure-password</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_DATABASE=ris</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongodb_data:/data/db</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./mongo-init:/docker-entrypoint-initdb.d</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-network</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongod --replSet rs0 --bind_ip_all</span>

<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7.0-alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-redis</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6379:6379&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_PASSWORD=secure-redis-password</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./redis.conf:/usr/local/etc/redis/redis.conf</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-network</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis-server /usr/local/etc/redis/redis.conf</span>

<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-nginx</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:443&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx.conf:/etc/nginx/nginx.conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./certs:/etc/nginx/certs</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-network</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ris-network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mongodb_data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
</code></pre></div>

<h4 id="production-environment-setup">Production Environment Setup</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Create directory structure</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>ris-server/<span class="o">{</span>config,certs,logs,data<span class="o">}</span>
<span class="nb">cd</span><span class="w"> </span>ris-server

<span class="c1"># Download configuration templates</span>
curl<span class="w"> </span>-O<span class="w"> </span>https://raw.githubusercontent.com/securaa/ris-server/main/deployments/docker/docker-compose.yml
curl<span class="w"> </span>-O<span class="w"> </span>https://raw.githubusercontent.com/securaa/ris-server/main/deployments/docker/nginx.conf

<span class="c1"># Generate TLS certificates</span>
openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-newkey<span class="w"> </span>rsa:4096<span class="w"> </span>-keyout<span class="w"> </span>certs/server.key<span class="w"> </span>-out<span class="w"> </span>certs/server.crt<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-nodes

<span class="c1"># Initialize MongoDB replica set</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>mongodb<span class="w"> </span>mongo<span class="w"> </span>--eval<span class="w"> </span><span class="s2">&quot;rs.initiate()&quot;</span>

<span class="c1"># Start services</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># Verify installation</span>
curl<span class="w"> </span>-k<span class="w"> </span>https://localhost:8057/health
</code></pre></div>

<h3 id="kubernetes-deployment">Kubernetes Deployment</h3>
<h4 id="namespace-and-configmap">Namespace and ConfigMap</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># namespace.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>

<span class="nn">---</span>
<span class="c1"># configmap.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config.json</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">      </span><span class="no">&quot;server&quot;: {</span>
<span class="w">        </span><span class="no">&quot;host&quot;: &quot;0.0.0.0&quot;,</span>
<span class="w">        </span><span class="no">&quot;port&quot;: 8057,</span>
<span class="w">        </span><span class="no">&quot;tls_enabled&quot;: true,</span>
<span class="w">        </span><span class="no">&quot;cert_file&quot;: &quot;/app/certs/tls.crt&quot;,</span>
<span class="w">        </span><span class="no">&quot;key_file&quot;: &quot;/app/certs/tls.key&quot;</span>
<span class="w">      </span><span class="no">},</span>
<span class="w">      </span><span class="no">&quot;database&quot;: {</span>
<span class="w">        </span><span class="no">&quot;mongodb_uri&quot;: &quot;mongodb://ris-mongodb:27017/ris&quot;,</span>
<span class="w">        </span><span class="no">&quot;redis_uri&quot;: &quot;redis://ris-redis:6379&quot;</span>
<span class="w">      </span><span class="no">},</span>
<span class="w">      </span><span class="no">&quot;logging&quot;: {</span>
<span class="w">        </span><span class="no">&quot;level&quot;: &quot;info&quot;,</span>
<span class="w">        </span><span class="no">&quot;format&quot;: &quot;json&quot;</span>
<span class="w">      </span><span class="no">}</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>

<h4 id="deployment-and-service">Deployment and Service</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># deployment.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">securaa/ris-server:latest</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CONFIG_PATH</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/app/config/config.json&quot;</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/config</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certs</span>
<span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/certs</span>
<span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
<span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/ready</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
<span class="w">            </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;512Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;250m&quot;</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000m&quot;</span>
<span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<span class="w">        </span><span class="nt">configMap</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">certs</span>
<span class="w">        </span><span class="nt">secret</span><span class="p">:</span>
<span class="w">          </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-tls</span>

<span class="nn">---</span>
<span class="c1"># service.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-service</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>

<span class="nn">---</span>
<span class="c1"># ingress.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-ingress</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-system</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-passthrough</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPS&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server.example.com</span>
<span class="w">    </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-tls</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server.example.com</span>
<span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ris-server-service</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span>
<span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8057</span>
</code></pre></div>

<h3 id="binary-installation">Binary Installation</h3>
<h4 id="system-setup">System Setup</h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Create system user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-s<span class="w"> </span>/bin/false<span class="w"> </span>ris-server
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/ris-server/<span class="o">{</span>bin,config,logs,data<span class="o">}</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/ris-server
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>ris-server:ris-server<span class="w"> </span>/opt/ris-server<span class="w"> </span>/etc/ris-server

<span class="c1"># Download and install binary</span>
wget<span class="w"> </span>https://github.com/securaa/ris-server/releases/latest/download/ris-server-linux-amd64.tar.gz
tar<span class="w"> </span>-xzf<span class="w"> </span>ris-server-linux-amd64.tar.gz
sudo<span class="w"> </span>mv<span class="w"> </span>ris-server<span class="w"> </span>/opt/ris-server/bin/
sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/opt/ris-server/bin/ris-server
</code></pre></div>

<h4 id="systemd-service">Systemd Service</h4>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/systemd/system/ris-server.service<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">[Unit]</span>
<span class="s">Description=RIS Server</span>
<span class="s">After=network.target mongodb.service redis.service</span>
<span class="s">Wants=network.target</span>
<span class="s">Requires=mongodb.service redis.service</span>

<span class="s">[Service]</span>
<span class="s">Type=simple</span>
<span class="s">User=ris-server</span>
<span class="s">Group=ris-server</span>
<span class="s">ExecStart=/opt/ris-server/bin/ris-server</span>
<span class="s">Restart=always</span>
<span class="s">RestartSec=10</span>
<span class="s">Environment=CONFIG_PATH=/etc/ris-server/config.json</span>
<span class="s">WorkingDirectory=/opt/ris-server</span>
<span class="s">StandardOutput=journal</span>
<span class="s">StandardError=journal</span>
<span class="s">SyslogIdentifier=ris-server</span>

<span class="s"># Security settings</span>
<span class="s">NoNewPrivileges=yes</span>
<span class="s">ProtectSystem=strict</span>
<span class="s">ProtectHome=yes</span>
<span class="s">ReadWritePaths=/opt/ris-server/logs /opt/ris-server/data</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

<span class="c1"># Enable and start service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ris-server
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>ris-server
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>ris-server
</code></pre></div>

<h2 id="configuration">Configuration</h2>
<h3 id="master-configuration-file">Master Configuration File</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8057</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;cert_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/certs/server.crt&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;key_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/certs/server.key&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ca_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/certs/ca.crt&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;min_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;cipher_suites&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;TLS_AES_256_GCM_SHA384&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;TLS_CHACHA20_POLY1305_SHA256&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;TLS_AES_128_GCM_SHA256&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;client_auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;require&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;timeouts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;idle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;120s&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;cors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;allowed_origins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://admin.example.com&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;allowed_methods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DELETE&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;allowed_headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mongodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mongodb://username:password@localhost:27017/ris?replicaSet=rs0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ris&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_pool_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;min_pool_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_idle_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10m&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connection_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;socket_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;server_selection_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5s&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;redis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redis://localhost:6379&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secure-password&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_retries&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;pool_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;min_idle_conns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;idle_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5m&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;dial_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;read_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;write_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3s&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;authentication&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;jwt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;secret&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-jwt-secret-key&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;expiry&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;refresh_expiry&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;168h&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;issuer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ris-server&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;algorithm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HS256&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;session&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8h&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;renewal_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1h&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_concurrent&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;ldap&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ldap://ldap.example.com:389&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;base_dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ou=users,dc=example,dc=com&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;bind_dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cn=admin,dc=example,dc=com&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;bind_password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin-password&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;user_filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;(uid=%s)&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;group_filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;(member=%s)&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;authorization&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;rbac&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;default_role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;readonly&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;admin_users&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;admin@example.com&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;super_admin_users&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;superadmin@example.com&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;multi_tenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;default_tenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tenant_isolation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;database&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;auto_provision&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;task_orchestration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_concurrent_tasks&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;task_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300s&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;retry_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;max_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;backoff_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exponential&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;initial_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60s&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;queue&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;priority_levels&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;dead_letter_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;client_management&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;max_clients&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;heartbeat_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30s&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;connection_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60s&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;reconnection_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;max_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;backoff_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exponential&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;initial_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_delay&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300s&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;security&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;rate_limiting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;requests_per_minute&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;burst_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ip_whitelist&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;172.16.0.0/12&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;192.168.0.0/16&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;audit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;events&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;authentication&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;task_execution&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;client_management&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;retention_days&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;encryption&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;data_at_rest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;algorithm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AES-256-GCM&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;key_rotation_days&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;data_in_transit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;min_tls_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.2&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;monitoring&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9090</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/metrics&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;15s&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;health_check&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/health&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;detailed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;alerting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;webhook_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://alerts.example.com/webhook&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;thresholds&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;cpu_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;memory_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;error_rate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;response_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stdout&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/logs/ris-server.log&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;100MB&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_backups&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;compress&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;audit_log&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/logs/audit.log&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;100MB&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_backups&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">365</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;performance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;cache&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;ttl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1h&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;max_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;500MB&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;eviction_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lru&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;connection_pooling&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;max_connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;idle_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;keep_alive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;graceful_shutdown&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30s&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;drain_timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;60s&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;websocket_compression&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;http2_enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;debug_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;development_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;auto_backup&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;telemetry&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="environment-specific-configurations">Environment-Specific Configurations</h3>
<h4 id="development-configuration">Development Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8057</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mongodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mongodb://localhost:27017/ris_dev&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;redis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redis://localhost:6379&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stdout&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;debug_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;development_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="production-configuration">Production Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8057</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;cert_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/certs/server.crt&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;key_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/app/certs/server.key&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;client_auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;require&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mongodb&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mongodb://username:password@mongo1:27017,mongo2:27017,mongo3:27017/ris?replicaSet=rs0&amp;ssl=true&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;redis&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;redis://redis-cluster:6379&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secure-redis-password&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;pool_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;logging&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;security&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;rate_limiting&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;requests_per_minute&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;audit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;retention_days&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">365</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;debug_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;development_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;telemetry&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="environment-variables">Environment Variables</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RIS_ENV</code></td>
<td>Environment (dev/staging/prod)</td>
<td><code>development</code></td>
</tr>
<tr>
<td><code>CONFIG_PATH</code></td>
<td>Configuration file path</td>
<td><code>/app/config/config.json</code></td>
</tr>
<tr>
<td><code>MONGODB_URI</code></td>
<td>MongoDB connection string</td>
<td><code>mongodb://localhost:27017/ris</code></td>
</tr>
<tr>
<td><code>REDIS_URI</code></td>
<td>Redis connection string</td>
<td><code>redis://localhost:6379</code></td>
</tr>
<tr>
<td><code>TLS_CERT_FILE</code></td>
<td>TLS certificate file path</td>
<td><code>/app/certs/server.crt</code></td>
</tr>
<tr>
<td><code>TLS_KEY_FILE</code></td>
<td>TLS private key file path</td>
<td><code>/app/certs/server.key</code></td>
</tr>
<tr>
<td><code>JWT_SECRET</code></td>
<td>JWT signing secret</td>
<td>Generated</td>
</tr>
<tr>
<td><code>LOG_LEVEL</code></td>
<td>Logging level</td>
<td><code>info</code></td>
</tr>
<tr>
<td><code>METRICS_PORT</code></td>
<td>Metrics server port</td>
<td><code>9090</code></td>
</tr>
</tbody>
</table>
<h2 id="api-reference">API Reference</h2>
<h3 id="authentication">Authentication</h3>
<h4 id="jwt-token-authentication">JWT Token Authentication</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /auth/login</span>
<span class="err">Content-Type: application/json</span>

<span class="err">{</span>
<span class="err">  &quot;username&quot;: &quot;admin@example.com&quot;,</span>
<span class="err">  &quot;password&quot;: &quot;secure-password&quot;,</span>
<span class="err">  &quot;tenant_code&quot;: &quot;default&quot;</span>
<span class="err">}</span>
</code></pre></div>

<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;access_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;refresh_token&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;expires_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;token_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;tenant_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="token-refresh">Token Refresh</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /auth/refresh</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;refresh_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
<span class="err">}</span>
</code></pre></div>

<h3 id="ris-client-management">RIS Client Management</h3>
<h4 id="get-all-ris-clients">Get All RIS Clients</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/ris</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;client-001&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production client&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connection_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;connected&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;unique_client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid-string&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;tenant_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;created_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1696752000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;updated_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1696752000000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;last_seen&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-07T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;task_execution&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;service_management&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;per_page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="add-new-ris-client">Add New RIS Client</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /platform/v1/ris</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;name&quot;: &quot;client-002&quot;,</span>
<span class="err">  &quot;description&quot;: &quot;Development client&quot;,</span>
<span class="err">  &quot;host&quot;: &quot;192.168.1.101&quot;,</span>
<span class="err">  &quot;tenant_code&quot;: &quot;dev&quot;</span>
<span class="err">}</span>
</code></pre></div>

<h4 id="update-ris-client">Update RIS Client</h4>
<div class="highlight"><pre><span></span><code><span class="err">PUT /platform/v1/ris</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;id&quot;: 1,</span>
<span class="err">  &quot;name&quot;: &quot;client-001-updated&quot;,</span>
<span class="err">  &quot;description&quot;: &quot;Updated production client&quot;,</span>
<span class="err">  &quot;status&quot;: &quot;active&quot;</span>
<span class="err">}</span>
</code></pre></div>

<h4 id="delete-ris-client">Delete RIS Client</h4>
<div class="highlight"><pre><span></span><code><span class="err">DELETE /platform/v1/ris</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;id&quot;: 1</span>
<span class="err">}</span>
</code></pre></div>

<h4 id="get-client-configuration">Get Client Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/risclient/{client-id}/{hostname}</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;client_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;server_host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://ris-server.example.com:8057&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;websocket_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/pingpong&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;heartbeat_interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reconnect_policy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;max_attempts&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;backoff_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;exponential&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;certificates&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;client_cert&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-----BEGIN CERTIFICATE-----\n...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;client_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-----BEGIN PRIVATE KEY-----\n...&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;ca_cert&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-----BEGIN CERTIFICATE-----\n...&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;tenant_info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;tenant_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;tenant_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Default Tenant&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;database_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tenant-db.example.com&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tenant_default&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="task-management">Task Management</h3>
<h4 id="execute-task-on-client">Execute Task on Client</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /platform/v1/task/execute</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;client_id&quot;: &quot;uuid-string&quot;,</span>
<span class="err">  &quot;task&quot;: {</span>
<span class="err">    &quot;type&quot;: &quot;http_request&quot;,</span>
<span class="err">    &quot;method&quot;: &quot;GET&quot;,</span>
<span class="err">    &quot;url&quot;: &quot;https://api.example.com/status&quot;,</span>
<span class="err">    &quot;headers&quot;: {</span>
<span class="err">      &quot;Authorization&quot;: &quot;Bearer token&quot;</span>
<span class="err">    },</span>
<span class="err">    &quot;timeout&quot;: 30</span>
<span class="err">  },</span>
<span class="err">  &quot;priority&quot;: &quot;normal&quot;,</span>
<span class="err">  &quot;async&quot;: false</span>
<span class="err">}</span>
</code></pre></div>

<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;task_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;task-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;status_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">      </span><span class="nt">&quot;body&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;execution_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1250</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;started_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-07T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-07T10:30:01Z&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="get-task-status">Get Task Status</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/task/{task-id}</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<h4 id="list-tasks">List Tasks</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/tasks?status=running&amp;client_id=uuid-string&amp;limit=50</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<h3 id="service-management">Service Management</h3>
<h4 id="deploy-service-to-client">Deploy Service to Client</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /platform/v1/service/deploy</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;client_id&quot;: &quot;uuid-string&quot;,</span>
<span class="err">  &quot;service&quot;: {</span>
<span class="err">    &quot;name&quot;: &quot;web-app&quot;,</span>
<span class="err">    &quot;image&quot;: &quot;nginx:latest&quot;,</span>
<span class="err">    &quot;replicas&quot;: 3,</span>
<span class="err">    &quot;ports&quot;: [</span>
<span class="err">      {</span>
<span class="err">        &quot;container_port&quot;: 80,</span>
<span class="err">        &quot;host_port&quot;: 8080</span>
<span class="err">      }</span>
<span class="err">    ],</span>
<span class="err">    &quot;environment&quot;: {</span>
<span class="err">      &quot;ENV&quot;: &quot;production&quot;</span>
<span class="err">    },</span>
<span class="err">    &quot;resources&quot;: {</span>
<span class="err">      &quot;limits&quot;: {</span>
<span class="err">        &quot;memory&quot;: &quot;512m&quot;,</span>
<span class="err">        &quot;cpu&quot;: &quot;0.5&quot;</span>
<span class="err">      }</span>
<span class="err">    }</span>
<span class="err">  }</span>
<span class="err">}</span>
</code></pre></div>

<h4 id="scale-service">Scale Service</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /platform/v1/service/scale</span>
<span class="err">Content-Type: application/json</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>

<span class="err">{</span>
<span class="err">  &quot;client_id&quot;: &quot;uuid-string&quot;,</span>
<span class="err">  &quot;service_name&quot;: &quot;web-app&quot;,</span>
<span class="err">  &quot;replicas&quot;: 5</span>
<span class="err">}</span>
</code></pre></div>

<h4 id="get-service-status">Get Service Status</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/service/{client-id}/{service-name}</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<h3 id="tenant-management">Tenant Management</h3>
<h4 id="get-tenant-information">Get Tenant Information</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /internal/v1/remotetenantclient/{tenant-uuid}</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<h4 id="get-tenant-configuration">Get Tenant Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /platform/v1/remotetenantconfigdata/{tenant-id}/{hostname}</span>
<span class="err">Authorization: Bearer &lt;access_token&gt;</span>
</code></pre></div>

<h3 id="monitoring-and-health">Monitoring and Health</h3>
<h4 id="server-health-check">Server Health Check</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /health</span>
</code></pre></div>

<p><strong>Response:</strong></p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;uptime&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2h30m15s&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-07T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;connected&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;response_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connections&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;active&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;idle&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;max&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;cache&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;connected&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;response_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;memory_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;45.2%&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;hit_ratio&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;89.5%&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;clients&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connected&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;disconnected&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;last_heartbeat&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-07T10:29:45Z&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;tasks&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;running&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;queued&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;completed_today&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1547</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;failed_today&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;system&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;cpu_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">25.5</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;memory_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">65.2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;disk_usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">42.1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;network_io&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;bytes_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1048576</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;bytes_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2097152</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="readiness-check">Readiness Check</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /ready</span>
</code></pre></div>

<h4 id="metrics-endpoint">Metrics Endpoint</h4>
<div class="highlight"><pre><span></span><code><span class="err">GET /metrics</span>
</code></pre></div>

<h2 id="client-management">Client Management</h2>
<h3 id="client-registration-process">Client Registration Process</h3>
<div class="mermaid">
sequenceDiagram
    participant Client as RIS Client
    participant LB as Load Balancer
    participant Server as RIS Server
    participant DB as Database
    participant Auth as Auth Service

    Client->>LB: WebSocket Connection Request
    LB->>Server: Route to Available Server
    Server->>Auth: Validate Client Certificate
    Auth-->>Server: Certificate Valid

    Server->>Server: Upgrade to WebSocket
    Server-->>Client: Connection Established

    Client->>Server: Registration Data
    Note right of Client: {clienthost, unique_id,<br/>version, capabilities}

    Server->>Server: Validate Registration
    Server->>DB: Store/Update Client Info
    DB-->>Server: Success

    Server->>Server: Generate Configuration
    Server-->>Client: Registration Acknowledgment

    loop Heartbeat
        Client->>Server: Heartbeat
        Server-->>Client: Heartbeat ACK
    end
</div>

<h3 id="client-lifecycle-management">Client Lifecycle Management</h3>
<h4 id="registration">Registration</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ClientRegistration</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ClientHost</span><span class="w">       </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;clienthost&quot;`</span>
<span class="w">    </span><span class="nx">UniqueClientID</span><span class="w">   </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;unique_client_id&quot;`</span>
<span class="w">    </span><span class="nx">Version</span><span class="w">          </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;version&quot;`</span>
<span class="w">    </span><span class="nx">Capabilities</span><span class="w">     </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;capabilities&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">       </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;tenantcode&quot;`</span>
<span class="w">    </span><span class="nx">HostType</span><span class="w">         </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;host_type&quot;`</span>
<span class="w">    </span><span class="nx">IsFirstPing</span><span class="w">      </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;isfirstping&quot;`</span>
<span class="w">    </span><span class="nx">IsNetworkChanged</span><span class="w"> </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;isnetworkchanged&quot;`</span>
<span class="w">    </span><span class="nx">RISNatIP</span><span class="w">         </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;ris_nat_ip&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="status-monitoring">Status Monitoring</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ClientStatus</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">               </span><span class="kt">int</span><span class="w">       </span><span class="s">`json:&quot;id&quot;`</span>
<span class="w">    </span><span class="nx">UniqueClientID</span><span class="w">   </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;unique_client_id&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">           </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">ConnectionStatus</span><span class="w"> </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;connection_status&quot;`</span>
<span class="w">    </span><span class="nx">LastSeen</span><span class="w">         </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;last_seen&quot;`</span>
<span class="w">    </span><span class="nx">IPAddress</span><span class="w">        </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;ip_address&quot;`</span>
<span class="w">    </span><span class="nx">Version</span><span class="w">          </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;version&quot;`</span>
<span class="w">    </span><span class="nx">Capabilities</span><span class="w">     </span><span class="p">[]</span><span class="kt">string</span><span class="w">  </span><span class="s">`json:&quot;capabilities&quot;`</span>
<span class="w">    </span><span class="nx">ResourceUsage</span><span class="w">    </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">CPU</span><span class="w">    </span><span class="kt">float64</span><span class="w"> </span><span class="s">`json:&quot;cpu&quot;`</span>
<span class="w">        </span><span class="nx">Memory</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span><span class="s">`json:&quot;memory&quot;`</span>
<span class="w">        </span><span class="nx">Disk</span><span class="w">   </span><span class="kt">float64</span><span class="w"> </span><span class="s">`json:&quot;disk&quot;`</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="s">`json:&quot;resource_usage&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="connection-management">Connection Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ConnectionManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">clients</span><span class="w">           </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">ClientConnection</span>
<span class="w">    </span><span class="nx">disconnectedCount</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">             </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="w">    </span><span class="nx">heartbeatInterval</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="w">    </span><span class="nx">timeoutDuration</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">AddClient</span><span class="p">(</span><span class="nx">clientID</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">conn</span><span class="w"> </span><span class="o">*</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">RemoveClient</span><span class="p">(</span><span class="nx">clientID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">GetClient</span><span class="p">(</span><span class="nx">clientID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">ClientConnection</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">BroadcastToClients</span><span class="p">(</span><span class="nx">message</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">GetConnectedClients</span><span class="p">()</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span>
</code></pre></div>

<h3 id="client-authentication-and-authorization">Client Authentication and Authorization</h3>
<h4 id="certificate-based-authentication">Certificate-Based Authentication</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ClientAuth</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">CertificateAuth</span><span class="w"> </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;certificate_auth&quot;`</span>
<span class="w">    </span><span class="nx">ClientCert</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;client_cert&quot;`</span>
<span class="w">    </span><span class="nx">ClientKey</span><span class="w">       </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;client_key&quot;`</span>
<span class="w">    </span><span class="nx">CACert</span><span class="w">          </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;ca_cert&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ValidateClientCertificate</span><span class="p">(</span><span class="nx">cert</span><span class="w"> </span><span class="o">*</span><span class="nx">x509</span><span class="p">.</span><span class="nx">Certificate</span><span class="p">,</span><span class="w"> </span><span class="nx">caCert</span><span class="w"> </span><span class="o">*</span><span class="nx">x509</span><span class="p">.</span><span class="nx">Certificate</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Certificate validation logic</span>
<span class="w">    </span><span class="nx">roots</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x509</span><span class="p">.</span><span class="nx">NewCertPool</span><span class="p">()</span>
<span class="w">    </span><span class="nx">roots</span><span class="p">.</span><span class="nx">AddCert</span><span class="p">(</span><span class="nx">caCert</span><span class="p">)</span>

<span class="w">    </span><span class="nx">opts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x509</span><span class="p">.</span><span class="nx">VerifyOptions</span><span class="p">{</span><span class="nx">Roots</span><span class="p">:</span><span class="w"> </span><span class="nx">roots</span><span class="p">}</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cert</span><span class="p">.</span><span class="nx">Verify</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="token-based-authentication">Token-Based Authentication</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ClientTokenAuth</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TokenType</span><span class="w">    </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;token_type&quot;`</span>
<span class="w">    </span><span class="nx">AccessToken</span><span class="w">  </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;access_token&quot;`</span>
<span class="w">    </span><span class="nx">RefreshToken</span><span class="w"> </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;refresh_token&quot;`</span>
<span class="w">    </span><span class="nx">ExpiresAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;expires_at&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ValidateClientToken</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">ClientClaims</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// JWT token validation</span>
<span class="w">    </span><span class="nx">claims</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ClientClaims</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">ParseWithClaims</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">claims</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="o">*</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">jwtSecret</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">claims</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="task-orchestration">Task Orchestration</h2>
<h3 id="task-routing-engine">Task Routing Engine</h3>
<div class="mermaid">
graph TB
    subgraph "Task Submission"
        API[API Request]
        VALIDATE[Validate Task]
        AUTH[Authorize User]
    end

    subgraph "Task Orchestration"
        QUEUE[Task Queue]
        ROUTER[Task Router]
        LB[Load Balancer]
        SELECTOR[Client Selector]
    end

    subgraph "Task Execution"
        CLIENT1[RIS Client 1]
        CLIENT2[RIS Client 2]
        CLIENTN[RIS Client N]
    end

    subgraph "Task Monitoring"
        TRACKER[Task Tracker]
        STATUS[Status Monitor]
        LOGGER[Audit Logger]
    end

    API --> VALIDATE
    VALIDATE --> AUTH
    AUTH --> QUEUE

    QUEUE --> ROUTER
    ROUTER --> LB
    LB --> SELECTOR

    SELECTOR --> CLIENT1
    SELECTOR --> CLIENT2
    SELECTOR --> CLIENTN

    CLIENT1 --> TRACKER
    CLIENT2 --> TRACKER
    CLIENTN --> TRACKER

    TRACKER --> STATUS
    TRACKER --> LOGGER

    style QUEUE fill:#fff3e0
    style ROUTER fill:#e8f5e8
    style TRACKER fill:#e3f2fd
</div>

<h3 id="task-types-and-schemas">Task Types and Schemas</h3>
<h4 id="http-request-task">HTTP Request Task</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">HTTPTask</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TaskID</span><span class="w">      </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;task_id&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">        </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Method</span><span class="w">      </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;method&quot;`</span>
<span class="w">    </span><span class="nx">URL</span><span class="w">         </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;url&quot;`</span>
<span class="w">    </span><span class="nx">Headers</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;headers&quot;`</span>
<span class="w">    </span><span class="nx">Body</span><span class="w">        </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;body&quot;`</span>
<span class="w">    </span><span class="nx">Timeout</span><span class="w">     </span><span class="kt">int</span><span class="w">               </span><span class="s">`json:&quot;timeout&quot;`</span>
<span class="w">    </span><span class="nx">Retries</span><span class="w">     </span><span class="kt">int</span><span class="w">               </span><span class="s">`json:&quot;retries&quot;`</span>
<span class="w">    </span><span class="nx">Auth</span><span class="w">        </span><span class="nx">AuthConfig</span><span class="w">        </span><span class="s">`json:&quot;auth&quot;`</span>
<span class="w">    </span><span class="nx">Validation</span><span class="w">  </span><span class="nx">ValidationConfig</span><span class="w">  </span><span class="s">`json:&quot;validation&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AuthConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">         </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;username&quot;`</span>
<span class="w">    </span><span class="nx">Password</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;password&quot;`</span>
<span class="w">    </span><span class="nx">BearerToken</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;bearer_token&quot;`</span>
<span class="w">    </span><span class="nx">APIKey</span><span class="w">       </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;api_key&quot;`</span>
<span class="w">    </span><span class="nx">CustomHeader</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;custom_header&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="docker-service-task">Docker Service Task</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">DockerTask</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TaskID</span><span class="w">       </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;task_id&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">         </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Action</span><span class="w">       </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;action&quot;`</span>
<span class="w">    </span><span class="nx">ServiceName</span><span class="w">  </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;service_name&quot;`</span>
<span class="w">    </span><span class="nx">Image</span><span class="w">        </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;image&quot;`</span>
<span class="w">    </span><span class="nx">Replicas</span><span class="w">     </span><span class="kt">int</span><span class="w">                    </span><span class="s">`json:&quot;replicas&quot;`</span>
<span class="w">    </span><span class="nx">Ports</span><span class="w">        </span><span class="p">[]</span><span class="nx">PortMapping</span><span class="w">          </span><span class="s">`json:&quot;ports&quot;`</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;environment&quot;`</span>
<span class="w">    </span><span class="nx">Volumes</span><span class="w">      </span><span class="p">[]</span><span class="nx">VolumeMapping</span><span class="w">        </span><span class="s">`json:&quot;volumes&quot;`</span>
<span class="w">    </span><span class="nx">Networks</span><span class="w">     </span><span class="p">[]</span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;networks&quot;`</span>
<span class="w">    </span><span class="nx">Resources</span><span class="w">    </span><span class="nx">ResourceConstraints</span><span class="w">    </span><span class="s">`json:&quot;resources&quot;`</span>
<span class="w">    </span><span class="nx">HealthCheck</span><span class="w">  </span><span class="nx">HealthCheckConfig</span><span class="w">      </span><span class="s">`json:&quot;health_check&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">PortMapping</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ContainerPort</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;container_port&quot;`</span>
<span class="w">    </span><span class="nx">HostPort</span><span class="w">      </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;host_port&quot;`</span>
<span class="w">    </span><span class="nx">Protocol</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;protocol&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="system-command-task">System Command Task</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">CommandTask</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TaskID</span><span class="w">      </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;task_id&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">        </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Command</span><span class="w">     </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;command&quot;`</span>
<span class="w">    </span><span class="nx">Args</span><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="w">          </span><span class="s">`json:&quot;args&quot;`</span>
<span class="w">    </span><span class="nx">WorkingDir</span><span class="w">  </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;working_dir&quot;`</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;environment&quot;`</span>
<span class="w">    </span><span class="nx">Timeout</span><span class="w">     </span><span class="kt">int</span><span class="w">               </span><span class="s">`json:&quot;timeout&quot;`</span>
<span class="w">    </span><span class="nx">RunAsUser</span><span class="w">   </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;run_as_user&quot;`</span>
<span class="w">    </span><span class="nx">Privileged</span><span class="w">  </span><span class="kt">bool</span><span class="w">              </span><span class="s">`json:&quot;privileged&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="task-execution-flow">Task Execution Flow</h3>
<h4 id="task-lifecycle">Task Lifecycle</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="kt">string</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">TaskStatusPending</span><span class="w">   </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;pending&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusQueued</span><span class="w">    </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;queued&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusRunning</span><span class="w">   </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;running&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusCompleted</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;completed&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusFailed</span><span class="w">    </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;failed&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusCancelled</span><span class="w"> </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;cancelled&quot;</span>
<span class="w">    </span><span class="nx">TaskStatusTimeout</span><span class="w">   </span><span class="nx">TaskStatus</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;timeout&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Task</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">          </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;id&quot; bson:&quot;_id&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">        </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;type&quot; bson:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">      </span><span class="nx">TaskStatus</span><span class="w">             </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">Priority</span><span class="w">    </span><span class="kt">int</span><span class="w">                    </span><span class="s">`json:&quot;priority&quot; bson:&quot;priority&quot;`</span>
<span class="w">    </span><span class="nx">ClientID</span><span class="w">    </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;client_id&quot; bson:&quot;client_id&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">  </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;tenant_code&quot; bson:&quot;tenant_code&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">      </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;user_id&quot; bson:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">Payload</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;payload&quot; bson:&quot;payload&quot;`</span>
<span class="w">    </span><span class="nx">Result</span><span class="w">      </span><span class="o">*</span><span class="nx">TaskResult</span><span class="w">            </span><span class="s">`json:&quot;result,omitempty&quot; bson:&quot;result,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">CreatedAt</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">              </span><span class="s">`json:&quot;created_at&quot; bson:&quot;created_at&quot;`</span>
<span class="w">    </span><span class="nx">StartedAt</span><span class="w">   </span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">             </span><span class="s">`json:&quot;started_at,omitempty&quot; bson:&quot;started_at,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">CompletedAt</span><span class="w"> </span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">             </span><span class="s">`json:&quot;completed_at,omitempty&quot; bson:&quot;completed_at,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Timeout</span><span class="w">     </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">          </span><span class="s">`json:&quot;timeout&quot; bson:&quot;timeout&quot;`</span>
<span class="w">    </span><span class="nx">Retries</span><span class="w">     </span><span class="kt">int</span><span class="w">                    </span><span class="s">`json:&quot;retries&quot; bson:&quot;retries&quot;`</span>
<span class="w">    </span><span class="nx">MaxRetries</span><span class="w">  </span><span class="kt">int</span><span class="w">                    </span><span class="s">`json:&quot;max_retries&quot; bson:&quot;max_retries&quot;`</span>
<span class="w">    </span><span class="nx">Metadata</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;metadata&quot; bson:&quot;metadata&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="task-orchestrator-implementation">Task Orchestrator Implementation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TaskOrchestrator</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">queue</span><span class="w">          </span><span class="nx">TaskQueue</span>
<span class="w">    </span><span class="nx">router</span><span class="w">         </span><span class="nx">TaskRouter</span>
<span class="w">    </span><span class="nx">clientManager</span><span class="w">  </span><span class="nx">ClientManager</span>
<span class="w">    </span><span class="nx">taskTracker</span><span class="w">    </span><span class="nx">TaskTracker</span>
<span class="w">    </span><span class="nx">config</span><span class="w">         </span><span class="nx">OrchestratorConfig</span>
<span class="w">    </span><span class="nx">metrics</span><span class="w">        </span><span class="nx">MetricsCollector</span>
<span class="w">    </span><span class="nx">logger</span><span class="w">         </span><span class="nx">Logger</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskOrchestrator</span><span class="p">)</span><span class="w"> </span><span class="nx">SubmitTask</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="o">*</span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Validate task</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">validateTask</span><span class="p">(</span><span class="nx">task</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;task validation failed: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Add to queue</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">Enqueue</span><span class="p">(</span><span class="nx">task</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to queue task: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Start processing if not async</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">task</span><span class="p">.</span><span class="nx">Async</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">processTask</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskOrchestrator</span><span class="p">)</span><span class="w"> </span><span class="nx">processTask</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="o">*</span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Select appropriate client</span>
<span class="w">    </span><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">selectClient</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;client selection failed: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Route task to client</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">to</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">RouteTask</span><span class="p">(</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="priority-and-queue-management">Priority and Queue Management</h3>
<h4 id="priority-queue-implementation">Priority Queue Implementation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">PriorityQueue</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">queues</span><span class="w">   </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">Queue</span><span class="w">  </span><span class="c1">// Priority level -&gt; Queue</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">    </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="w">    </span><span class="nx">maxSize</span><span class="w">  </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">metrics</span><span class="w">  </span><span class="o">*</span><span class="nx">QueueMetrics</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pq</span><span class="w"> </span><span class="o">*</span><span class="nx">PriorityQueue</span><span class="p">)</span><span class="w"> </span><span class="nx">Enqueue</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="o">*</span><span class="nx">Task</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">pq</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">pq</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="nx">priority</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">Priority</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">priority</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">priority</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">priority</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="c1">// Default priority</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">queue</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pq</span><span class="p">.</span><span class="nx">queues</span><span class="p">[</span><span class="nx">priority</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">queue</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewQueue</span><span class="p">(</span><span class="nx">pq</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">        </span><span class="nx">pq</span><span class="p">.</span><span class="nx">queues</span><span class="p">[</span><span class="nx">priority</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queue</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">queue</span><span class="p">.</span><span class="nx">Enqueue</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pq</span><span class="w"> </span><span class="o">*</span><span class="nx">PriorityQueue</span><span class="p">)</span><span class="w"> </span><span class="nx">Dequeue</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Task</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">pq</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">pq</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Process highest priority first</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">priority</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="nx">priority</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">priority</span><span class="o">--</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">queue</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pq</span><span class="p">.</span><span class="nx">queues</span><span class="p">[</span><span class="nx">priority</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queue</span><span class="p">.</span><span class="nx">Dequeue</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">ErrQueueEmpty</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="multi-tenant-architecture">Multi-Tenant Architecture</h2>
<h3 id="tenant-isolation-strategies">Tenant Isolation Strategies</h3>
<div class="mermaid">
graph TB
    subgraph "Request Layer"
        REQ[HTTP Request]
        EXTRACT[Extract Tenant Context]
        VALIDATE[Validate Tenant]
    end

    subgraph "Data Layer Isolation"
        subgraph "Database Level"
            DB1[(Tenant A DB)]
            DB2[(Tenant B DB)]
            DB3[(Shared DB)]
        end

        subgraph "Application Level"
            FILTER[Data Filtering]
            SCOPE[Query Scoping]
            ENCRYPT[Tenant Encryption]
        end
    end

    subgraph "Resource Isolation"
        CONN1[Tenant A Connections]
        CONN2[Tenant B Connections]
        CACHE1[Tenant A Cache]
        CACHE2[Tenant B Cache]
    end

    REQ --> EXTRACT
    EXTRACT --> VALIDATE
    VALIDATE --> FILTER
    VALIDATE --> SCOPE

    FILTER --> DB1
    FILTER --> DB2
    FILTER --> DB3

    SCOPE --> ENCRYPT
    ENCRYPT --> CONN1
    ENCRYPT --> CONN2

    CONN1 --> CACHE1
    CONN2 --> CACHE2

    style DB1 fill:#e8f5e8
    style DB2 fill:#fff3e0
    style DB3 fill:#e3f2fd
    style ENCRYPT fill:#ffcdd2
</div>

<h3 id="tenant-management_1">Tenant Management</h3>
<h4 id="tenant-model">Tenant Model</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Tenant</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">           </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;id&quot; bson:&quot;_id&quot;`</span>
<span class="w">    </span><span class="nx">Code</span><span class="w">         </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;code&quot; bson:&quot;code&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">         </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;name&quot; bson:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Description</span><span class="w">  </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;description&quot; bson:&quot;description&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">       </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">DatabaseInfo</span><span class="w"> </span><span class="nx">DatabaseInfo</span><span class="w">      </span><span class="s">`json:&quot;database_info&quot; bson:&quot;database_info&quot;`</span>
<span class="w">    </span><span class="nx">Settings</span><span class="w">     </span><span class="nx">TenantSettings</span><span class="w">    </span><span class="s">`json:&quot;settings&quot; bson:&quot;settings&quot;`</span>
<span class="w">    </span><span class="nx">Limits</span><span class="w">       </span><span class="nx">ResourceLimits</span><span class="w">    </span><span class="s">`json:&quot;limits&quot; bson:&quot;limits&quot;`</span>
<span class="w">    </span><span class="nx">CreatedAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">         </span><span class="s">`json:&quot;created_at&quot; bson:&quot;created_at&quot;`</span>
<span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">         </span><span class="s">`json:&quot;updated_at&quot; bson:&quot;updated_at&quot;`</span>
<span class="w">    </span><span class="nx">Metadata</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;metadata&quot; bson:&quot;metadata&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DatabaseInfo</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">         </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;type&quot; bson:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Host</span><span class="w">         </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;host&quot; bson:&quot;host&quot;`</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">         </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;port&quot; bson:&quot;port&quot;`</span>
<span class="w">    </span><span class="nx">Database</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;database&quot; bson:&quot;database&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;username&quot; bson:&quot;username&quot;`</span>
<span class="w">    </span><span class="nx">Password</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;password&quot; bson:&quot;password&quot;`</span>
<span class="w">    </span><span class="nx">SSL</span><span class="w">          </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;ssl&quot; bson:&quot;ssl&quot;`</span>
<span class="w">    </span><span class="nx">MaxPoolSize</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;max_pool_size&quot; bson:&quot;max_pool_size&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TenantSettings</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TimeZone</span><span class="w">           </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;timezone&quot; bson:&quot;timezone&quot;`</span>
<span class="w">    </span><span class="nx">Language</span><span class="w">           </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;language&quot; bson:&quot;language&quot;`</span>
<span class="w">    </span><span class="nx">Features</span><span class="w">           </span><span class="p">[]</span><span class="kt">string</span><span class="w">          </span><span class="s">`json:&quot;features&quot; bson:&quot;features&quot;`</span>
<span class="w">    </span><span class="nx">SecurityPolicy</span><span class="w">     </span><span class="nx">SecurityPolicy</span><span class="w">    </span><span class="s">`json:&quot;security_policy&quot; bson:&quot;security_policy&quot;`</span>
<span class="w">    </span><span class="nx">NotificationConfig</span><span class="w"> </span><span class="nx">NotificationConfig</span><span class="w"> </span><span class="s">`json:&quot;notification_config&quot; bson:&quot;notification_config&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ResourceLimits</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">MaxClients</span><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;max_clients&quot; bson:&quot;max_clients&quot;`</span>
<span class="w">    </span><span class="nx">MaxTasks</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;max_tasks&quot; bson:&quot;max_tasks&quot;`</span>
<span class="w">    </span><span class="nx">MaxStorageGB</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;max_storage_gb&quot; bson:&quot;max_storage_gb&quot;`</span>
<span class="w">    </span><span class="nx">MaxBandwidthMBs</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="s">`json:&quot;max_bandwidth_mbs&quot; bson:&quot;max_bandwidth_mbs&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="tenant-context-management">Tenant Context Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TenantContext</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TenantID</span><span class="w">     </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;tenant_id&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">   </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;tenant_code&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">       </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">Permissions</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;permissions&quot;`</span>
<span class="w">    </span><span class="nx">Settings</span><span class="w">     </span><span class="nx">TenantSettings</span><span class="w">         </span><span class="s">`json:&quot;settings&quot;`</span>
<span class="w">    </span><span class="nx">Limits</span><span class="w">       </span><span class="nx">ResourceLimits</span><span class="w">         </span><span class="s">`json:&quot;limits&quot;`</span>
<span class="w">    </span><span class="nx">DBSession</span><span class="w">    </span><span class="nx">database</span><span class="p">.</span><span class="nx">Session</span><span class="w">       </span><span class="s">`json:&quot;-&quot;`</span>
<span class="w">    </span><span class="nx">CacheClient</span><span class="w">  </span><span class="nx">cache</span><span class="p">.</span><span class="nx">Client</span><span class="w">           </span><span class="s">`json:&quot;-&quot;`</span>
<span class="w">    </span><span class="nx">Metadata</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;metadata&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TenantManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tenantRepo</span><span class="w">    </span><span class="nx">TenantRepository</span>
<span class="w">    </span><span class="nx">dbManager</span><span class="w">     </span><span class="nx">DatabaseManager</span>
<span class="w">    </span><span class="nx">cacheManager</span><span class="w">  </span><span class="nx">CacheManager</span>
<span class="w">    </span><span class="nx">encryptionSvc</span><span class="w"> </span><span class="nx">EncryptionService</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">         </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="w">    </span><span class="nx">tenantCache</span><span class="w">   </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">TenantContext</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tm</span><span class="w"> </span><span class="o">*</span><span class="nx">TenantManager</span><span class="p">)</span><span class="w"> </span><span class="nx">GetTenantContext</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">TenantContext</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check cache first</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tm</span><span class="p">.</span><span class="nx">tenantCache</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Load from database</span>
<span class="w">    </span><span class="nx">tenant</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tm</span><span class="p">.</span><span class="nx">tenantRepo</span><span class="p">.</span><span class="nx">GetByCode</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;tenant not found: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create database session</span>
<span class="w">    </span><span class="nx">dbSession</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tm</span><span class="p">.</span><span class="nx">dbManager</span><span class="p">.</span><span class="nx">CreateTenantSession</span><span class="p">(</span><span class="nx">tenant</span><span class="p">.</span><span class="nx">DatabaseInfo</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create DB session: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create cache client</span>
<span class="w">    </span><span class="nx">cacheClient</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tm</span><span class="p">.</span><span class="nx">cacheManager</span><span class="p">.</span><span class="nx">CreateTenantClient</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create cache client: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TenantContext</span><span class="p">{</span>
<span class="w">        </span><span class="nx">TenantID</span><span class="p">:</span><span class="w">    </span><span class="nx">tenant</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">TenantCode</span><span class="p">:</span><span class="w">  </span><span class="nx">tenant</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Settings</span><span class="p">:</span><span class="w">    </span><span class="nx">tenant</span><span class="p">.</span><span class="nx">Settings</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Limits</span><span class="p">:</span><span class="w">      </span><span class="nx">tenant</span><span class="p">.</span><span class="nx">Limits</span><span class="p">,</span>
<span class="w">        </span><span class="nx">DBSession</span><span class="p">:</span><span class="w">   </span><span class="nx">dbSession</span><span class="p">,</span>
<span class="w">        </span><span class="nx">CacheClient</span><span class="p">:</span><span class="w"> </span><span class="nx">cacheClient</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Cache context</span>
<span class="w">    </span><span class="nx">tm</span><span class="p">.</span><span class="nx">tenantCache</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">ctx</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="database-isolation">Database Isolation</h3>
<h4 id="tenant-specific-database-connections">Tenant-Specific Database Connections</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">DatabaseManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">defaultDB</span><span class="w">     </span><span class="nx">database</span><span class="p">.</span><span class="nx">Database</span>
<span class="w">    </span><span class="nx">tenantDBs</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">database</span><span class="p">.</span><span class="nx">Database</span>
<span class="w">    </span><span class="nx">poolManager</span><span class="w">   </span><span class="nx">ConnectionPoolManager</span>
<span class="w">    </span><span class="nx">encryptionSvc</span><span class="w"> </span><span class="nx">EncryptionService</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">         </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">dm</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseManager</span><span class="p">)</span><span class="w"> </span><span class="nx">CreateTenantSession</span><span class="p">(</span><span class="nx">dbInfo</span><span class="w"> </span><span class="nx">DatabaseInfo</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">Session</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">tenantKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span><span class="w"> </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Check if tenant DB connection exists</span>
<span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dm</span><span class="p">.</span><span class="nx">tenantDBs</span><span class="p">[</span><span class="nx">tenantKey</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create new connection</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<span class="w">        </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dm</span><span class="p">.</span><span class="nx">createTenantConnection</span><span class="p">(</span><span class="nx">dbInfo</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to create tenant connection: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">dm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">        </span><span class="nx">dm</span><span class="p">.</span><span class="nx">tenantDBs</span><span class="p">[</span><span class="nx">tenantKey</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span>
<span class="w">        </span><span class="nx">dm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create session with tenant context</span>
<span class="w">    </span><span class="nx">session</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">NewSession</span><span class="p">()</span>
<span class="w">    </span><span class="nx">session</span><span class="p">.</span><span class="nx">SetTenantContext</span><span class="p">(</span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">session</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">dm</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseManager</span><span class="p">)</span><span class="w"> </span><span class="nx">createTenantConnection</span><span class="p">(</span><span class="nx">dbInfo</span><span class="w"> </span><span class="nx">DatabaseInfo</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">database</span><span class="p">.</span><span class="nx">Database</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Decrypt database credentials</span>
<span class="w">    </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dm</span><span class="p">.</span><span class="nx">encryptionSvc</span><span class="p">.</span><span class="nx">Decrypt</span><span class="p">(</span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Password</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to decrypt password: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Build connection URI</span>
<span class="w">    </span><span class="nx">uri</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;mongodb://%s:%s@%s:%d/%s&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Username</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span><span class="w"> </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Port</span><span class="p">,</span><span class="w"> </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">Database</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Configure connection options</span>
<span class="w">    </span><span class="nx">opts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">database</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">MaxPoolSize</span><span class="p">:</span><span class="w">     </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">MaxPoolSize</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ConnectTimeout</span><span class="p">:</span><span class="w">  </span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SocketTimeout</span><span class="p">:</span><span class="w">   </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SSL</span><span class="p">:</span><span class="w">             </span><span class="nx">dbInfo</span><span class="p">.</span><span class="nx">SSL</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ReplicaSet</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Configure if using replica set</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">database</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">opts</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="data-encryption-per-tenant">Data Encryption per Tenant</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TenantEncryption</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">keyManager</span><span class="w">    </span><span class="nx">KeyManager</span>
<span class="w">    </span><span class="nx">encryptionSvc</span><span class="w"> </span><span class="nx">EncryptionService</span>
<span class="w">    </span><span class="nx">tenantKeys</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">byte</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">         </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">te</span><span class="w"> </span><span class="o">*</span><span class="nx">TenantEncryption</span><span class="p">)</span><span class="w"> </span><span class="nx">EncryptTenantData</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">getTenantKey</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get tenant key: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">encryptionSvc</span><span class="p">.</span><span class="nx">Encrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">te</span><span class="w"> </span><span class="o">*</span><span class="nx">TenantEncryption</span><span class="p">)</span><span class="w"> </span><span class="nx">DecryptTenantData</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">encryptedData</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">getTenantKey</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to get tenant key: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">encryptionSvc</span><span class="p">.</span><span class="nx">Decrypt</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">te</span><span class="w"> </span><span class="o">*</span><span class="nx">TenantEncryption</span><span class="p">)</span><span class="w"> </span><span class="nx">getTenantKey</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">te</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">tenantKeys</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">te</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">te</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Generate or retrieve tenant-specific key</span>
<span class="w">    </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">te</span><span class="p">.</span><span class="nx">keyManager</span><span class="p">.</span><span class="nx">GetTenantKey</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">te</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">te</span><span class="p">.</span><span class="nx">tenantKeys</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">key</span>
<span class="w">    </span><span class="nx">te</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<p><em>Document Version: 1.0</em><br />
<em>Last Updated: October 7, 2025</em><br />
<em>Comprehensive RIS Server Documentation</em></p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 18, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
