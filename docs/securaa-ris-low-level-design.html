<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Securaa RIS - Low Level Design">
    <title>Securaa RIS - Low Level Design - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 18, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="remote-integrated-services-ris-system-low-level-design-lld">Remote Integrated Services (RIS) System - Low-Level Design (LLD)</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#detailed-component-design">Detailed Component Design</a></li>
<li><a href="#class-diagrams-and-implementation">Class Diagrams and Implementation</a></li>
<li><a href="#database-design-and-schema">Database Design and Schema</a></li>
<li><a href="#api-specifications-and-protocols">API Specifications and Protocols</a></li>
<li><a href="#websocket-protocol-implementation">WebSocket Protocol Implementation</a></li>
<li><a href="#task-execution-framework">Task Execution Framework</a></li>
<li><a href="#sequence-diagrams-and-interaction-flows">Sequence Diagrams and Interaction Flows</a></li>
<li><a href="#error-handling-and-logging-framework">Error Handling and Logging Framework</a></li>
<li><a href="#configuration-management-system">Configuration Management System</a></li>
<li><a href="#security-implementation-details">Security Implementation Details</a></li>
<li><a href="#performance-optimization-techniques">Performance Optimization Techniques</a></li>
<li><a href="#testing-and-quality-assurance">Testing and Quality Assurance</a></li>
<li><a href="#deployment-and-devops">Deployment and DevOps</a></li>
</ol>
<h2 id="introduction">Introduction</h2>
<p>This Low-Level Design document provides comprehensive technical specifications for the Remote Integrated Services (RIS) System implementation. It includes detailed class structures, method signatures, database schemas, API endpoints, protocol specifications, and implementation specifics for both server and client components.</p>
<h3 id="document-scope">Document Scope</h3>
<p>This LLD covers:
- <strong>Implementation Details</strong>: Specific code structures, methods, and algorithms
- <strong>Technical Specifications</strong>: Database schemas, API endpoints, protocol definitions
- <strong>Integration Patterns</strong>: How components interact and communicate
- <strong>Quality Attributes</strong>: Performance, security, reliability, and maintainability considerations
- <strong>Operational Aspects</strong>: Deployment, monitoring, and maintenance procedures</p>
<h3 id="design-principles">Design Principles</h3>
<p>The implementation follows these core principles:
- <strong>Simplicity</strong>: Clear, readable, and maintainable code
- <strong>Performance</strong>: Optimized for high throughput and low latency
- <strong>Security</strong>: Security-by-design with comprehensive protection mechanisms
- <strong>Scalability</strong>: Horizontal and vertical scaling capabilities
- <strong>Reliability</strong>: Fault tolerance and automatic recovery mechanisms</p>
<h2 id="detailed-component-design">Detailed Component Design</h2>
<h3 id="1-ris-server-component-design">1. RIS Server Component Design</h3>
<h4 id="11-main-application-structure">1.1 Main Application Structure</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// App represents the main application structure</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Router</span><span class="w">                 </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="w">                    </span><span class="c1">// HTTP router for REST endpoints</span>
<span class="w">    </span><span class="nx">AccessTokenHashMap</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int64</span><span class="w">               </span><span class="c1">// JWT token expiry tracking</span>
<span class="w">    </span><span class="nx">Socket</span><span class="w">                 </span><span class="o">*</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Conn</span><span class="w">                </span><span class="c1">// WebSocket connection handler</span>
<span class="w">    </span><span class="nx">SocketClients</span><span class="w">          </span><span class="p">[]</span><span class="o">*</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Conn</span><span class="w">              </span><span class="c1">// Multiple WebSocket connections</span>
<span class="w">    </span><span class="nx">DBSession</span><span class="w">              </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="w"> </span><span class="c1">// Database sessions per tenant</span>
<span class="w">    </span><span class="nx">ConfigObject</span><span class="w">           </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="w">            </span><span class="c1">// Application configuration</span>
<span class="w">    </span><span class="nx">SecondaryMongoDBHosts</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="w">                       </span><span class="c1">// Secondary DB hosts for HA</span>
<span class="w">    </span><span class="nx">BuildType</span><span class="w">              </span><span class="kt">string</span><span class="w">                         </span><span class="c1">// Deployment type (mssp/standalone)</span>
<span class="w">    </span><span class="nx">DisconnectedRISClients</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="w">                 </span><span class="c1">// Disconnected client tracking</span>
<span class="w">    </span><span class="nx">RISClientsResponse</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="w">                 </span><span class="c1">// Client response tracking</span>
<span class="w">    </span><span class="nx">MapMutex</span><span class="w">               </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span><span class="w">                   </span><span class="c1">// Thread-safe map access</span>
<span class="w">    </span><span class="nx">RequestResponseLog</span><span class="w">     </span><span class="kt">bool</span><span class="w">                           </span><span class="c1">// Logging configuration</span>
<span class="p">}</span>

<span class="c1">// Core application methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">Initialize</span><span class="p">()</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">Run</span><span class="p">(</span><span class="nx">port</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">certFile</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">keyFile</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">initializeRoutes</span><span class="p">()</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">liveWebSockets</span><span class="p">(</span><span class="nx">socketConnection</span><span class="w"> </span><span class="o">*</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span><span class="w"> </span>
<span class="w">                           </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span>
<span class="w">                           </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>
</code></pre></div>

<h4 id="12-ris-controller-design">1.2 RIS Controller Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">RISController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Core RIS management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetAllRIS</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">AddNewRIS</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateRIS</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteRIS</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>

<span class="c1">// Client management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetSingleRISClient</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                         </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                         </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetRISClientConfigData</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">                                             </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                             </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">,</span>
<span class="w">                                             </span><span class="nx">secondaryMongoDBHosts</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span>

<span class="c1">// Status management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">SetClientStatus</span><span class="p">(</span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                      </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISController</span><span class="p">)</span><span class="w"> </span><span class="nx">SetTenantStatus</span><span class="p">(</span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                                      </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>

<h4 id="13-ris-model-design">1.3 RIS Model Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">RIS</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">               </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;id&quot; bson:&quot;id&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">             </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot; bson:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Description</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;description&quot; bson:&quot;description&quot;`</span>
<span class="w">    </span><span class="nx">Host</span><span class="w">             </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;host&quot; bson:&quot;host&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">           </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">ConnectionStatus</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;connection_status&quot; bson:&quot;connection_status&quot;`</span>
<span class="w">    </span><span class="nx">CreatedDate</span><span class="w">      </span><span class="kt">int64</span><span class="w">  </span><span class="s">`json:&quot;createddate&quot; bson:&quot;createddate&quot;`</span>
<span class="w">    </span><span class="nx">UpdatedDate</span><span class="w">      </span><span class="kt">int64</span><span class="w">  </span><span class="s">`json:&quot;updateddate&quot; bson:&quot;updateddate&quot;`</span>
<span class="w">    </span><span class="nx">Version</span><span class="w">          </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;version&quot; bson:&quot;version&quot;`</span>
<span class="w">    </span><span class="nx">UniqueClientID</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;unique_client_id&quot; bson:&quot;unique_client_id&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">       </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;tenantcode&quot; bson:&quot;tenantcode&quot;`</span>
<span class="p">}</span>

<span class="c1">// Model methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ris</span><span class="w"> </span><span class="o">*</span><span class="nx">RIS</span><span class="p">)</span><span class="w"> </span><span class="nx">GetRISList</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span><span class="p">,</span>
<span class="w">                         </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ris</span><span class="w"> </span><span class="o">*</span><span class="nx">RIS</span><span class="p">)</span><span class="w"> </span><span class="nx">GetRISData</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span><span class="p">,</span>
<span class="w">                         </span><span class="nx">risID</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">RIS</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ris</span><span class="w"> </span><span class="o">*</span><span class="nx">RIS</span><span class="p">)</span><span class="w"> </span><span class="nx">AddRIS</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span><span class="p">,</span>
<span class="w">                     </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ris</span><span class="w"> </span><span class="o">*</span><span class="nx">RIS</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateRIS</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">ris</span><span class="w"> </span><span class="o">*</span><span class="nx">RIS</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteRIS</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>

<h3 id="2-ris-client-component-design">2. RIS Client Component Design</h3>
<h4 id="21-main-application-structure">2.1 Main Application Structure</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Router</span><span class="w">       </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="w">            </span><span class="c1">// HTTP router for client endpoints</span>
<span class="w">    </span><span class="nx">ConfigObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="w">    </span><span class="c1">// Configuration object</span>
<span class="w">    </span><span class="nx">CLI</span><span class="w">          </span><span class="o">*</span><span class="nx">client</span><span class="p">.</span><span class="nx">Client</span><span class="w">         </span><span class="c1">// Docker client for service management</span>
<span class="p">}</span>

<span class="c1">// Core application methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">Initialize</span><span class="p">()</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">Run</span><span class="p">(</span><span class="nx">port</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">initializeRoutes</span><span class="p">()</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">risClient</span><span class="p">()</span><span class="w"> </span><span class="c1">// WebSocket client connection management</span>
</code></pre></div>

<h4 id="22-task-handler-controller-design">2.2 Task Handler Controller Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TaskHandlerController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Task execution methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tc</span><span class="w"> </span><span class="nx">TaskHandlerController</span><span class="p">)</span><span class="w"> </span><span class="nx">RunTaskByHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tc</span><span class="w"> </span><span class="nx">TaskHandlerController</span><span class="p">)</span><span class="w"> </span><span class="nx">RunTask</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tc</span><span class="w"> </span><span class="nx">TaskHandlerController</span><span class="p">)</span><span class="w"> </span><span class="nx">ADTestConnectivity</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>

<span class="c1">// Utility methods</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">IsJson</span><span class="p">(</span><span class="nx">str</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span>
</code></pre></div>

<h4 id="23-ris-client-controller-design">2.3 RIS Client Controller Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">RISClientController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Service management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">DeployServices</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">CheckClientStatus</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">IsServiceRunning</span><span class="p">(</span><span class="nx">cli</span><span class="w"> </span><span class="o">*</span><span class="nx">client</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span><span class="nx">serviceName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="c1">// Network management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetExternalIP</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetInternalIP</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>

<span class="c1">// File management methods</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">readHostFile</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">updateHostConfig</span><span class="p">(</span><span class="nx">host</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>

<h4 id="24-task-models-design">2.4 Task Models Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">TaskHandlerRequest</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Method</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;method&quot; bson:&quot;method&quot;`</span>
<span class="w">    </span><span class="nx">REST</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;rest&quot; bson:&quot;rest&quot;`</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;port&quot; bson:&quot;port&quot;`</span>
<span class="w">    </span><span class="nx">BaseURL</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;baseurl&quot; bson:&quot;baseurl&quot;`</span>
<span class="w">    </span><span class="nx">Params</span><span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;params&quot; bson:&quot;params&quot;`</span>
<span class="w">    </span><span class="nx">Data</span><span class="w">        </span><span class="p">[]</span><span class="kt">byte</span><span class="w"> </span><span class="s">`json:&quot;data&quot; bson:&quot;data&quot;`</span>
<span class="w">    </span><span class="nx">AccessToken</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;access_token&quot; bson:&quot;access_token&quot;`</span>
<span class="w">    </span><span class="nx">JwtToken</span><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;jwt_token&quot; bson:&quot;jwt_token&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TaskRequest</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Method</span><span class="w">         </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;method&quot; bson:&quot;method&quot;`</span>
<span class="w">    </span><span class="nx">RestURL</span><span class="w">        </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;resturl&quot; bson:&quot;resturl&quot;`</span>
<span class="w">    </span><span class="nx">RequestHeaders</span><span class="w"> </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;headers&quot; bson:&quot;headers&quot;`</span>
<span class="w">    </span><span class="nx">Data</span><span class="w">           </span><span class="p">[]</span><span class="kt">byte</span><span class="w">               </span><span class="s">`json:&quot;data&quot; bson:&quot;data&quot;`</span>
<span class="w">    </span><span class="nx">AuthType</span><span class="w">       </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;authtype&quot; bson:&quot;authtype&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w">       </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;username&quot; bson:&quot;username&quot;`</span>
<span class="w">    </span><span class="nx">Password</span><span class="w">       </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;password&quot; bson:&quot;password&quot;`</span>
<span class="w">    </span><span class="nx">BearerToken</span><span class="w">    </span><span class="kt">string</span><span class="w">               </span><span class="s">`json:&quot;bearertoken&quot; bson:&quot;bearertoken&quot;`</span>
<span class="w">    </span><span class="nx">Cookies</span><span class="w">        </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="w"> </span><span class="s">`json:&quot;cookies&quot; bson:&quot;cookies&quot;`</span>
<span class="p">}</span>

<span class="c1">// Task execution methods</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">taskRequest</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskHandlerRequest</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildAndExecuteTask</span><span class="p">()</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">taskRequest</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskRequest</span><span class="p">)</span><span class="w"> </span><span class="nx">ExecuteTask</span><span class="p">()</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                             </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Header</span><span class="p">)</span>
</code></pre></div>

<h2 id="class-diagrams">Class Diagrams</h2>
<h3 id="1-server-side-class-hierarchy">1. Server-Side Class Hierarchy</h3>
<div class="mermaid">
classDiagram
    class App {
        +Router mux.Router
        +DBSession map~string~SessionStruct
        +ConfigObject config.ConfigStruct
        +Initialize()
        +Run()
        +initializeRoutes()
    }

    class RISController {
        +GetAllRIS()
        +AddNewRIS()
        +UpdateRIS()
        +DeleteRIS()
        +GetSingleRISClient()
    }

    class RemoteTenantController {
        +GetTenantClient()
        +GetTenantConfig()
    }

    class CacheController {
        +GetCache()
        +SetCache()
        +ClearCache()
    }

    class RISModel {
        +int ID
        +string Name
        +string Description
        +string Host
        +string Status
        +string ConnectionStatus
        +GetRISList()
        +AddRIS()
        +UpdateRIS()
    }

    class TenantDBInfo {
        +string DBName
        +string DBUsername
        +string DBPassword
        +string DBHost
    }

    class Response {
        +bool Success
        +interface Data
        +string Error
        +string DisplayMessage
    }

    App --> RISController
    App --> RemoteTenantController
    App --> CacheController
    RISController --> RISModel
    RISController --> Response
    RemoteTenantController --> TenantDBInfo
    RemoteTenantController --> Response
</div>

<h3 id="2-client-side-class-hierarchy">2. Client-Side Class Hierarchy</h3>
<div class="mermaid">
classDiagram
    class App {
        +Router mux.Router
        +ConfigObject config.ConfigStruct
        +CLI client.Client
        +Initialize()
        +Run()
        +initializeRoutes()
        +risClient()
    }

    class TaskHandlerController {
        +RunTaskByHandler()
        +RunTask()
        +ADTestConnectivity()
    }

    class RISClientController {
        +CheckClientStatus()
        +GetInternalIP()
        +GetExternalIP()
        +DeployServices()
    }

    class RemoteConnectionController {
        +TestConnection()
        +ValidateCredentials()
    }

    class ServiceController {
        +ManageService()
        +CheckServiceStatus()
    }

    class TaskHandlerRequest {
        +string Method
        +string REST
        +string Port
        +string BaseURL
        +BuildAndExecuteTask()
    }

    class TaskRequest {
        +string Method
        +string RestURL
        +string RequestHeaders
        +byte[] Data
        +ExecuteTask()
    }

    class ClientInfo {
        +string ClientHost
        +string UniqueClientID
        +string ConnectionStatus
    }

    class ClientStatus {
        +string Status
        +string Version
        +int64 Timestamp
    }

    class Response {
        +bool Success
        +interface Data
        +string Error
        +string DisplayMessage
    }

    App --> TaskHandlerController
    App --> RISClientController
    App --> RemoteConnectionController
    App --> ServiceController
    TaskHandlerController --> TaskHandlerRequest
    TaskHandlerController --> TaskRequest
    TaskHandlerController --> Response
    RISClientController --> ClientInfo
    RISClientController --> ClientStatus
    RISClientController --> Response
</div>

<h2 id="database-design">Database Design</h2>
<h3 id="1-mongodb-collections-schema">1. MongoDB Collections Schema</h3>
<h4 id="ris-collection-riscollection">RIS Collection (<code>risCollection</code>)</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Auto-increment ID</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                  </span><span class="c1">// RIS client name</span>
<span class="w">    </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">           </span><span class="c1">// Description</span>
<span class="w">    </span><span class="s2">&quot;host&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                  </span><span class="c1">// Client host URL</span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                </span><span class="c1">// active/inactive/deleted</span>
<span class="w">    </span><span class="s2">&quot;connection_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">     </span><span class="c1">// connected/disconnected/created</span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">,</span><span class="w">       </span><span class="c1">// Creation timestamp</span>
<span class="w">    </span><span class="s2">&quot;updateddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">,</span><span class="w">       </span><span class="c1">// Last update timestamp</span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">               </span><span class="c1">// RIS client version</span>
<span class="w">    </span><span class="s2">&quot;unique_client_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">      </span><span class="c1">// UUID for client identification</span>
<span class="w">    </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="w">             </span><span class="c1">// Associated tenant code</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="tenants-collection-tenantscollection">Tenants Collection (<code>tenantsCollection</code>)</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Tenant ID</span>
<span class="w">    </span><span class="s2">&quot;db_name&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">               </span><span class="c1">// Database name</span>
<span class="w">    </span><span class="s2">&quot;db_username&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">           </span><span class="c1">// Database username</span>
<span class="w">    </span><span class="s2">&quot;db_password&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">           </span><span class="c1">// Database password</span>
<span class="w">    </span><span class="s2">&quot;db_host&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">               </span><span class="c1">// Database host</span>
<span class="w">    </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">            </span><span class="c1">// Tenant code</span>
<span class="w">    </span><span class="s2">&quot;unique_client_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">      </span><span class="c1">// UUID</span>
<span class="w">    </span><span class="s2">&quot;connection_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">     </span><span class="c1">// Connection status</span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                </span><span class="c1">// Tenant status</span>
<span class="w">    </span><span class="s2">&quot;host_type&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">             </span><span class="c1">// local/remote</span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">,</span><span class="w">       </span><span class="c1">// Creation timestamp</span>
<span class="w">    </span><span class="s2">&quot;updateddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="w">        </span><span class="c1">// Update timestamp</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="active-instances-collection-mongoactiveinstancecollection">Active Instances Collection (<code>mongoActiveInstanceCollection</code>)</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;instance_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">,</span><span class="w">       </span><span class="c1">// Instance identifier</span>
<span class="w">    </span><span class="s2">&quot;integration_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">,</span><span class="w">    </span><span class="c1">// Integration type ID</span>
<span class="w">    </span><span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                 </span><span class="c1">// Instance title</span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                </span><span class="c1">// active/inactive</span>
<span class="w">    </span><span class="s2">&quot;base_url&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">              </span><span class="c1">// Service base URL</span>
<span class="w">    </span><span class="s2">&quot;uuid&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">                  </span><span class="c1">// Associated RIS client UUID</span>
<span class="w">    </span><span class="s2">&quot;credentials_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">Number</span><span class="p">,</span><span class="w">        </span><span class="c1">// Credentials reference</span>
<span class="w">    </span><span class="s2">&quot;customapp&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">Boolean</span><span class="p">,</span><span class="w">            </span><span class="c1">// Custom application flag</span>
<span class="w">    </span><span class="s2">&quot;instance_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w">       </span><span class="c1">// Runtime status</span>
<span class="w">    </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">String</span><span class="w">             </span><span class="c1">// Tenant association</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-index-strategy">2. Index Strategy</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// RIS Collection Indexes</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">ris</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;unique_client_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">ris</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;connection_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">ris</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>

<span class="c1">// Tenants Collection Indexes</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">tenants</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;unique_client_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">tenants</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">tenants</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;connection_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>

<span class="c1">// Active Instances Collection Indexes</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">active_instances</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;uuid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">active_instances</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;instance_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">active_instances</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span>
</code></pre></div>

<h2 id="api-specifications">API Specifications</h2>
<h3 id="1-server-rest-api-endpoints">1. Server REST API Endpoints</h3>
<h4 id="ris-management-apis">RIS Management APIs</h4>
<div class="highlight"><pre><span></span><code>GET    /platform/v1/ris                     // Get all RIS clients
POST   /platform/v1/ris                     // Add new RIS client
PUT    /platform/v1/ris                     // Update RIS client
DELETE /platform/v1/ris                     // Delete RIS client

GET    /platform/v1/risclient/{ris-id}/{host-name}  // Get RIS config data
GET    /internal/v1/risclient/{ris-uuid}             // Get single RIS client
GET    /internal/v1/dockertag                        // Get Docker tag info
</code></pre></div>

<h4 id="tenant-management-apis">Tenant Management APIs</h4>
<div class="highlight"><pre><span></span><code>GET    /internal/v1/remotetenantclient/{tenant-uuid}          // Get tenant client
GET    /platform/v1/remotetenantconfigdata/{tenant-id}/{hostname}  // Get tenant config
</code></pre></div>

<h4 id="websocket-endpoints">WebSocket Endpoints</h4>
<div class="highlight"><pre><span></span><code>WS     /pingpong                            // RIS client connection
WS     /pingpongdbdetails                   // Tenant DB connection
</code></pre></div>

<h3 id="2-client-rest-api-endpoints">2. Client REST API Endpoints</h3>
<h4 id="task-execution-apis">Task Execution APIs</h4>
<div class="highlight"><pre><span></span><code>POST   /runtaskbyhandler/                   // Execute task via handler
POST   /runtask/                            // Execute third-party task
POST   /adtestconnectivity/                 // Test AD connectivity
</code></pre></div>

<h4 id="service-management-apis">Service Management APIs</h4>
<div class="highlight"><pre><span></span><code>POST   /remoteconnection/                   // Remote connection test
POST   /manageservices/                     // Docker service management
GET    /test/                               // Health check endpoint
</code></pre></div>

<h3 id="3-requestresponse-specifications">3. Request/Response Specifications</h3>
<h4 id="ris-client-registration-request">RIS Client Registration Request</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;clienthost&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;unique_client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid-string&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;connection_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;connected&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isfirstping&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;serverhost&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;server.example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;host_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;private&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isnetworkchanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tenantcode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tenant1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ris_nat_ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10.0.0.100&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="task-execution-request">Task Execution Request</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;resturl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.example.com/endpoint&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;Content-Type\&quot;: \&quot;application/json\&quot;}&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;base64-encoded-data&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;authtype&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;bearertoken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jwt-token&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cookies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="standard-response-format">Standard Response Format</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;displaymessage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;errorpath&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;sessionexpired&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cookies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="w">    </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="websocket-protocol-design">WebSocket Protocol Design</h2>
<h3 id="1-connection-lifecycle">1. Connection Lifecycle</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Connection establishment</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">liveWebSockets</span><span class="p">(</span><span class="nx">socketConnection</span><span class="w"> </span><span class="o">*</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span>
<span class="w">                            </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span>
<span class="w">                            </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">clientInfo</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ClientInfo</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">messageMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="nx">hostSavedMap</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">socketConnection</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// Handle disconnection cleanup</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// Message processing loop</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">socketConnection</span><span class="p">.</span><span class="nx">ReadMessage</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Process client information</span>
<span class="w">        </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">clientInfo</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Handle different message types</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">clientInfo</span><span class="p">.</span><span class="nx">IsNetworkChanged</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// Handle network change</span>
<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="c1">// Regular processing</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Send response</span>
<span class="w">        </span><span class="nx">socketConnection</span><span class="p">.</span><span class="nx">WriteMessage</span><span class="p">(</span><span class="nx">websocket</span><span class="p">.</span><span class="nx">TextMessage</span><span class="p">,</span><span class="w"> </span><span class="nx">responseBytes</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-message-types-and-formats">2. Message Types and Formats</h3>
<h4 id="client-registration-message">Client Registration Message</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;clienthost&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;client-ip&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;unique_client_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;client-uuid&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;connection_status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;connected&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isfirstping&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;host_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;private|public|ris_nat_ip&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;isnetworkchanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="server-response-messages">Server Response Messages</h4>
<ul>
<li><code>"pong"</code> - Normal acknowledgment</li>
<li><code>"private ip not reachable"</code> - Network connectivity issue</li>
<li><code>"client not reachable"</code> - Client unreachable</li>
<li><code>"ris nat ip not reachable"</code> - NAT IP connectivity issue</li>
</ul>
<h3 id="3-connection-management">3. Connection Management</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Connection tracking</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ConnectionManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">DisconnectedRISClients</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="w">    </span><span class="nx">RISClientsResponse</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="w">    </span><span class="nx">MapMutex</span><span class="w">               </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">SetDisconnectedRISClientsCount</span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">MapMutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">MapMutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">DisconnectedRISClients</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">count</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">ConnectionManager</span><span class="p">)</span><span class="w"> </span><span class="nx">GetDisconnectedRISClientsCount</span><span class="p">(</span><span class="nx">uuid</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">MapMutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">MapMutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">DisconnectedRISClients</span><span class="p">[</span><span class="nx">uuid</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="task-execution-framework">Task Execution Framework</h2>
<h3 id="1-task-types-and-processing">1. Task Types and Processing</h3>
<h4 id="task-handler-request-processing">Task Handler Request Processing</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">tc</span><span class="w"> </span><span class="nx">TaskHandlerController</span><span class="p">)</span><span class="w"> </span><span class="nx">RunTaskByHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">taskrequest</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskHandlerRequest</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span>

<span class="w">    </span><span class="c1">// Decode request</span>
<span class="w">    </span><span class="nx">decoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">decoder</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">taskrequest</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Execute task</span>
<span class="w">    </span><span class="nx">responseData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">taskrequest</span><span class="p">.</span><span class="nx">BuildAndExecuteTask</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Process response</span>
<span class="w">    </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">responseData</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">response</span><span class="p">)</span>
<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="task-execution-implementation">Task Execution Implementation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">taskRequest</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskHandlerRequest</span><span class="p">)</span><span class="w"> </span><span class="nx">BuildAndExecuteTask</span><span class="p">()</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="nx">restURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">BaseURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                  </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">REST</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Params</span>
<span class="w">        </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">SecuraaHTTPRequest</span><span class="p">(</span><span class="nx">restURL</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">AccessToken</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">JwtToken</span><span class="p">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PUT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DELETE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;PATCH&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="nx">restURL</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">BaseURL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                  </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">REST</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">        </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">SecuraaHTTPRequest</span><span class="p">(</span><span class="nx">restURL</span><span class="p">,</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span><span class="w"> </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">AccessToken</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nx">taskRequest</span><span class="p">.</span><span class="nx">JwtToken</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-service-management">2. Service Management</h3>
<h4 id="docker-service-management">Docker Service Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rc</span><span class="w"> </span><span class="nx">RISClientController</span><span class="p">)</span><span class="w"> </span><span class="nx">IsServiceRunning</span><span class="p">(</span><span class="nx">cli</span><span class="w"> </span><span class="o">*</span><span class="nx">client</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                             </span><span class="nx">serviceName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">serviceList</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cli</span><span class="p">.</span><span class="nx">ServiceList</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span>
<span class="w">                                       </span><span class="nx">types</span><span class="p">.</span><span class="nx">ServiceListOptions</span><span class="p">{})</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">service</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">serviceList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Spec</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">serviceName</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="error-handling-and-logging">Error Handling and Logging</h2>
<h3 id="1-error-handling-strategy">1. Error Handling Strategy</h3>
<h4 id="standardized-error-response">Standardized Error Response</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">()</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">message</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">ErrorPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">getCallerInfo</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="error-categories">Error Categories</h4>
<ol>
<li><strong>Network Errors</strong>: Connection timeouts, unreachable hosts</li>
<li><strong>Authentication Errors</strong>: Invalid tokens, expired sessions</li>
<li><strong>Authorization Errors</strong>: Insufficient permissions</li>
<li><strong>Validation Errors</strong>: Invalid input data</li>
<li><strong>System Errors</strong>: Database connection issues, service unavailable</li>
</ol>
<h3 id="2-logging-implementation">2. Logging Implementation</h3>
<h4 id="structured-logging">Structured Logging</h4>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;component_name&quot;</span><span class="p">)</span>

<span class="c1">// Log levels and usage</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="s">&quot;Debug information&quot;</span><span class="p">)</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Informational message&quot;</span><span class="p">)</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error message with context&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
</code></pre></div>

<h4 id="log-rotation-and-management">Log Rotation and Management</h4>
<ul>
<li>File-based logging with automatic rotation</li>
<li>Configurable log levels per component</li>
<li>Centralized log aggregation support</li>
<li>Security-aware logging (password masking)</li>
</ul>
<h2 id="configuration-management">Configuration Management</h2>
<h3 id="1-configuration-structure">1. Configuration Structure</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ConfigStruct</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ServerHost</span><span class="w">         </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">MongoDBHost</span><span class="w">        </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">ElasticSearchHost</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">LoggingPath</span><span class="w">        </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">CertFile</span><span class="w">           </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">KeyFile</span><span class="w">            </span><span class="kt">string</span>
<span class="w">    </span><span class="c1">// ... additional configuration fields</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-dynamic-configuration-updates">2. Dynamic Configuration Updates</h3>
<h4 id="configuration-hot-reload">Configuration Hot-reload</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">reloadConfiguration</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">newConfig</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">InitConfig</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">validateConfig</span><span class="p">(</span><span class="nx">newConfig</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newConfig</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;invalid configuration&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="security-implementation-framework">Security Implementation Framework</h2>
<h3 id="1-comprehensive-tls-configuration">1. Comprehensive TLS Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// TLS Configuration with Advanced Security Parameters</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">configureTLS</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Config</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cert</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tls</span><span class="p">.</span><span class="nx">LoadX509KeyPair</span><span class="p">(</span><span class="s">&quot;ssl/certs/securaa_server.crt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ssl/private/securaa_server.key&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;Failed to load TLS certificates:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Load CA certificate for client verification</span>
<span class="w">    </span><span class="nx">caCert</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="s">&quot;ssl/certs/securaa-ca.pem&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;Failed to load CA certificate:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">caCertPool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">x509</span><span class="p">.</span><span class="nx">NewCertPool</span><span class="p">()</span>
<span class="w">    </span><span class="nx">caCertPool</span><span class="p">.</span><span class="nx">AppendCertsFromPEM</span><span class="p">(</span><span class="nx">caCert</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Certificates</span><span class="p">:</span><span class="w">             </span><span class="p">[]</span><span class="nx">tls</span><span class="p">.</span><span class="nx">Certificate</span><span class="p">{</span><span class="nx">cert</span><span class="p">},</span>
<span class="w">        </span><span class="nx">ClientAuth</span><span class="p">:</span><span class="w">               </span><span class="nx">tls</span><span class="p">.</span><span class="nx">RequireAndVerifyClientCert</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ClientCAs</span><span class="p">:</span><span class="w">                </span><span class="nx">caCertPool</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MinVersion</span><span class="p">:</span><span class="w">               </span><span class="nx">tls</span><span class="p">.</span><span class="nx">VersionTLS12</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MaxVersion</span><span class="p">:</span><span class="w">               </span><span class="nx">tls</span><span class="p">.</span><span class="nx">VersionTLS13</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PreferServerCipherSuites</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">CipherSuites</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">uint16</span><span class="p">{</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_AES_256_GCM_SHA384</span><span class="p">,</span><span class="w">           </span><span class="c1">// TLS 1.3</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_CHACHA20_POLY1305_SHA256</span><span class="p">,</span><span class="w">      </span><span class="c1">// TLS 1.3</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_AES_128_GCM_SHA256</span><span class="p">,</span><span class="w">           </span><span class="c1">// TLS 1.3</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</span><span class="p">,</span><span class="w">    </span><span class="c1">// TLS 1.2</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305</span><span class="p">,</span><span class="w">     </span><span class="c1">// TLS 1.2</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="p">,</span><span class="w">    </span><span class="c1">// TLS 1.2</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">CurvePreferences</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="nx">tls</span><span class="p">.</span><span class="nx">CurveID</span><span class="p">{</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">X25519</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">CurveP256</span><span class="p">,</span>
<span class="w">            </span><span class="nx">tls</span><span class="p">.</span><span class="nx">CurveP384</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">SessionTicketsDisabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">InsecureSkipVerify</span><span class="p">:</span><span class="w">     </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ServerName</span><span class="p">:</span><span class="w">             </span><span class="s">&quot;securaa-ris-server&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// WebSocket TLS Upgrader with Security Headers</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">createSecureWebSocketUpgrader</span><span class="p">()</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Upgrader</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">websocket</span><span class="p">.</span><span class="nx">Upgrader</span><span class="p">{</span>
<span class="w">        </span><span class="nx">ReadBufferSize</span><span class="p">:</span><span class="w">    </span><span class="mi">4096</span><span class="p">,</span>
<span class="w">        </span><span class="nx">WriteBufferSize</span><span class="p">:</span><span class="w">   </span><span class="mi">4096</span><span class="p">,</span>
<span class="w">        </span><span class="nx">EnableCompression</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nx">CheckOrigin</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">origin</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Origin&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">isAllowedOrigin</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">Subprotocols</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;securaa-ris-protocol&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nx">Error</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;WebSocket error: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Sec-WebSocket-Version&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;13&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusText</span><span class="p">(</span><span class="nx">status</span><span class="p">),</span><span class="w"> </span><span class="nx">status</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-advanced-authentication-and-authorization-framework">2. Advanced Authentication and Authorization Framework</h3>
<h4 id="multi-factor-jwt-token-validation">Multi-Factor JWT Token Validation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">JWTClaims</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">      </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">TenantID</span><span class="w">    </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;tenant_id&quot;`</span>
<span class="w">    </span><span class="nx">Role</span><span class="w">        </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;role&quot;`</span>
<span class="w">    </span><span class="nx">Permissions</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="w">  </span><span class="s">`json:&quot;permissions&quot;`</span>
<span class="w">    </span><span class="nx">IssuedAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;iat&quot;`</span>
<span class="w">    </span><span class="nx">ExpiresAt</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;exp&quot;`</span>
<span class="w">    </span><span class="nx">Issuer</span><span class="w">      </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;iss&quot;`</span>
<span class="w">    </span><span class="nx">Subject</span><span class="w">     </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;sub&quot;`</span>
<span class="w">    </span><span class="nx">SessionID</span><span class="w">   </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;session_id&quot;`</span>
<span class="w">    </span><span class="nx">DeviceID</span><span class="w">    </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;device_id&quot;`</span>
<span class="w">    </span><span class="nx">IPAddress</span><span class="w">   </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;ip_address&quot;`</span>
<span class="w">    </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">StandardClaims</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">validateJWTToken</span><span class="p">(</span><span class="nx">tokenString</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">JWTClaims</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Parse JWT token with validation</span>
<span class="w">    </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">ParseWithClaims</span><span class="p">(</span><span class="nx">tokenString</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">JWTClaims</span><span class="p">{},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="o">*</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Validate signing method</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">Method</span><span class="p">.(</span><span class="o">*</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">SigningMethodRSA</span><span class="p">);</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;unexpected signing method: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">Header</span><span class="p">[</span><span class="s">&quot;alg&quot;</span><span class="p">])</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Load public key for verification</span>
<span class="w">        </span><span class="nx">publicKey</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">loadRSAPublicKey</span><span class="p">(</span><span class="nx">configObject</span><span class="p">.</span><span class="nx">JWTPublicKeyPath</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to load public key: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">publicKey</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;token parsing failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">claims</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">token</span><span class="p">.</span><span class="nx">Claims</span><span class="p">.(</span><span class="o">*</span><span class="nx">JWTClaims</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">Valid</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid token claims&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Additional validation checks</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">validateTokenClaims</span><span class="p">(</span><span class="nx">claims</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;token validation failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check token blacklist</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">isTokenBlacklisted</span><span class="p">(</span><span class="nx">claims</span><span class="p">.</span><span class="nx">SessionID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;token has been revoked&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Verify IP address binding (if enabled)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">configObject</span><span class="p">.</span><span class="nx">EnableIPBinding</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">claims</span><span class="p">.</span><span class="nx">IPAddress</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">getClientIP</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;token IP address mismatch&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">claims</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Comprehensive Role-Based Access Control</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Permission</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Resource</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;resource&quot;`</span>
<span class="w">    </span><span class="nx">Action</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;action&quot;`</span>
<span class="w">    </span><span class="nx">Scope</span><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;scope&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Role</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span><span class="w">       </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Permissions</span><span class="w"> </span><span class="p">[]</span><span class="nx">Permission</span><span class="w"> </span><span class="s">`json:&quot;permissions&quot;`</span>
<span class="w">    </span><span class="nx">Inherits</span><span class="w">    </span><span class="p">[]</span><span class="kt">string</span><span class="w">     </span><span class="s">`json:&quot;inherits&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">checkPermissions</span><span class="p">(</span><span class="nx">userClaims</span><span class="w"> </span><span class="o">*</span><span class="nx">JWTClaims</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Load user role and permissions</span>
<span class="w">    </span><span class="nx">userRole</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getUserRole</span><span class="p">(</span><span class="nx">userClaims</span><span class="p">.</span><span class="nx">Role</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">userRole</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check direct permissions</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">hasDirectPermission</span><span class="p">(</span><span class="nx">userRole</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check inherited permissions</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">inheritedRoleName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">userRole</span><span class="p">.</span><span class="nx">Inherits</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">inheritedRole</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getUserRole</span><span class="p">(</span><span class="nx">inheritedRoleName</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">inheritedRole</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">hasDirectPermission</span><span class="p">(</span><span class="nx">inheritedRole</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check tenant-specific permissions</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">userClaims</span><span class="p">.</span><span class="nx">TenantID</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">hasTenantPermission</span><span class="p">(</span><span class="nx">userClaims</span><span class="p">.</span><span class="nx">TenantID</span><span class="p">,</span><span class="w"> </span><span class="nx">userClaims</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">resource</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="c1">// Multi-Tenant Security Context</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">createSecurityContext</span><span class="p">(</span><span class="nx">claims</span><span class="w"> </span><span class="o">*</span><span class="nx">JWTClaims</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">SecurityContext</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SecurityContext</span><span class="p">{</span>
<span class="w">        </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="nx">claims</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">TenantID</span><span class="p">:</span><span class="w">    </span><span class="nx">claims</span><span class="p">.</span><span class="nx">TenantID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Role</span><span class="p">:</span><span class="w">        </span><span class="nx">claims</span><span class="p">.</span><span class="nx">Role</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Permissions</span><span class="p">:</span><span class="w"> </span><span class="nx">claims</span><span class="p">.</span><span class="nx">Permissions</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SessionID</span><span class="p">:</span><span class="w">   </span><span class="nx">claims</span><span class="p">.</span><span class="nx">SessionID</span><span class="p">,</span>
<span class="w">        </span><span class="nx">IPAddress</span><span class="p">:</span><span class="w">   </span><span class="nx">getClientIP</span><span class="p">(</span><span class="nx">request</span><span class="p">),</span>
<span class="w">        </span><span class="nx">UserAgent</span><span class="p">:</span><span class="w">   </span><span class="nx">request</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;User-Agent&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">RequestID</span><span class="p">:</span><span class="w">   </span><span class="nx">generateRequestID</span><span class="p">(),</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="3-encryption-and-data-protection">3. Encryption and Data Protection</h3>
<h4 id="end-to-end-data-encryption">End-to-End Data Encryption</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">EncryptionService</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">masterKey</span><span class="w">    </span><span class="p">[]</span><span class="kt">byte</span>
<span class="w">    </span><span class="nx">keyDerivation</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">cipher</span><span class="w">       </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewEncryptionService</span><span class="p">(</span><span class="nx">masterKey</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">EncryptionService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">EncryptionService</span><span class="p">{</span>
<span class="w">        </span><span class="nx">masterKey</span><span class="p">:</span><span class="w">     </span><span class="nx">masterKey</span><span class="p">,</span>
<span class="w">        </span><span class="nx">keyDerivation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PBKDF2&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">cipher</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;AES-256-GCM&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">es</span><span class="w"> </span><span class="o">*</span><span class="nx">EncryptionService</span><span class="p">)</span><span class="w"> </span><span class="nx">EncryptData</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Derive tenant-specific key</span>
<span class="w">    </span><span class="nx">tenantKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">es</span><span class="p">.</span><span class="nx">deriveTenantKey</span><span class="p">(</span><span class="nx">tenantID</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Generate random nonce</span>
<span class="w">    </span><span class="nx">nonce</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadFull</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create AES-GCM cipher</span>
<span class="w">    </span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">aes</span><span class="p">.</span><span class="nx">NewCipher</span><span class="p">(</span><span class="nx">tenantKey</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">gcm</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">NewGCM</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Encrypt data</span>
<span class="w">    </span><span class="nx">ciphertext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">Seal</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Combine nonce and ciphertext</span>
<span class="w">    </span><span class="nx">encrypted</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="o">...</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encrypted</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">es</span><span class="w"> </span><span class="o">*</span><span class="nx">EncryptionService</span><span class="p">)</span><span class="w"> </span><span class="nx">DecryptData</span><span class="p">(</span><span class="nx">encryptedData</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;invalid encrypted data&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract nonce and ciphertext</span>
<span class="w">    </span><span class="nx">nonce</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">encryptedData</span><span class="p">[:</span><span class="mi">12</span><span class="p">]</span>
<span class="w">    </span><span class="nx">ciphertext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">encryptedData</span><span class="p">[</span><span class="mi">12</span><span class="p">:]</span>

<span class="w">    </span><span class="c1">// Derive tenant-specific key</span>
<span class="w">    </span><span class="nx">tenantKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">es</span><span class="p">.</span><span class="nx">deriveTenantKey</span><span class="p">(</span><span class="nx">tenantID</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Create AES-GCM cipher</span>
<span class="w">    </span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">aes</span><span class="p">.</span><span class="nx">NewCipher</span><span class="p">(</span><span class="nx">tenantKey</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">gcm</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">NewGCM</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Decrypt data</span>
<span class="w">    </span><span class="nx">plaintext</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">plaintext</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Field-Level Database Encryption</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">es</span><span class="w"> </span><span class="o">*</span><span class="nx">EncryptionService</span><span class="p">)</span><span class="w"> </span><span class="nx">EncryptField</span><span class="p">(</span><span class="nx">field</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">tenantID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Serialize value</span>
<span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Encrypt data</span>
<span class="w">    </span><span class="nx">encrypted</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">es</span><span class="p">.</span><span class="nx">EncryptData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantID</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Encode to base64</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">base64</span><span class="p">.</span><span class="nx">StdEncoding</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">encrypted</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="4-security-monitoring-and-audit-system">4. Security Monitoring and Audit System</h3>
<h4 id="comprehensive-audit-logging">Comprehensive Audit Logging</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">AuditEvent</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">EventID</span><span class="w">     </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;event_id&quot;`</span>
<span class="w">    </span><span class="nx">Timestamp</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">             </span><span class="s">`json:&quot;timestamp&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">      </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">TenantID</span><span class="w">    </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;tenant_id&quot;`</span>
<span class="w">    </span><span class="nx">Action</span><span class="w">      </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;action&quot;`</span>
<span class="w">    </span><span class="nx">Resource</span><span class="w">    </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;resource&quot;`</span>
<span class="w">    </span><span class="nx">IPAddress</span><span class="w">   </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;ip_address&quot;`</span>
<span class="w">    </span><span class="nx">UserAgent</span><span class="w">   </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;user_agent&quot;`</span>
<span class="w">    </span><span class="nx">SessionID</span><span class="w">   </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;session_id&quot;`</span>
<span class="w">    </span><span class="nx">Result</span><span class="w">      </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;result&quot;`</span>
<span class="w">    </span><span class="nx">ErrorCode</span><span class="w">   </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;error_code,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Details</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;details&quot;`</span>
<span class="w">    </span><span class="nx">Severity</span><span class="w">    </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;severity&quot;`</span>
<span class="w">    </span><span class="nx">Category</span><span class="w">    </span><span class="kt">string</span><span class="w">                </span><span class="s">`json:&quot;category&quot;`</span>
<span class="w">    </span><span class="nx">Compliance</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;compliance_tags&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AuditLogger</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">database</span><span class="w">     </span><span class="o">*</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Database</span>
<span class="w">    </span><span class="nx">encryption</span><span class="w">   </span><span class="o">*</span><span class="nx">EncryptionService</span>
<span class="w">    </span><span class="nx">retention</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="w">    </span><span class="nx">complianceMode</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">al</span><span class="w"> </span><span class="o">*</span><span class="nx">AuditLogger</span><span class="p">)</span><span class="w"> </span><span class="nx">LogSecurityEvent</span><span class="p">(</span><span class="nx">event</span><span class="w"> </span><span class="o">*</span><span class="nx">AuditEvent</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Add automatic fields</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">EventID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">generateEventID</span><span class="p">()</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">Timestamp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UTC</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Encrypt sensitive data</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">encryption</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">encryptSensitiveFields</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to encrypt audit data: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Add compliance tags</span>
<span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">Compliance</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">getComplianceTags</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Store in database</span>
<span class="w">    </span><span class="nx">collection</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">database</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="s">&quot;audit_logs&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">InsertOne</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">event</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to store audit event: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Real-time security monitoring</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">isHighRiskEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">al</span><span class="p">.</span><span class="nx">triggerSecurityAlert</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Real-time Security Monitoring</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SecurityMonitor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">alertThresholds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="w">    </span><span class="nx">timeWindows</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="w">    </span><span class="nx">alerter</span><span class="w">         </span><span class="o">*</span><span class="nx">AlertManager</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">sm</span><span class="w"> </span><span class="o">*</span><span class="nx">SecurityMonitor</span><span class="p">)</span><span class="w"> </span><span class="nx">MonitorSecurityEvents</span><span class="p">(</span><span class="nx">events</span><span class="w"> </span><span class="o">&lt;-</span><span class="kd">chan</span><span class="w"> </span><span class="o">*</span><span class="nx">AuditEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">eventCounts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Track event patterns</span>
<span class="w">        </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s:%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">Action</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">IPAddress</span><span class="p">)</span>
<span class="w">        </span><span class="nx">eventCounts</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">++</span>

<span class="w">        </span><span class="c1">// Check for suspicious patterns</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">sm</span><span class="p">.</span><span class="nx">detectSuspiciousActivity</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="w"> </span><span class="nx">eventCounts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">alert</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SecurityAlert</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Type</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;SUSPICIOUS_ACTIVITY&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Severity</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;HIGH&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Multiple failed authentication attempts detected&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="nx">event</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span>
<span class="w">                </span><span class="nx">IPAddress</span><span class="p">:</span><span class="w">   </span><span class="nx">event</span><span class="p">.</span><span class="nx">IPAddress</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">                </span><span class="nx">Events</span><span class="p">:</span><span class="w">      </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="nx">event</span><span class="p">.</span><span class="nx">EventID</span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">sm</span><span class="p">.</span><span class="nx">alerter</span><span class="p">.</span><span class="nx">SendAlert</span><span class="p">(</span><span class="nx">alert</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Check for compliance violations</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">sm</span><span class="p">.</span><span class="nx">detectComplianceViolation</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">alert</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SecurityAlert</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Type</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;COMPLIANCE_VIOLATION&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Severity</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;CRITICAL&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Data access violation detected&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="nx">event</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span>
<span class="w">                </span><span class="nx">TenantID</span><span class="p">:</span><span class="w">    </span><span class="nx">event</span><span class="p">.</span><span class="nx">TenantID</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">                </span><span class="nx">Events</span><span class="p">:</span><span class="w">      </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="nx">event</span><span class="p">.</span><span class="nx">EventID</span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">sm</span><span class="p">.</span><span class="nx">alerter</span><span class="p">.</span><span class="nx">SendAlert</span><span class="p">(</span><span class="nx">alert</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="5-network-security-and-rate-limiting">5. Network Security and Rate Limiting</h3>
<h4 id="advanced-rate-limiting-with-redis">Advanced Rate Limiting with Redis</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">RateLimiter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">redis</span><span class="w">       </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span>
<span class="w">    </span><span class="nx">limits</span><span class="w">      </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">RateLimit</span>
<span class="w">    </span><span class="nx">defaultRate</span><span class="w"> </span><span class="nx">RateLimit</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">RateLimit</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Requests</span><span class="w"> </span><span class="kt">int</span><span class="w">           </span><span class="s">`json:&quot;requests&quot;`</span>
<span class="w">    </span><span class="nx">Window</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span><span class="s">`json:&quot;window&quot;`</span>
<span class="w">    </span><span class="nx">Burst</span><span class="w">    </span><span class="kt">int</span><span class="w">           </span><span class="s">`json:&quot;burst&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rl</span><span class="w"> </span><span class="o">*</span><span class="nx">RateLimiter</span><span class="p">)</span><span class="w"> </span><span class="nx">CheckRateLimit</span><span class="p">(</span><span class="nx">identifier</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;rate_limit:%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">identifier</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Get rate limit configuration</span>
<span class="w">    </span><span class="nx">limit</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rl</span><span class="p">.</span><span class="nx">getLimitForAction</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Use sliding window log algorithm</span>
<span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
<span class="w">    </span><span class="nx">windowStart</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nx">limit</span><span class="p">.</span><span class="nx">Window</span><span class="p">.</span><span class="nx">Seconds</span><span class="p">())</span>

<span class="w">    </span><span class="nx">pipe</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rl</span><span class="p">.</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Pipeline</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Remove expired entries</span>
<span class="w">    </span><span class="nx">pipe</span><span class="p">.</span><span class="nx">ZRemRangeByScore</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">windowStart</span><span class="p">))</span>

<span class="w">    </span><span class="c1">// Count current requests</span>
<span class="w">    </span><span class="nx">pipe</span><span class="p">.</span><span class="nx">ZCard</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Add current request</span>
<span class="w">    </span><span class="nx">pipe</span><span class="p">.</span><span class="nx">ZAdd</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Z</span><span class="p">{</span><span class="nx">Score</span><span class="p">:</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">now</span><span class="p">),</span><span class="w"> </span><span class="nx">Member</span><span class="p">:</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">now</span><span class="p">)})</span>

<span class="w">    </span><span class="c1">// Set expiration</span>
<span class="w">    </span><span class="nx">pipe</span><span class="p">.</span><span class="nx">Expire</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">.</span><span class="nx">Window</span><span class="p">)</span>

<span class="w">    </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pipe</span><span class="p">.</span><span class="nx">Exec</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">currentCount</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">].(</span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">IntCmd</span><span class="p">).</span><span class="nx">Val</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Check if rate limit exceeded</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">currentCount</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">limit</span><span class="p">.</span><span class="nx">Requests</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Check burst allowance</span>
<span class="w">        </span><span class="nx">burstKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;burst:%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">identifier</span><span class="p">,</span><span class="w"> </span><span class="nx">action</span><span class="p">)</span>
<span class="w">        </span><span class="nx">burstCount</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rl</span><span class="p">.</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">burstKey</span><span class="p">).</span><span class="nx">Int</span><span class="p">()</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">burstCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">burstCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">limit</span><span class="p">.</span><span class="nx">Burst</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="c1">// Rate limit exceeded</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Allow burst request</span>
<span class="w">        </span><span class="nx">rl</span><span class="p">.</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Incr</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">burstKey</span><span class="p">)</span>
<span class="w">        </span><span class="nx">rl</span><span class="p">.</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Expire</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">burstKey</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// DDoS Protection Middleware</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rl</span><span class="w"> </span><span class="o">*</span><span class="nx">RateLimiter</span><span class="p">)</span><span class="w"> </span><span class="nx">DDoSProtectionMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clientIP</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getClientIP</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="w">        </span><span class="nx">userAgent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;User-Agent&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Check IP-based rate limiting</span>
<span class="w">        </span><span class="nx">allowed</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rl</span><span class="p">.</span><span class="nx">CheckRateLimit</span><span class="p">(</span><span class="nx">clientIP</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;global&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Internal Server Error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">allowed</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Log potential DDoS attack</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Rate limit exceeded for IP: %s, User-Agent: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">clientIP</span><span class="p">,</span><span class="w"> </span><span class="nx">userAgent</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// Add security headers</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Retry-After&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;60&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;X-RateLimit-Limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;100&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;X-RateLimit-Remaining&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="nx">http</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Too Many Requests&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusTooManyRequests</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Add rate limit headers</span>
<span class="w">        </span><span class="nx">remaining</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rl</span><span class="p">.</span><span class="nx">getRemainingRequests</span><span class="p">(</span><span class="nx">clientIP</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;global&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;X-RateLimit-Limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;100&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;X-RateLimit-Remaining&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">remaining</span><span class="p">))</span>

<span class="w">        </span><span class="nx">next</span><span class="p">.</span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="6-secure-configuration-management">6. Secure Configuration Management</h3>
<h4 id="configuration-security-framework">Configuration Security Framework</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">SecureConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">encrypted</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="w">    </span><span class="nx">plaintext</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">keyService</span><span class="w">   </span><span class="o">*</span><span class="nx">KeyManagementService</span>
<span class="w">    </span><span class="nx">validator</span><span class="w">    </span><span class="o">*</span><span class="nx">ConfigValidator</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">LoadSecureConfiguration</span><span class="p">(</span><span class="nx">configPath</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">keyService</span><span class="w"> </span><span class="o">*</span><span class="nx">KeyManagementService</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">SecureConfig</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">configData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">configPath</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">rawConfig</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">configData</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">rawConfig</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">SecureConfig</span><span class="p">{</span>
<span class="w">        </span><span class="nx">encrypted</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
<span class="w">        </span><span class="nx">plaintext</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}),</span>
<span class="w">        </span><span class="nx">keyService</span><span class="p">:</span><span class="w"> </span><span class="nx">keyService</span><span class="p">,</span>
<span class="w">        </span><span class="nx">validator</span><span class="p">:</span><span class="w">  </span><span class="nx">NewConfigValidator</span><span class="p">(),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process configuration fields</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">rawConfig</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">isSecretField</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Decrypt secret fields</span>
<span class="w">            </span><span class="nx">decrypted</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">keyService</span><span class="p">.</span><span class="nx">Decrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">.(</span><span class="kt">string</span><span class="p">))</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to decrypt %s: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">config</span><span class="p">.</span><span class="nx">encrypted</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">decrypted</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">config</span><span class="p">.</span><span class="nx">plaintext</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Validate configuration</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">Validate</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;configuration validation failed: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Environment-Based Security Profiles</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">SecurityProfile</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Environment</span><span class="w">       </span><span class="kt">string</span><span class="w">              </span><span class="s">`json:&quot;environment&quot;`</span>
<span class="w">    </span><span class="nx">TLSMinVersion</span><span class="w">     </span><span class="kt">uint16</span><span class="w">             </span><span class="s">`json:&quot;tls_min_version&quot;`</span>
<span class="w">    </span><span class="nx">RequireClientCert</span><span class="w"> </span><span class="kt">bool</span><span class="w">               </span><span class="s">`json:&quot;require_client_cert&quot;`</span>
<span class="w">    </span><span class="nx">SessionTimeout</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">      </span><span class="s">`json:&quot;session_timeout&quot;`</span>
<span class="w">    </span><span class="nx">PasswordPolicy</span><span class="w">    </span><span class="nx">PasswordPolicy</span><span class="w">     </span><span class="s">`json:&quot;password_policy&quot;`</span>
<span class="w">    </span><span class="nx">AuditLevel</span><span class="w">        </span><span class="kt">string</span><span class="w">             </span><span class="s">`json:&quot;audit_level&quot;`</span>
<span class="w">    </span><span class="nx">ComplianceMode</span><span class="w">    </span><span class="kt">bool</span><span class="w">               </span><span class="s">`json:&quot;compliance_mode&quot;`</span>
<span class="w">    </span><span class="nx">EncryptionStrength</span><span class="w"> </span><span class="kt">string</span><span class="w">            </span><span class="s">`json:&quot;encryption_strength&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">GetSecurityProfile</span><span class="p">(</span><span class="nx">environment</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">SecurityProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">profiles</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">SecurityProfile</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;production&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Environment</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;production&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">TLSMinVersion</span><span class="p">:</span><span class="w">     </span><span class="nx">tls</span><span class="p">.</span><span class="nx">VersionTLS13</span><span class="p">,</span>
<span class="w">            </span><span class="nx">RequireClientCert</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">SessionTimeout</span><span class="p">:</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">            </span><span class="nx">PasswordPolicy</span><span class="p">:</span><span class="w">    </span><span class="nx">StrictPasswordPolicy</span><span class="p">,</span>
<span class="w">            </span><span class="nx">AuditLevel</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;FULL&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">ComplianceMode</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">EncryptionStrength</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AES-256&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;development&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Environment</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;development&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">TLSMinVersion</span><span class="p">:</span><span class="w">     </span><span class="nx">tls</span><span class="p">.</span><span class="nx">VersionTLS12</span><span class="p">,</span>
<span class="w">            </span><span class="nx">RequireClientCert</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">SessionTimeout</span><span class="p">:</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span>
<span class="w">            </span><span class="nx">PasswordPolicy</span><span class="p">:</span><span class="w">    </span><span class="nx">BasicPasswordPolicy</span><span class="p">,</span>
<span class="w">            </span><span class="nx">AuditLevel</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;BASIC&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">ComplianceMode</span><span class="p">:</span><span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">EncryptionStrength</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;AES-128&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">profile</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">profiles</span><span class="p">[</span><span class="nx">environment</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">profile</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Default to production profile for unknown environments</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">profiles</span><span class="p">[</span><span class="s">&quot;production&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<p><em>Document Version: 2.0</em><br />
<em>Last Updated: October 6, 2025</em><br />
<em>Author: Development Team</em><br />
<em>Classification: Confidential - Internal Use Only</em></p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 18, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
