<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Securaa Custom Services - Low Level Design">
    <title>Securaa Custom Services - Low Level Design - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 04, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="low-level-design-low-level-design-securaa-custom-services">Low-Level Design (Low Level Design) - Securaa Custom Services<a class="headerlink" href="#low-level-design-low-level-design-securaa-custom-services" title="Permanent link">&para;</a></h1>
<h2 id="1-implementation-overview">1. Implementation Overview<a class="headerlink" href="#1-implementation-overview" title="Permanent link">&para;</a></h2>
<h3 id="11-technology-stack">1.1 Technology Stack<a class="headerlink" href="#11-technology-stack" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Language</strong>: Go 1.17</li>
<li><strong>Web Framework</strong>: Gorilla Mux</li>
<li><strong>Database</strong>: MongoDB with official Go driver</li>
<li><strong>Cache</strong>: Redis</li>
<li><strong>Authentication</strong>: JWT tokens with SAML integration</li>
<li><strong>Encryption</strong>: AES encryption for sensitive data</li>
<li><strong>Containerization</strong>: Docker</li>
<li><strong>Build System</strong>: Make with custom Makefile</li>
</ul>
<h3 id="12-project-structure-analysis">1.2 Project Structure Analysis<a class="headerlink" href="#12-project-structure-analysis" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code>zona_custom/
├── main.go                 # Application entry point
├── app.go                  # Application initialization and routing
├── go.mod                  # Go module dependencies
├── Dockerfile             # Container configuration
├── Makefile              # Build automation
├── constants/
│   └── constants.go       # Application constants
├── controllers/           # HTTP request handlers
│   ├── customAppController.go
│   ├── genericAppController.go
│   ├── exportController.go
│   ├── integrationController.go
│   └── eventsController.go
├── handlers/              # Error handling
│   └── errorHandler.go
├── models/                # Data structures
│   ├── Response.go
│   ├── export.go
│   ├── process.go
│   └── customtaskhandler.go
└── services/              # Business logic
    ├── exportservice.go
    ├── importservice.go
    ├── integrationservice.go
    └── eventsService.go
</code></pre>

<h2 id="2-detailed-component-design">2. Detailed Component Design<a class="headerlink" href="#2-detailed-component-design" title="Permanent link">&para;</a></h2>
<h3 id="21-application-bootstrap-maingo-appgo">2.1 Application Bootstrap (<code>main.go</code> &amp; <code>app.go</code>)<a class="headerlink" href="#21-application-bootstrap-maingo-appgo" title="Permanent link">&para;</a></h3>
<h4 id="211-main-function-flow">2.1.1 Main Function Flow<a class="headerlink" href="#211-main-function-flow" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func main() {
    securaalog.Init(&quot;CORE_SERVICE_LOGS&quot;)  // Initialize logging
    app := App{}                          // Create app instance
    app.Initialize()                      // Setup dependencies
    app.Run(&quot;:8063&quot;)                     // Start HTTP server
}
</code></pre>

<h4 id="212-app-structure-design">2.1.2 App Structure Design<a class="headerlink" href="#212-app-structure-design" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">type App struct {
    Router             *mux.Router                    // HTTP router
    AccessTokenHashMap map[string]int64               // Token cache
    DBSession          map[string]common.SessionStruct // DB connections
    ConfigObject       config.ConfigStruct           // Configuration
    BuildType          string                        // Deployment type
    RequestResponseLog bool                          // Logging flag
}
</code></pre>

<h4 id="213-initialization-sequence">2.1.3 Initialization Sequence<a class="headerlink" href="#213-initialization-sequence" title="Permanent link">&para;</a></h4>
<div class="mermaid">
sequenceDiagram
    participant Main
    participant App
    participant Config
    participant MongoDB
    participant Router
    participant Cache

    Main->>App: Initialize()
    App->>Config: InitConfig()
    Config-->>App: Configuration loaded
    App->>MongoDB: InitMongoClient()
    MongoDB-->>App: Database connections established
    App->>Router: initializeRoutes()
    Router-->>App: Routes configured
    App->>Cache: CacheHealthCheck()
    Cache-->>App: Cache initialized
    App-->>Main: Initialization complete
    Main->>App: Run(":8063")
    App->>Router: http.ListenAndServe()
</div>

<h3 id="22-database-connection-management">2.2 Database Connection Management<a class="headerlink" href="#22-database-connection-management" title="Permanent link">&para;</a></h3>
<h4 id="221-multi-tenant-connection-strategy">2.2.1 Multi-Tenant Connection Strategy<a class="headerlink" href="#221-multi-tenant-connection-strategy" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func (a *App) InitMongoClient(configObject config.ConfigStruct) {
    a.DBSession = make(map[string]common.SessionStruct)

    // Initialize core database connection
    mongoDbClient, err := mongo_driver.NewMongoClientWrapper(configObject, nil)
    clientStruct := common.SessionStruct{
        DBName: config[&quot;mongoDB&quot;],
        Client: mongoDbClient,
    }
    a.DBSession[&quot;localhost&quot;] = clientStruct

    // Initialize tenant-specific connections
    tenantsList, _ := utils.GetAllTenants2(mongoDbClient, configObject)
    for _, tenantData := range tenantsList {
        if a.BuildType == &quot;mssp&quot; &amp;&amp; tenantData.Status == &quot;active&quot; {
            // MSSP: Each tenant has separate database
            tenantDBClient, _ := mongo_driver.NewMongoClientWrapper(configObject, tenantData)
            clientStruct := common.SessionStruct{
                DBName: tenantDBClient.DBName,
                Client: tenantDBClient,
            }
            a.DBSession[tenantCode] = clientStruct
        } else {
            // Single tenant: Shared database with tenant isolation
            // Implementation for single-tenant architecture
        }
    }
}
</code></pre>

<h4 id="222-connection-pool-management">2.2.2 Connection Pool Management<a class="headerlink" href="#222-connection-pool-management" title="Permanent link">&para;</a></h4>
<div class="mermaid">
graph TB
    subgraph "Connection Pool Strategy"
        MAIN_POOL[Main Connection Pool<br/>localhost]
        TENANT1_POOL[Tenant 1 Pool<br/>tenant-1-db]
        TENANT2_POOL[Tenant 2 Pool<br/>tenant-2-db]
        TENANT_N_POOL[Tenant N Pool<br/>tenant-n-db]
    end

    subgraph "Pool Configuration"
        MIN_CONN[Min Connections: 5]
        MAX_CONN[Max Connections: 100]
        IDLE_TIMEOUT[Idle Timeout: 10m]
        CONN_TIMEOUT[Connection Timeout: 30s]
    end

    MAIN_POOL --> MIN_CONN
    TENANT1_POOL --> MAX_CONN
    TENANT2_POOL --> IDLE_TIMEOUT
    TENANT_N_POOL --> CONN_TIMEOUT
</div>

<h3 id="23-middleware-implementation">2.3 Middleware Implementation<a class="headerlink" href="#23-middleware-implementation" title="Permanent link">&para;</a></h3>
<h4 id="231-logging-middleware">2.3.1 Logging Middleware<a class="headerlink" href="#231-logging-middleware" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func (a *App) loggingMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        middleWareData := common.MiddleWareData{
            LogRequestResponse:   a.RequestResponseLog,
            DBSession:          a.DBSession,
            ConfigObject:       a.ConfigObject,
            AccessTokenHashMap: a.AccessTokenHashMap,
        }

        err := common.MiddleWareForMongoDriver(next, w, r, 
            constants.SkipRoutes, constants.SkipURI, middleWareData)

        if err != nil {
            logger.Error(&quot;Error in Middleware : &quot;, err.Error())
            utils.RespondWithJSON(w, http.StatusOK, 
                common.HandleError(err, &quot;Error in creating Tenant Session&quot;))
            return
        }
    })
}
</code></pre>

<h4 id="232-middleware-processing-flow">2.3.2 Middleware Processing Flow<a class="headerlink" href="#232-middleware-processing-flow" title="Permanent link">&para;</a></h4>
<div class="mermaid">
flowchart TD
    A[HTTP Request] --> B[Logging Middleware]
    B --> C{Skip Routes Check}
    C -->|Skip| D[Direct Route]
    C -->|Process| E[Token Validation]
    E --> F{Valid Token?}
    F -->|No| G[Return 401]
    F -->|Yes| H[Tenant Resolution]
    H --> I{Tenant Valid?}
    I -->|No| J[Return 403]
    I -->|Yes| K[Session Creation]
    K --> L[Request Logging]
    L --> M[Forward to Controller]
    M --> N[Response Logging]
    N --> O[HTTP Response]

    G --> O
    J --> O
    D --> O
</div>

<h3 id="24-controller-layer-implementation">2.4 Controller Layer Implementation<a class="headerlink" href="#24-controller-layer-implementation" title="Permanent link">&para;</a></h3>
<h4 id="241-custom-app-controller">2.4.1 Custom App Controller<a class="headerlink" href="#241-custom-app-controller" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">type CustomAppController struct{}

func (gc CustomAppController) DeleteApp(w http.ResponseWriter, r *http.Request, 
    dbSession map[string]common.SessionStruct, configObject config.ConfigStruct) {

    response := models.Response{}
    deleteAppRequest := models.DeleteApp{}

    // Step 1: Decode request
    decoder := json.NewDecoder(r.Body)
    if err := decoder.Decode(&amp;deleteAppRequest); err != nil {
        utils.RespondWithJSON(w, http.StatusOK, 
            handlers.HandleError(err, &quot;Error in Reading Request&quot;))
        return
    }
    defer r.Body.Close()

    // Step 2: Get database client
    mongoDBClient := dbSession[deleteAppRequest.TenantCode].Client

    // Step 3: Business logic execution
    err := deleteAppRequest.UpdateTasksStatus(mongoDBClient, configObject)
    if err != nil {
        utils.RespondWithJSON(w, http.StatusOK, 
            handlers.HandleError(err, &quot;Error in updating task status&quot;))
        return
    }

    // Step 4: Update database
    colQuerier := bson.M{&quot;integration_id&quot;: deleteAppRequest.IntegrationID}
    change := bson.M{&quot;$set&quot;: bson.M{&quot;status&quot;: &quot;deleted&quot;}}
    mongoDBClient.CollectionName = config[&quot;mongoIntegartionCollection&quot;]
    err = mongoDBClient.UpdateSingleDocument(colQuerier, change, nil, false)

    // Step 5: Cache invalidation
    RemoveAppListingCache(deleteAppRequest.TenantCode)
    RemoveActiveInstanceCache(deleteAppRequest.TenantCode)

    // Step 6: Response
    response.Success = true
    response.DisplayMessage = &quot;App Deleted&quot;
    utils.RespondWithJSON(w, http.StatusOK, response)
}
</code></pre>

<h4 id="242-generic-app-controller-upsertgenericapp">2.4.2 Generic App Controller - UpsertGenericApp<a class="headerlink" href="#242-generic-app-controller-upsertgenericapp" title="Permanent link">&para;</a></h4>
<div class="mermaid">
flowchart TD
    A[UpsertGenericApp Request] --> B[Parse Multipart Form]
    B --> C{Logo File Present?}
    C -->|Yes| D[Process Logo Upload]
    C -->|No| E[Use Default Logo]
    D --> F[Parse Form Fields]
    E --> F
    F --> G[Decrypt Credentials]
    G --> H{Integration ID = 0?}
    H -->|Yes| I[Create New Integration]
    H -->|No| J[Update Existing Integration]

    I --> K[Check Name Availability]
    K --> L{Name Available?}
    L -->|No| M[Return Error]
    L -->|Yes| N[Generate Integration ID]
    N --> O[Insert Database]

    J --> P[Update Active Instances]
    P --> Q[Update Integration Data]
    Q --> R{Logo Updated?}
    R -->|Yes| S[Update Task Logos]
    R -->|No| T[Skip Logo Update]
    S --> T

    O --> U{Add Instance?}
    T --> U
    U -->|No| V[Cache Invalidation]
    U -->|Yes| W[Check Trial Limits]
    W --> X{Limit Exceeded?}
    X -->|Yes| Y[Return Limit Error]
    X -->|No| Z[Create Active Instance]
    Z --> AA[Update Trial Count]
    AA --> V
    V --> BB[Return Success]

    M --> BB
    Y --> BB
</div>

<h3 id="25-service-layer-implementation">2.5 Service Layer Implementation<a class="headerlink" href="#25-service-layer-implementation" title="Permanent link">&para;</a></h3>
<h4 id="251-export-service-architecture">2.5.1 Export Service Architecture<a class="headerlink" href="#251-export-service-architecture" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func ExportIntegration(dbSession map[string]common.SessionStruct, 
    config config.Config, req models.ExportAppInputStruct) models.Response {

    var response models.Response
    var integrations models.ExportObject
    var apps []models.AppData

    tenantCode := req.Tenantcode
    mongoDBClient := dbSession[tenantCode].Client

    for _, eachIntegrationID := range req.IntegrationIds {
        var integrationObj models.AppData

        // Step 1: Fetch integration data
        var appObj models.GenericIntegrationObject
        mongoDBClient.CollectionName = config[&quot;mongoIntegartionCollection&quot;]
        err := mongoDBClient.FindSingleDocument(
            bson.M{&quot;integration_id&quot;: eachIntegrationID, &quot;status&quot;: &quot;active&quot;}, 
            nil, &amp;appObj)

        // Step 2: Sanitize sensitive data
        var updatedFields []models.Field
        for _, eachfield := range appObj.Fields {
            eachfield.Value = &quot;&quot; // Remove sensitive values
            updatedFields = append(updatedFields, eachfield)
        }

        // Step 3: Fetch related tasks
        var tasksResponse []models.TaskData
        mongoDBClient.CollectionName = config[&quot;taskCollection&quot;]
        err = mongoDBClient.FindMultipleDocuments(
            bson.M{&quot;integration_id&quot;: integrationID, &quot;status&quot;: bson.M{&quot;$in&quot;: status}}, 
            nil, &amp;tasksResponse)

        // Step 4: Process tasks and dependencies
        altTasksResponse := processTasks(tasksResponse)

        integrationObj.App = appObj
        integrationObj.Tasks = altTasksResponse
        apps = append(apps, integrationObj)
    }

    integrations.Apps = apps
    response.Success = true
    response.Data = integrations
    return response
}
</code></pre>

<h4 id="252-task-dependency-mapping">2.5.2 Task Dependency Mapping<a class="headerlink" href="#252-task-dependency-mapping" title="Permanent link">&para;</a></h4>
<div class="mermaid">
graph TB
    subgraph "Task Processing Pipeline"
        A[Fetch Tasks] --> B[Build Task Name Map]
        B --> C[Process Non-Ingestion Tasks]
        B --> D[Process Case Ingestion Tasks]

        C --> E[Sanitize Task Data]
        D --> F[Map Dependent Tasks]
        D --> G[Map Events API Tasks]

        E --> H[Replace Task IDs with Names]
        F --> H
        G --> H

        H --> I[Generate Export Object]
    end

    subgraph "Dependency Resolution"
        J[Task ID] --> K[Task Name Lookup]
        K --> L[Replace in Config JSON]
        L --> M[Update Dependencies]
    end

    subgraph "Data Sanitization"
        N[Remove Sensitive Data]
        O[Reset IDs to 0]
        P[Clear Tenant Info]
        Q[Clear Task Handlers]
    end

    E --> N
    E --> O
    E --> P
    E --> Q
</div>

<h3 id="26-data-models-implementation">2.6 Data Models Implementation<a class="headerlink" href="#26-data-models-implementation" title="Permanent link">&para;</a></h3>
<h4 id="261-core-data-structures">2.6.1 Core Data Structures<a class="headerlink" href="#261-core-data-structures" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">// Response model - Standard API response
type Response struct {
    Success        bool        `json:&quot;success&quot;`
    Data           interface{} `json:&quot;data,omitempty&quot;`
    Error          string      `json:&quot;error,omitempty&quot;`
    Time           int64       `json:&quot;time,omitempty&quot;`
    DisplayMessage string      `json:&quot;displaymessage,omitempty&quot;`
    Status         string      `json:&quot;status,omitempty&quot;`
    ErrorPath      string      `json:&quot;errorpath,omitempty&quot;`
    SessionExpired bool        `json:&quot;sessionexpired,omitempty&quot;`
    FileName       string      `json:&quot;filename,omitempty&quot;`
    Field          []string    `json:&quot;field,omitempty&quot;`
    Count          int         `json:&quot;count,omitempty&quot;`
}

// GenericIntegrationObject - Integration data structure
type GenericIntegrationObject struct {
    IntegrationID int           `json:&quot;integration_id&quot; bson:&quot;integration_id&quot;`
    Title         string        `json:&quot;title&quot; bson:&quot;title&quot;`
    Description   string        `json:&quot;description&quot; bson:&quot;description&quot;`
    Version       string        `json:&quot;version&quot; bson:&quot;version&quot;`
    Category      string        `json:&quot;category&quot; bson:&quot;category&quot;`
    TenantCode    string        `json:&quot;tenant_code&quot; bson:&quot;tenant_code&quot;`
    Fields        []Field       `json:&quot;fields&quot; bson:&quot;fields&quot;`
    Status        string        `json:&quot;status&quot; bson:&quot;status&quot;`
    Logo          string        `json:&quot;logo&quot; bson:&quot;logo&quot;`
    GenericApp    bool          `json:&quot;generic_app&quot; bson:&quot;generic_app&quot;`
    UserID        int           `json:&quot;user_id&quot; bson:&quot;user_id&quot;`
    AddInstance   bool          `json:&quot;add_instance&quot; bson:&quot;add_instance&quot;`
}

// TaskData - Task information structure
type TaskData struct {
    ID                  int    `json:&quot;id&quot; bson:&quot;id&quot;`
    Name                string `json:&quot;name&quot; bson:&quot;name&quot;`
    TasksTag            string `json:&quot;tasks_tag&quot; bson:&quot;tasks_tag&quot;`
    TaskHandler         string `json:&quot;task_handler&quot; bson:&quot;task_handler&quot;`
    IntegrationID       int    `json:&quot;integration_id&quot; bson:&quot;integration_id&quot;`
    Fields              string `json:&quot;fields&quot; bson:&quot;fields&quot;`
    Status              string `json:&quot;status&quot; bson:&quot;status&quot;`
    Tenantcode          string `json:&quot;tenantcode&quot; bson:&quot;tenantcode&quot;`
    IngestCases         bool   `json:&quot;ingest_cases&quot; bson:&quot;ingest_cases&quot;`
    CaseIngestionConfig string `json:&quot;case_ingestion_config&quot; bson:&quot;case_ingestion_config&quot;`
    EventsAPIConfig     string `json:&quot;events_api_config&quot; bson:&quot;events_api_config&quot;`
    LogoPath            string `json:&quot;logo_path&quot; bson:&quot;logo_path&quot;`
}
</code></pre>

<h4 id="262-data-validation-transformation">2.6.2 Data Validation &amp; Transformation<a class="headerlink" href="#262-data-validation-transformation" title="Permanent link">&para;</a></h4>
<div class="mermaid">
flowchart LR
    subgraph "Input Validation"
        A[Raw Input] --> B[JSON Decode]
        B --> C[Structure Validation]
        C --> D[Business Rules Check]
        D --> E[Sanitization]
    end

    subgraph "Data Transformation"
        F[Database Model] --> G[Field Encryption]
        G --> H[Tenant Mapping]
        H --> I[Timestamp Addition]
        I --> J[ID Generation]
    end

    subgraph "Output Serialization"
        K[Internal Model] --> L[Response Model]
        L --> M[JSON Encode]
        M --> N[HTTP Response]
    end

    E --> F
    J --> K
</div>

<h3 id="27-error-handling-strategy">2.7 Error Handling Strategy<a class="headerlink" href="#27-error-handling-strategy" title="Permanent link">&para;</a></h3>
<h4 id="271-error-handler-implementation">2.7.1 Error Handler Implementation<a class="headerlink" href="#271-error-handler-implementation" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func HandleError(err error, message string) models.Response {
    response := models.Response{
        Success:        false,
        Error:          err.Error(),
        DisplayMessage: message,
        Time:           time.Now().UnixNano() / 1000000,
    }

    // Log error details
    logger.Error(&quot;Error: %s, Message: %s&quot;, err.Error(), message)

    return response
}
</code></pre>

<h4 id="272-error-flow-hierarchy">2.7.2 Error Flow Hierarchy<a class="headerlink" href="#272-error-flow-hierarchy" title="Permanent link">&para;</a></h4>
<div class="mermaid">
graph TB
    A[Request Processing] --> B{Validation Error?}
    B -->|Yes| C[Return 400 Bad Request]
    B -->|No| D[Business Logic]

    D --> E{Database Error?}
    E -->|Yes| F[Log Error]
    F --> G[Return 500 Internal Server Error]
    E -->|No| H[Processing Success]

    D --> I{Business Logic Error?}
    I -->|Yes| J[Log Warning]
    J --> K[Return 200 with Error Flag]
    I -->|No| H

    H --> L[Return 200 Success]

    subgraph "Error Types"
        M[Validation Errors]
        N[Database Errors]
        O[Business Logic Errors]
        P[System Errors]
    end

    C --> M
    G --> N
    K --> O
    G --> P
</div>

<h3 id="28-authentication-authorization">2.8 Authentication &amp; Authorization<a class="headerlink" href="#28-authentication-authorization" title="Permanent link">&para;</a></h3>
<h4 id="281-token-management">2.8.1 Token Management<a class="headerlink" href="#281-token-management" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">type App struct {
    AccessTokenHashMap map[string]int64  // Token -&gt; Expiry mapping
    // ... other fields
}

func (a *App) UpdateUserSessionExpiryTime(accessToken string, expiryTime int64) {
    a.AccessTokenHashMap[accessToken] = expiryTime
}

func (a *App) ValidateToken(token string) bool {
    expiryTime, exists := a.AccessTokenHashMap[token]
    if !exists {
        return false
    }

    currentTime := time.Now().UnixNano() / 1000000
    return currentTime &lt; expiryTime
}
</code></pre>

<h4 id="282-security-flow">2.8.2 Security Flow<a class="headerlink" href="#282-security-flow" title="Permanent link">&para;</a></h4>
<div class="mermaid">
sequenceDiagram
    participant Client
    participant Middleware
    participant TokenStore
    participant Database
    participant Controller

    Client->>Middleware: Request with Token
    Middleware->>TokenStore: Validate Token
    TokenStore-->>Middleware: Token Valid/Invalid

    alt Token Invalid
        Middleware-->>Client: 401 Unauthorized
    else Token Valid
        Middleware->>Database: Get Tenant Info
        Database-->>Middleware: Tenant Details
        Middleware->>Controller: Forward Request
        Controller-->>Middleware: Process Response
        Middleware-->>Client: Success Response
    end
</div>

<h3 id="29-caching-strategy">2.9 Caching Strategy<a class="headerlink" href="#29-caching-strategy" title="Permanent link">&para;</a></h3>
<h4 id="291-cache-implementation">2.9.1 Cache Implementation<a class="headerlink" href="#291-cache-implementation" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">func RemoveAppListingCache(tenantCode string) {
    cacheKey := fmt.Sprintf(&quot;app_listing_%s&quot;, tenantCode)
    cache.Delete(cacheKey)
}

func RemoveActiveInstanceCache(tenantCode string) {
    cacheKey := fmt.Sprintf(&quot;active_instances_%s&quot;, tenantCode)
    cache.Delete(cacheKey)
}

func GetAppListingFromCache(tenantCode string) ([]models.AppData, bool) {
    cacheKey := fmt.Sprintf(&quot;app_listing_%s&quot;, tenantCode)
    data, exists := cache.Get(cacheKey)
    if exists {
        var apps []models.AppData
        json.Unmarshal(data, &amp;apps)
        return apps, true
    }
    return nil, false
}
</code></pre>

<h4 id="292-cache-invalidation-strategy">2.9.2 Cache Invalidation Strategy<a class="headerlink" href="#292-cache-invalidation-strategy" title="Permanent link">&para;</a></h4>
<div class="mermaid">
graph TB
    subgraph "Cache Operations"
        A[Create/Update Operation] --> B[Invalidate Related Cache]
        C[Delete Operation] --> D[Invalidate Related Cache]
        E[Read Operation] --> F{Cache Hit?}
        F -->|Yes| G[Return Cached Data]
        F -->|No| H[Fetch from DB]
        H --> I[Store in Cache]
        I --> J[Return Data]
    end

    subgraph "Cache Keys"
        K[app_listing_{tenant}]
        L[active_instances_{tenant}]
        M[integration_list_{tenant}]
    end

    B --> K
    B --> L
    D --> K
    D --> L
</div>

<h3 id="210-configuration-management">2.10 Configuration Management<a class="headerlink" href="#210-configuration-management" title="Permanent link">&para;</a></h3>
<h4 id="2101-configuration-structure">2.10.1 Configuration Structure<a class="headerlink" href="#2101-configuration-structure" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">type ConfigStruct struct {
    ConfigFilePath string
    ConfigData     map[string]string
}

func InitConfig() ConfigStruct {
    config := ConfigStruct{
        ConfigFilePath: &quot;/opt/securaa/conf/securaa.conf&quot;,
        ConfigData:     make(map[string]string),
    }

    // Load configuration from file
    configData, err := config.ReadConfig()
    if err != nil {
        logger.Error(&quot;Failed to load configuration: %v&quot;, err)
    }

    config.ConfigData = configData
    return config
}
</code></pre>

<h4 id="2102-configuration-flow">2.10.2 Configuration Flow<a class="headerlink" href="#2102-configuration-flow" title="Permanent link">&para;</a></h4>
<div class="mermaid">
flowchart TD
    A[Application Start] --> B[Load Config File]
    B --> C[Parse Configuration]
    C --> D[Validate Required Keys]
    D --> E{Validation OK?}
    E -->|No| F[Exit with Error]
    E -->|Yes| G[Store in ConfigObject]
    G --> H[Pass to Components]

    subgraph "Config Categories"
        I[Database Settings]
        J[Cache Settings]
        K[Security Settings]
        L[Logging Settings]
        M[Business Logic Settings]
    end

    H --> I
    H --> J
    H --> K
    H --> L
    H --> M
</div>

<h3 id="211-database-operations">2.11 Database Operations<a class="headerlink" href="#211-database-operations" title="Permanent link">&para;</a></h3>
<h4 id="2111-crud-operations-pattern">2.11.1 CRUD Operations Pattern<a class="headerlink" href="#2111-crud-operations-pattern" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">// Generic database operation wrapper
type DatabaseOperations struct {
    Client         mongo_driver.MongoClientWrapper
    CollectionName string
}

func (db *DatabaseOperations) Create(document interface{}) error {
    db.Client.CollectionName = db.CollectionName
    return db.Client.InsertSingleDocument(document, nil)
}

func (db *DatabaseOperations) Read(filter bson.M, result interface{}) error {
    db.Client.CollectionName = db.CollectionName
    return db.Client.FindSingleDocument(filter, nil, result)
}

func (db *DatabaseOperations) Update(filter bson.M, update bson.M) error {
    db.Client.CollectionName = db.CollectionName
    return db.Client.UpdateSingleDocument(filter, update, nil, false)
}

func (db *DatabaseOperations) Delete(filter bson.M) error {
    db.Client.CollectionName = db.CollectionName
    return db.Client.DeleteSingleDocument(filter, nil)
}
</code></pre>

<h4 id="2112-transaction-management">2.11.2 Transaction Management<a class="headerlink" href="#2112-transaction-management" title="Permanent link">&para;</a></h4>
<div class="mermaid">
sequenceDiagram
    participant Service
    participant DBClient
    participant MongoDB

    Service->>DBClient: Start Transaction
    DBClient->>MongoDB: Begin Transaction

    loop Database Operations
        Service->>DBClient: Execute Operation
        DBClient->>MongoDB: Execute Query
        MongoDB-->>DBClient: Operation Result
        DBClient-->>Service: Result
    end

    alt All Operations Successful
        Service->>DBClient: Commit Transaction
        DBClient->>MongoDB: Commit
        MongoDB-->>DBClient: Success
        DBClient-->>Service: Transaction Complete
    else Any Operation Failed
        Service->>DBClient: Rollback Transaction
        DBClient->>MongoDB: Rollback
        MongoDB-->>DBClient: Rollback Complete
        DBClient-->>Service: Transaction Rolled Back
    end
</div>

<h3 id="212-logging-implementation">2.12 Logging Implementation<a class="headerlink" href="#212-logging-implementation" title="Permanent link">&para;</a></h3>
<h4 id="2121-structured-logging">2.12.1 Structured Logging<a class="headerlink" href="#2121-structured-logging" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-go">var logger = securaalog.New(&quot;zona_custom&quot;)

func LogRequest(r *http.Request) {
    logger.Info(&quot;Request received&quot;,
        &quot;method&quot;, r.Method,
        &quot;url&quot;, r.URL.String(),
        &quot;remote_addr&quot;, r.RemoteAddr,
        &quot;user_agent&quot;, r.UserAgent(),
    )
}

func LogError(operation string, err error, context map[string]interface{}) {
    logger.Error(&quot;Operation failed&quot;,
        &quot;operation&quot;, operation,
        &quot;error&quot;, err.Error(),
        &quot;context&quot;, context,
    )
}

func LogPerformance(operation string, duration time.Duration) {
    logger.Info(&quot;Operation completed&quot;,
        &quot;operation&quot;, operation,
        &quot;duration_ms&quot;, duration.Milliseconds(),
    )
}
</code></pre>

<h4 id="2122-log-levels-categories">2.12.2 Log Levels &amp; Categories<a class="headerlink" href="#2122-log-levels-categories" title="Permanent link">&para;</a></h4>
<div class="mermaid">
graph TB
    subgraph "Log Levels"
        A[DEBUG - Development Info]
        B[INFO - General Information]
        C[WARN - Warning Conditions]
        D[ERROR - Error Conditions]
        E[FATAL - Critical Errors]
    end

    subgraph "Log Categories"
        F[REQUEST_RESPONSE - HTTP Traffic]
        G[DATABASE - DB Operations]
        H[BUSINESS_LOGIC - Application Logic]
        I[SECURITY - Auth/Authorization]
        J[PERFORMANCE - Performance Metrics]
    end

    subgraph "Log Destinations"
        K[Console Output]
        L[File System]
        M[Centralized Logging]
        N[Monitoring Systems]
    end

    A --> F
    B --> G
    C --> H
    D --> I
    E --> J

    F --> K
    G --> L
    H --> M
    I --> N
</div>

<h2 id="3-performance-considerations">3. Performance Considerations<a class="headerlink" href="#3-performance-considerations" title="Permanent link">&para;</a></h2>
<h3 id="31-optimization-strategies">3.1 Optimization Strategies<a class="headerlink" href="#31-optimization-strategies" title="Permanent link">&para;</a></h3>
<h4 id="311-database-query-optimization">3.1.1 Database Query Optimization<a class="headerlink" href="#311-database-query-optimization" title="Permanent link">&para;</a></h4>
<ul>
<li>Use appropriate indexes on frequently queried fields</li>
<li>Implement query result caching for read-heavy operations</li>
<li>Use batch operations for bulk data manipulation</li>
<li>Implement connection pooling for database efficiency</li>
</ul>
<h4 id="312-memory-management">3.1.2 Memory Management<a class="headerlink" href="#312-memory-management" title="Permanent link">&para;</a></h4>
<ul>
<li>Implement proper cleanup of temporary objects</li>
<li>Use connection pooling to avoid resource leaks</li>
<li>Monitor goroutine lifecycle for concurrent operations</li>
<li>Implement request timeout mechanisms</li>
</ul>
<h4 id="313-network-optimization">3.1.3 Network Optimization<a class="headerlink" href="#313-network-optimization" title="Permanent link">&para;</a></h4>
<ul>
<li>Compress HTTP responses for large payloads</li>
<li>Implement request/response caching</li>
<li>Use HTTP/2 where supported</li>
<li>Minimize JSON payload sizes</li>
</ul>
<h3 id="32-scalability-considerations">3.2 Scalability Considerations<a class="headerlink" href="#32-scalability-considerations" title="Permanent link">&para;</a></h3>
<div class="mermaid">
graph LR
    subgraph "Horizontal Scaling"
        A[Load Balancer] --> B[Instance 1]
        A --> C[Instance 2]
        A --> D[Instance N]
    end

    subgraph "Vertical Scaling"
        E[CPU Scaling]
        F[Memory Scaling]
        G[Storage Scaling]
    end

    subgraph "Database Scaling"
        H[Read Replicas]
        I[Sharding]
        J[Connection Pooling]
    end

    B --> H
    C --> I
    D --> J
</div>

<h2 id="4-testing-strategy">4. Testing Strategy<a class="headerlink" href="#4-testing-strategy" title="Permanent link">&para;</a></h2>
<h3 id="41-unit-testing-structure">4.1 Unit Testing Structure<a class="headerlink" href="#41-unit-testing-structure" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-go">func TestDeleteApp(t *testing.T) {
    // Arrange
    controller := NewCustomAppController()
    mockDBSession := createMockDBSession()
    mockConfig := createMockConfig()

    // Act
    response := controller.DeleteApp(nil, createMockRequest(), mockDBSession, mockConfig)

    // Assert
    assert.True(t, response.Success)
    assert.Equal(t, &quot;App Deleted&quot;, response.DisplayMessage)
}
</code></pre>

<h3 id="42-integration-testing">4.2 Integration Testing<a class="headerlink" href="#42-integration-testing" title="Permanent link">&para;</a></h3>
<div class="mermaid">
flowchart TD
    A[Integration Test Suite] --> B[Database Tests]
    A --> C[API Endpoint Tests]
    A --> D[Cache Integration Tests]
    A --> E[External Service Tests]

    B --> F[CRUD Operations]
    B --> G[Transaction Tests]

    C --> H[Authentication Tests]
    C --> I[Authorization Tests]
    C --> J[Input Validation Tests]

    D --> K[Cache Hit/Miss Tests]
    D --> L[Cache Invalidation Tests]

    E --> M[MongoDB Integration]
    E --> N[Redis Integration]
    E --> O[External API Integration]
</div>

<h2 id="5-security-implementation">5. Security Implementation<a class="headerlink" href="#5-security-implementation" title="Permanent link">&para;</a></h2>
<h3 id="51-data-encryption">5.1 Data Encryption<a class="headerlink" href="#51-data-encryption" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-go">func EncryptSensitiveFields(fields map[string]string, config config.ConfigStruct) (map[string]string, error) {
    encryptedFields := make(map[string]string)
    encryptionKey := config[&quot;zonaCredentialsEncryptDecryptKey&quot;]

    for key, value := range fields {
        if isSensitiveField(key) {
            encryptedValue, err := utils.CredentialsEncrypt(value, encryptionKey)
            if err != nil {
                return nil, err
            }
            encryptedFields[key] = encryptedValue
        } else {
            encryptedFields[key] = value
        }
    }

    return encryptedFields, nil
}

func isSensitiveField(fieldName string) bool {
    sensitiveFields := []string{&quot;password&quot;, &quot;api_key&quot;, &quot;secret&quot;, &quot;token&quot;}
    for _, sensitive := range sensitiveFields {
        if strings.Contains(strings.ToLower(fieldName), sensitive) {
            return true
        }
    }
    return false
}
</code></pre>

<h3 id="52-input-sanitization">5.2 Input Sanitization<a class="headerlink" href="#52-input-sanitization" title="Permanent link">&para;</a></h3>
<div class="mermaid">
flowchart TD
    A[User Input] --> B[Input Validation]
    B --> C{Valid Format?}
    C -->|No| D[Return Validation Error]
    C -->|Yes| E[SQL Injection Check]
    E --> F{Safe?}
    F -->|No| G[Return Security Error]
    F -->|Yes| H[XSS Prevention]
    H --> I[Sanitized Input]
    I --> J[Business Logic Processing]
</div>

<h2 id="6-deployment-operations">6. Deployment &amp; Operations<a class="headerlink" href="#6-deployment-operations" title="Permanent link">&para;</a></h2>
<h3 id="61-build-process">6.1 Build Process<a class="headerlink" href="#61-build-process" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-makefile"># Build configuration from Makefile
build: builddir
    $(BUILD_ENV) go build -mod vendor $(BUILD_FLAGS) -o build/$(TARGET)

image_ecr: builddir
    DOCKER_BUILDKIT=1 docker build --pull \
    -t $(RUNTIME_DOCKER_IMAGE_ECR):latest \
    --build-arg TARGET=$(TARGET) \
    --build-arg GIT_REF=$(GIT_REF) \
    --build-arg BUILD_VERSION=$(BUILD_VERSION) .
</code></pre>

<h3 id="62-health-monitoring">6.2 Health Monitoring<a class="headerlink" href="#62-health-monitoring" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-go">func HealthCheck() http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        health := struct {
            Status    string `json:&quot;status&quot;`
            Database  string `json:&quot;database&quot;`
            Cache     string `json:&quot;cache&quot;`
            Version   string `json:&quot;version&quot;`
            Timestamp int64  `json:&quot;timestamp&quot;`
        }{
            Status:    &quot;healthy&quot;,
            Database:  checkDatabaseHealth(),
            Cache:     checkCacheHealth(),
            Version:   BuildVersion,
            Timestamp: time.Now().Unix(),
        }

        w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)
        json.NewEncoder(w).Encode(health)
    }
}
</code></pre>

<p>This comprehensive Low-Level Design document provides detailed implementation specifications for the Securaa Custom Services application, covering all major components, data flows, and architectural decisions at the code level.</p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 04, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
