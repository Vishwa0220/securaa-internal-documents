<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Securaa Custom Utils - Low Level Design">
    <title>Securaa Custom Utils - Low Level Design - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 18, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="zona-custom-utils-service-low-level-design-lld">Zona Custom Utils Service - Low-Level Design (LLD)</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#technical-implementation-overview">Technical Implementation Overview</a></li>
<li><a href="#detailed-component-design">Detailed Component Design</a></li>
<li><a href="#database-design">Database Design</a></li>
<li><a href="#api-implementation">API Implementation</a></li>
<li><a href="#security-implementation">Security Implementation</a></li>
<li><a href="#performance-implementation">Performance Implementation</a></li>
<li><a href="#error-handling-implementation">Error Handling Implementation</a></li>
<li><a href="#monitoring-and-logging-implementation">Monitoring and Logging Implementation</a></li>
<li><a href="#configuration-management">Configuration Management</a></li>
<li><a href="#development-guidelines">Development Guidelines</a></li>
<li><a href="#testing-strategy">Testing Strategy</a></li>
<li><a href="#deployment-implementation">Deployment Implementation</a></li>
</ol>
<h2 id="technical-implementation-overview">Technical Implementation Overview</h2>
<h3 id="technology-stack-details">Technology Stack Details</h3>
<h4 id="core-technologies">Core Technologies</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Go 1.17+ with essential libraries</span>
<span class="nx">module</span><span class="w"> </span><span class="nx">zona_services</span><span class="o">/</span><span class="nx">zona_custom_utils</span>

<span class="nx">require</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gorilla</span><span class="o">/</span><span class="nx">mux</span><span class="w"> </span><span class="nx">v1</span><span class="mf">.8.0</span><span class="w">           </span><span class="c1">// HTTP routing</span>
<span class="w">    </span><span class="k">go</span><span class="p">.</span><span class="nx">mongodb</span><span class="p">.</span><span class="nx">org</span><span class="o">/</span><span class="nx">mongo</span><span class="o">-</span><span class="nx">driver</span><span class="w"> </span><span class="nx">v1</span><span class="mf">.14.0</span><span class="w">     </span><span class="c1">// MongoDB driver</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">redis</span><span class="o">/</span><span class="nx">redis</span><span class="o">/</span><span class="nx">v8</span><span class="w"> </span><span class="nx">v8</span><span class="mf">.11.5</span><span class="w">    </span><span class="c1">// Redis client</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">docker</span><span class="o">/</span><span class="nx">docker</span><span class="w"> </span><span class="nx">v1</span><span class="mf">.13.0</span><span class="w">        </span><span class="c1">// Docker API client</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dgrijalva</span><span class="o">/</span><span class="nx">jwt</span><span class="o">-</span><span class="k">go</span><span class="w"> </span><span class="nx">v3</span><span class="mf">.2.0</span><span class="w">       </span><span class="c1">// JWT token handling</span>
<span class="w">    </span><span class="nx">securaa_lib</span><span class="w"> </span><span class="nx">v0</span><span class="mf">.0.0</span><span class="w">                      </span><span class="c1">// Internal utilities</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="service-architecture">Service Architecture</h4>
<ul>
<li><strong>Port</strong>: 8109 (HTTP REST API)</li>
<li><strong>Runtime</strong>: Go 1.17+ on Ubuntu 20.04</li>
<li><strong>Container</strong>: Docker with multi-stage build</li>
<li><strong>Dependencies</strong>: MongoDB, Redis, Docker Engine</li>
</ul>
<h3 id="application-structure">Application Structure</h3>
<div class="highlight"><pre><span></span><code><span class="n">zona_custom_utils</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">go</span><span class="w">                 </span><span class="c1"># Entry point</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app</span><span class="o">.</span><span class="n">go</span><span class="w">                  </span><span class="c1"># Application setup</span>
<span class="err">├──</span><span class="w"> </span><span class="n">Dockerfile</span><span class="w">             </span><span class="c1"># Container definition</span>
<span class="err">├──</span><span class="w"> </span><span class="n">Makefile</span><span class="w">               </span><span class="c1"># Build automation</span>
<span class="err">├──</span><span class="w"> </span><span class="n">go</span><span class="o">.</span><span class="n">mod</span><span class="w">                 </span><span class="c1"># Module dependencies</span>
<span class="err">├──</span><span class="w"> </span><span class="n">controllers</span><span class="o">/</span><span class="w">           </span><span class="c1"># HTTP request handlers</span>
<span class="err">├──</span><span class="w"> </span><span class="n">services</span><span class="o">/</span><span class="w">              </span><span class="c1"># Business logic</span>
<span class="err">├──</span><span class="w"> </span><span class="n">models</span><span class="o">/</span><span class="w">                </span><span class="c1"># Data structures</span>
<span class="err">├──</span><span class="w"> </span><span class="n">utils</span><span class="o">/</span><span class="w">                 </span><span class="c1"># Utility functions</span>
<span class="err">├──</span><span class="w"> </span><span class="n">builders</span><span class="o">/</span><span class="w">              </span><span class="c1"># Object builders</span>
<span class="err">├──</span><span class="w"> </span><span class="n">handlers</span><span class="o">/</span><span class="w">              </span><span class="c1"># Error handlers</span>
<span class="err">└──</span><span class="w"> </span><span class="n">constants</span><span class="o">/</span><span class="w">             </span><span class="c1"># Application constants</span>
</code></pre></div>

<h2 id="detailed-component-design">Detailed Component Design</h2>
<h3 id="application-layer-implementation">Application Layer Implementation</h3>
<h4 id="maingo-service-entry-point">main.go - Service Entry Point</h4>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;securaa_lib/securaalog&quot;</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;zona_custom_utils&quot;</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Initialize logging subsystem</span>
<span class="w">    </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">Init</span><span class="p">(</span><span class="s">&quot;CORE_SERVICE_LOGS&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Create and initialize application</span>
<span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">App</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Start HTTP server on port 8109</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;:8109&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="appgo-application-configuration">app.go - Application Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Router</span><span class="w">             </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="w">                    </span><span class="c1">// HTTP router</span>
<span class="w">    </span><span class="nx">AccessTokenHashMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int64</span><span class="w">              </span><span class="c1">// Token cache</span>
<span class="w">    </span><span class="nx">DBSession</span><span class="w">          </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="w"> </span><span class="c1">// DB connections</span>
<span class="w">    </span><span class="nx">ConfigObject</span><span class="w">       </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="w">           </span><span class="c1">// Configuration</span>
<span class="w">    </span><span class="nx">BuildType</span><span class="w">          </span><span class="kt">string</span><span class="w">                        </span><span class="c1">// Deployment type</span>
<span class="w">    </span><span class="nx">RequestResponseLog</span><span class="w"> </span><span class="kt">bool</span><span class="w">                          </span><span class="c1">// Logging flag</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">Initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int64</span><span class="p">)</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">InitConfig</span><span class="p">()</span><span class="w">                    </span><span class="c1">// Load configuration</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">InitMongoSession</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="p">)</span><span class="w"> </span><span class="c1">// Setup databases</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Router</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">NewRouter</span><span class="p">()</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">initializeRoutes</span><span class="p">()</span><span class="w">              </span><span class="c1">// Setup API routes</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">CacheHealthCheck</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Start cache monitoring</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">ClearCache</span><span class="p">()</span><span class="w">                    </span><span class="c1">// Clear startup cache</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="controller-layer-implementation">Controller Layer Implementation</h3>
<h4 id="customutilscontroller-structure">CustomUtilsController Structure</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">CustomUtilsController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewCustomUtilsController</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomUtilsController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CustomUtilsController</span><span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Primary endpoints implementation</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cu</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomUtilsController</span><span class="p">)</span><span class="w"> </span><span class="nx">UpsertCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">services</span><span class="p">.</span><span class="nx">CreateOrUpdateUtils</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cu</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomUtilsController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Extract path parameters</span>
<span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
<span class="w">    </span><span class="nx">tenantCode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;tenant-code&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">utilsName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// Process request and return response</span>
<span class="w">    </span><span class="c1">// ... implementation details</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="request-routing-configuration">Request Routing Configuration</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">initializeRoutes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">Use</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">loggingMiddleware</span><span class="p">)</span>

<span class="w">    </span><span class="nx">cu</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">NewCustomUtilsController</span><span class="p">()</span>
<span class="w">    </span><span class="nx">vc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">NewValidateController</span><span class="p">()</span>
<span class="w">    </span><span class="nx">tc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">NewTasksController</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controllers</span><span class="p">.</span><span class="nx">NewContentController</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Custom Utils Management</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/utils/v1/custom-utils/{tenant-code}/{userid}/{name}&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cu</span><span class="p">.</span><span class="nx">GetCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/utils/v1/custom-utils/{tenant-code}/{task-id}&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cu</span><span class="p">.</span><span class="nx">GetCustomUtilsOnId</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/utils/v1/custom-utils&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cu</span><span class="p">.</span><span class="nx">UpsertCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="p">)</span>
<span class="w">        </span><span class="p">}).</span><span class="nx">Methods</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Additional routes...</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="service-layer-implementation">Service Layer Implementation</h3>
<h4 id="utilsservice-core-business-logic">UtilsService - Core Business Logic</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">CreateOrUpdateUtils</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span>

<span class="w">    </span><span class="c1">// Read configuration</span>
<span class="w">    </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ReadConfig</span><span class="p">(</span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to read configuration&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract form parameters</span>
<span class="w">    </span><span class="nx">title</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">description</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">userid</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;userid&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">tenantcode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;tenantcode&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">oldhash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;filehash&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Validate input parameters</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Utility name is required&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// File hash verification for updates</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">taskIdInt</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filelocation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">pythonUtilDirectory</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">+</span><span class="s">&quot;.py&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">currentHash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">localUtils</span><span class="p">.</span><span class="nx">CalculateFileHash</span><span class="p">(</span><span class="nx">filelocation</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Unable to verify util.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">oldhash</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">currentHash</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;Invalid util version&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">                </span><span class="s">&quot;Util has been altered by other user.&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process utility creation/update</span>
<span class="w">    </span><span class="c1">// ... detailed implementation</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="tasksservice-task-management">TasksService - Task Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">CopyutilsToTenant</span><span class="p">(</span><span class="nx">newtenantcode</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span>

<span class="w">    </span><span class="c1">// Get configuration</span>
<span class="w">    </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ReadConfig</span><span class="p">(</span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get tenant count to determine if this is first tenant</span>
<span class="w">    </span><span class="nx">mongoDbClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">[</span><span class="s">&quot;localhost&quot;</span><span class="p">].</span><span class="nx">Client</span>
<span class="w">    </span><span class="nx">mongoDbClient</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;tenantsCollection&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">tenantsCount</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongoDbClient</span><span class="p">.</span><span class="nx">GetDocumentsCount</span><span class="p">(</span>
<span class="w">        </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="p">},</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tenantsCount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Ignoring copy utils for first tenant&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get source tenant utilities</span>
<span class="w">    </span><span class="c1">// Copy utilities to new tenant</span>
<span class="w">    </span><span class="c1">// ... implementation details</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="utils-layer-implementation">Utils Layer Implementation</h3>
<h4 id="common-utilities">Common Utilities</h4>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;crypto/sha256&quot;</span>
<span class="w">    </span><span class="s">&quot;encoding/hex&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CalculateFileHash</span><span class="p">(</span><span class="nx">filePath</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error in closing file &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="nx">hash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sha256</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">Sum</span><span class="p">(</span><span class="kc">nil</span><span class="p">)),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="container-management">Container Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">RemoveCustomUtils</span><span class="p">(</span><span class="nx">servicetype</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">command</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`docker service rm python-`</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">servicetype</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">).</span><span class="nx">CombinedOutput</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">CheckIfTrailContainerIsUp</span><span class="p">(</span><span class="nx">imgtype</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">imgtype</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;trial&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">command</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`docker ps -f name=python-utils-trial --format &quot;{{.ID}}&quot;`</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">command</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`docker ps -f name=python-utils --format &quot;{{.ID}}&quot;`</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">opt</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">).</span><span class="nx">CombinedOutput</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">opt</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ClearProcess</span><span class="p">(</span><span class="nx">userId</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">existingPids</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetAllPIDofProcessInContainer</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">existingPids</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pids</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">existingPids</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">pids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">commandString</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;kill -TERM &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pids</span>
<span class="w">            </span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ExecuteCommandInContainer</span><span class="p">(</span><span class="nx">commandString</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error in stopping running service: &quot;</span><span class="o">+</span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="builder-layer-implementation">Builder Layer Implementation</h3>
<h4 id="taskobjectbuilder">TaskObjectBuilder</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">BuildTaskObject</span><span class="p">(</span><span class="nx">outputs</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span>
<span class="w">    </span><span class="nx">utilsdirectory</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantcode</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">alteredFunctionName</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<span class="w">    </span><span class="nx">inputLabel</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">filterLabel</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">filterRequired</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span>
<span class="w">    </span><span class="nx">localIp</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">CustomUtilsObject</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="nx">currentTimeNanos</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">now</span><span class="p">.</span><span class="nx">UnixNano</span><span class="p">()</span>
<span class="w">    </span><span class="nx">currentTimemillis</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">currentTimeNanos</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span>
<span class="w">    </span><span class="nx">savingObject</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">CustomUtilsObject</span><span class="p">{}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">filterRequired</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filterRequired</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">alteredFunctionName</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Update existing utility</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">description</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Updateddate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currentTimemillis</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">RestEnd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">RestURL</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;http://&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">constants</span><span class="p">.</span><span class="nx">PYTHON_UTILS_SERVICE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">title</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">FunctionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;()&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">FileName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.py&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Category</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">category</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create new utility</span>
<span class="w">        </span><span class="nx">inputParams</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`{&quot;params&quot;:[{&quot;name&quot;:&quot;data&quot;, &quot;order&quot;:1,&quot;type&quot;:&quot;string&quot;},`</span><span class="w"> </span><span class="o">+</span>
<span class="w">                     </span><span class="s">`{&quot;name&quot;:&quot;filter&quot;, &quot;order&quot;:2,&quot;type&quot;:&quot;string&quot;}]}`</span>
<span class="w">        </span><span class="nx">inputFields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`{&quot;inputfields&quot;:[{&quot;name&quot;:&quot;data&quot;,&quot;label&quot;:&quot;`</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inputLabel</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                     </span><span class="s">`&quot;,&quot;type&quot;:&quot;textarea&quot;,&quot;id&quot;:&quot;data&quot;,&quot;required&quot;:true,&quot;value&quot;:&quot;&quot;,`</span><span class="w"> </span><span class="o">+</span>
<span class="w">                     </span><span class="s">`&quot;placeholder&quot;:&quot;Enter `</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inputLabel</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">`&quot;},`</span><span class="w"> </span><span class="o">+</span>
<span class="w">                     </span><span class="s">`{&quot;name&quot;:&quot;filter&quot;,&quot;label&quot;:&quot;`</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">filterLabel</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                     </span><span class="s">`&quot;,&quot;type&quot;:&quot;textbox&quot;,&quot;id&quot;:&quot;filter&quot;,&quot;required&quot;:`</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">filterRequired</span><span class="w"> </span><span class="o">+</span>
<span class="w">                     </span><span class="s">`,&quot;value&quot;:&quot;&quot;,&quot;placeholder&quot;:&quot;Enter data for `</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">filterLabel</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">`&quot;}]}`</span>

<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">description</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;active&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">TaskHandler</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Utils&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">TasksTag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;custom_utils_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">title</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Createddate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currentTimemillis</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Updateddate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currentTimemillis</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;POST&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">CustomUtils</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;customutils&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">TenantCode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tenantcode</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">userId</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">InputParams</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">inputParams</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Fields</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">inputFields</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">FolderName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utilsdirectory</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">IntegrationID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">UtilsUsed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">RestEnd</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">RestURL</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;http://&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">constants</span><span class="p">.</span><span class="nx">PYTHON_UTILS_SERVICE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">title</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">FunctionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;()&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">FileName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.py&quot;</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">Category</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">category</span>
<span class="w">        </span><span class="nx">savingObject</span><span class="p">.</span><span class="nx">OutputFields</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">outputs</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">savingObject</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="database-design">Database Design</h2>
<h3 id="mongodb-collections-schema">MongoDB Collections Schema</h3>
<h4 id="tasks-collection-custom-utils">tasks Collection (Custom Utils)</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data_transformer&quot;</span><span class="p">,</span><span class="w">           </span><span class="c1">// String: Unique utility name</span>
<span class="w">  </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1001</span><span class="p">,</span><span class="w">                          </span><span class="c1">// Int32: Auto-generated ID</span>
<span class="w">  </span><span class="s2">&quot;displayname&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Data Transformer&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// String: Human-readable name</span>
<span class="w">  </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Transform data&quot;</span><span class="p">,</span><span class="w">      </span><span class="c1">// String: Utility description</span>
<span class="w">  </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;customutils&quot;</span><span class="p">,</span><span class="w">               </span><span class="c1">// String: Always &quot;customutils&quot;</span>
<span class="w">  </span><span class="s2">&quot;fields&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;inputfields\&quot;:[...]}&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// String: JSON-encoded input fields</span>
<span class="w">  </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1640995200000&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Int64: Creation timestamp</span>
<span class="w">  </span><span class="s2">&quot;updateddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1640995200000&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Int64: Update timestamp</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">,</span><span class="w">                  </span><span class="c1">// String: active/draft/inactive</span>
<span class="w">  </span><span class="s2">&quot;tasks_tag&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;custom_utils_data_transformer&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// String: Execution tag</span>
<span class="w">  </span><span class="s2">&quot;task_handler&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Utils&quot;</span><span class="p">,</span><span class="w">             </span><span class="c1">// String: Handler type</span>
<span class="w">  </span><span class="s2">&quot;rest_url&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;http://python-utils:8110/data_transformer&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// String: Service URL</span>
<span class="w">  </span><span class="s2">&quot;method&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w">                    </span><span class="c1">// String: HTTP method</span>
<span class="w">  </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;tenant001&quot;</span><span class="p">,</span><span class="w">           </span><span class="c1">// String: Tenant identifier</span>
<span class="w">  </span><span class="s2">&quot;filename&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data_transformer.py&quot;</span><span class="p">,</span><span class="w">   </span><span class="c1">// String: Python file name</span>
<span class="w">  </span><span class="s2">&quot;packages&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;numpy&quot;</span><span class="p">],</span><span class="w">     </span><span class="c1">// Array: Required packages</span>
<span class="w">  </span><span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;8110&quot;</span><span class="p">,</span><span class="w">                      </span><span class="c1">// String: Service port</span>
<span class="w">  </span><span class="s2">&quot;foldername&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;/opt/zona/custom_utils/python/&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// String: Storage path</span>
<span class="w">  </span><span class="s2">&quot;userid&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1001&quot;</span><span class="p">),</span><span class="w">        </span><span class="c1">// Int64: Creator user ID</span>
<span class="w">  </span><span class="s2">&quot;customutils&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">                 </span><span class="c1">// Boolean: Custom utility flag</span>
<span class="w">  </span><span class="s2">&quot;integration_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w">                </span><span class="c1">// Int32: Integration reference</span>
<span class="w">  </span><span class="s2">&quot;utils_used&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">                 </span><span class="c1">// Boolean: Usage flag</span>
<span class="w">  </span><span class="s2">&quot;rest_end&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;/data_transformer/&quot;</span><span class="p">,</span><span class="w">    </span><span class="c1">// String: Endpoint suffix</span>
<span class="w">  </span><span class="s2">&quot;input_params&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;params\&quot;:[...]}&quot;</span><span class="p">,</span><span class="c1">// String: Input parameters JSON</span>
<span class="w">  </span><span class="s2">&quot;parameters&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">                    </span><span class="c1">// String: Runtime parameters</span>
<span class="w">  </span><span class="s2">&quot;functionname&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data_transformer()&quot;</span><span class="p">,</span><span class="c1">// String: Function name</span>
<span class="w">  </span><span class="s2">&quot;outputfields&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;outputs\&quot;:[...]}&quot;</span><span class="p">,</span><span class="c1">// String: Output definition JSON</span>
<span class="w">  </span><span class="s2">&quot;playbook_name&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span><span class="w">                 </span><span class="c1">// Array: Associated playbooks</span>
<span class="w">  </span><span class="s2">&quot;category&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Data Processing&quot;</span><span class="p">,</span><span class="w">       </span><span class="c1">// String: Utility category</span>
<span class="w">  </span><span class="s2">&quot;filecontents&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">BinData</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">// Binary: Base64 encoded file content</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="task_execution-collection">task_execution Collection</h4>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="s2">&quot;taskid&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1001&quot;</span><span class="p">),</span><span class="w">        </span><span class="c1">// Int64: Task reference</span>
<span class="w">  </span><span class="s2">&quot;userid&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1001&quot;</span><span class="p">),</span><span class="w">        </span><span class="c1">// Int64: User ID</span>
<span class="w">  </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;tenant001&quot;</span><span class="p">,</span><span class="w">           </span><span class="c1">// String: Tenant code</span>
<span class="w">  </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">NumberLong</span><span class="p">(</span><span class="s2">&quot;1640995200000&quot;</span><span class="p">),</span><span class="w"> </span><span class="c1">// Int64: Execution timestamp</span>
<span class="w">  </span><span class="s2">&quot;request&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;data\&quot;:\&quot;...\&quot;}&quot;</span><span class="p">,</span><span class="w">     </span><span class="c1">// String: JSON request data</span>
<span class="w">  </span><span class="s2">&quot;response&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;result\&quot;:\&quot;...\&quot;}&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// String: JSON response data</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="p">,</span><span class="w">               </span><span class="c1">// String: Execution status</span>
<span class="w">  </span><span class="s2">&quot;execution_time&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1.234</span><span class="p">,</span><span class="w">             </span><span class="c1">// Double: Duration in seconds</span>
<span class="w">  </span><span class="s2">&quot;error_message&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w">                 </span><span class="c1">// String: Error details if any</span>
<span class="w">  </span><span class="s2">&quot;logs&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;INFO: Starting...&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">],</span><span class="w"> </span><span class="c1">// Array: Execution logs</span>
<span class="w">  </span><span class="s2">&quot;username&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;john_doe&quot;</span><span class="p">,</span><span class="w">              </span><span class="c1">// String: Executor name</span>
<span class="w">  </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data_transformer&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1">// String: Utility name</span>
<span class="w">  </span><span class="s2">&quot;task_handler&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Utils&quot;</span><span class="w">              </span><span class="c1">// String: Handler type</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="database-indexes">Database Indexes</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Performance indexes for tasks collection</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;idx_name_type_status&quot;</span>
<span class="p">})</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;userid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;idx_tenant_user&quot;</span>
<span class="p">})</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;updateddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;idx_type_status_updated&quot;</span>
<span class="p">})</span>

<span class="c1">// Indexes for task_execution collection</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">task_execution</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;taskid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;userid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;idx_task_user_created&quot;</span>
<span class="p">})</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">task_execution</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;tenantcode&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;idx_tenant_created&quot;</span>
<span class="p">})</span>
</code></pre></div>

<h3 id="data-model-implementation">Data Model Implementation</h3>
<h4 id="core-models">Core Models</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">CustomUtilsObject</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">                 </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;name&quot; bson:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">                   </span><span class="kt">int</span><span class="w">              </span><span class="s">`json:&quot;id&quot; bson:&quot;id&quot;`</span>
<span class="w">    </span><span class="nx">Displayname</span><span class="w">          </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;displayname&quot; bson:&quot;displayname&quot;`</span>
<span class="w">    </span><span class="nx">Description</span><span class="w">          </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;description&quot; bson:&quot;description&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">                 </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;type&quot; bson:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Fields</span><span class="w">               </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;fields&quot; bson:&quot;fields&quot;`</span>
<span class="w">    </span><span class="nx">Createddate</span><span class="w">          </span><span class="kt">int64</span><span class="w">            </span><span class="s">`json:&quot;createddate&quot; bson:&quot;createddate&quot;`</span>
<span class="w">    </span><span class="nx">Updateddate</span><span class="w">          </span><span class="kt">int64</span><span class="w">            </span><span class="s">`json:&quot;updateddate&quot; bson:&quot;updateddate&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">               </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">TasksTag</span><span class="w">             </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;tasks_tag&quot; bson:&quot;tasks_tag&quot;`</span>
<span class="w">    </span><span class="nx">TaskHandler</span><span class="w">          </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;task_handler&quot; bson:&quot;task_handler&quot;`</span>
<span class="w">    </span><span class="nx">RestURL</span><span class="w">              </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;rest_url&quot; bson:&quot;rest_url&quot;`</span>
<span class="w">    </span><span class="nx">Method</span><span class="w">               </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;method&quot; bson:&quot;method&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">           </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;tenantcode&quot; bson:&quot;tenantcode&quot;`</span>
<span class="w">    </span><span class="nx">FileName</span><span class="w">             </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;filename&quot; bson:&quot;filename&quot;`</span>
<span class="w">    </span><span class="nx">Packages</span><span class="w">             </span><span class="p">[]</span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;packages&quot; bson:&quot;packages&quot;`</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">                 </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;port&quot; bson:&quot;port&quot;`</span>
<span class="w">    </span><span class="nx">FolderName</span><span class="w">           </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;foldername&quot; bson:&quot;foldername&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">               </span><span class="kt">int</span><span class="w">              </span><span class="s">`json:&quot;userid&quot; bson:&quot;userid&quot;`</span>
<span class="w">    </span><span class="nx">CustomUtils</span><span class="w">          </span><span class="kt">bool</span><span class="w">             </span><span class="s">`json:&quot;customutils&quot; bson:&quot;customutils&quot;`</span>
<span class="w">    </span><span class="nx">IntegrationID</span><span class="w">        </span><span class="kt">int</span><span class="w">              </span><span class="s">`json:&quot;integration_id&quot; bson:&quot;integration_id&quot;`</span>
<span class="w">    </span><span class="nx">UtilsUsed</span><span class="w">            </span><span class="kt">bool</span><span class="w">             </span><span class="s">`json:&quot;utils_used&quot; bson:&quot;utils_used&quot;`</span>
<span class="w">    </span><span class="nx">RestEnd</span><span class="w">              </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;rest_end&quot; bson:&quot;rest_end&quot;`</span>
<span class="w">    </span><span class="nx">InputParams</span><span class="w">          </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;input_params&quot; bson:&quot;input_params&quot;`</span>
<span class="w">    </span><span class="nx">Parameters</span><span class="w">           </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;parameters&quot; bson:&quot;parameters&quot;`</span>
<span class="w">    </span><span class="nx">FunctionName</span><span class="w">         </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;functionname&quot; bson:&quot;functionname&quot;`</span>
<span class="w">    </span><span class="nx">OutputFields</span><span class="w">         </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;outputfields&quot; bson:&quot;outputfields&quot;`</span>
<span class="w">    </span><span class="nx">PlaybookNames</span><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="w">         </span><span class="s">`json:&quot;playbook_name&quot; bson:&quot;playbook_name&quot;`</span>
<span class="w">    </span><span class="nx">Category</span><span class="w">             </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;category&quot; bson:&quot;category&quot;`</span>
<span class="w">    </span><span class="nx">FileContent</span><span class="w">          </span><span class="nx">primitive</span><span class="p">.</span><span class="nx">Binary</span><span class="w"> </span><span class="s">`json:&quot;filecontents&quot; bson:&quot;filecontents&quot;`</span>
<span class="w">    </span><span class="nx">FileContent_InString</span><span class="w"> </span><span class="kt">string</span><span class="w">           </span><span class="s">`json:&quot;filecontents_instring&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ResponseModel</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Success</span><span class="w">        </span><span class="kt">bool</span><span class="w">        </span><span class="s">`json:&quot;success&quot;`</span>
<span class="w">    </span><span class="nx">Data</span><span class="w">           </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;data&quot;`</span>
<span class="w">    </span><span class="nx">Error</span><span class="w">          </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;error&quot;`</span>
<span class="w">    </span><span class="nx">Time</span><span class="w">           </span><span class="kt">int64</span><span class="w">       </span><span class="s">`json:&quot;time&quot;`</span>
<span class="w">    </span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;displaymessage&quot; bson:&quot;displaymessage&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">         </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">ErrorPath</span><span class="w">      </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;errorpath&quot;`</span>
<span class="w">    </span><span class="nx">SessionExpired</span><span class="w"> </span><span class="kt">bool</span><span class="w">        </span><span class="s">`json:&quot;sessionexpired&quot;`</span>
<span class="w">    </span><span class="nx">Field</span><span class="w">          </span><span class="p">[]</span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;field&quot;`</span>
<span class="w">    </span><span class="nx">Count</span><span class="w">          </span><span class="kt">int</span><span class="w">         </span><span class="s">`json:&quot;count&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="api-implementation">API Implementation</h2>
<h3 id="rest-endpoint-implementation">REST Endpoint Implementation</h3>
<h4 id="createupdate-custom-utility">Create/Update Custom Utility</h4>
<div class="highlight"><pre><span></span><code><span class="err">POST /utils/v1/custom-utils</span>
<span class="err">Content-Type: multipart/form-data</span>

<span class="err">Request Parameters:</span>
<span class="err">- title: string (required)</span>
<span class="err">- description: string (required)</span>
<span class="err">- userid: integer (required)</span>
<span class="err">- tenantcode: string (required)</span>
<span class="err">- input_label: string (required)</span>
<span class="err">- filter_label: string (required)</span>
<span class="err">- required_filter: boolean</span>
<span class="err">- category: string (required)</span>
<span class="err">- filehash: string (for updates)</span>
<span class="err">- username: string (for audit)</span>
<span class="err">- email: string (for audit)</span>
<span class="err">- output: string (output definitions)</span>
<span class="err">- taskid: integer (for updates)</span>
<span class="err">- oldtitle: string (for renames)</span>
<span class="err">- code: file (Python code file)</span>
</code></pre></div>

<h4 id="implementation-example">Implementation Example</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cu</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomUtilsController</span><span class="p">)</span><span class="w"> </span><span class="nx">UpsertCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Parse multipart form</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">ParseMultipartForm</span><span class="p">(</span><span class="mi">32</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="c1">// 32MB limit</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Invalid form data&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Validate required fields</span>
<span class="w">    </span><span class="nx">title</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">FormValue</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span>
<span class="w">            </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;missing title&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Utility name is required&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process request</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">services</span><span class="p">.</span><span class="nx">CreateOrUpdateUtils</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="get-custom-utilities">Get Custom Utilities</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cu</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomUtilsController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetCustomUtils</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span>
<span class="w">    </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">vars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mux</span><span class="p">.</span><span class="nx">Vars</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>

<span class="w">    </span><span class="nx">tenantCode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;tenant-code&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">utilsName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">vars</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// Get database client for tenant</span>
<span class="w">    </span><span class="nx">mongoDbClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">].</span><span class="nx">Client</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">mongoDbClient</span><span class="p">.</span><span class="nx">Client</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create new connection if not exists</span>
<span class="w">        </span><span class="nx">coreMongoDbClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">[</span><span class="s">&quot;localhost&quot;</span><span class="p">].</span><span class="nx">Client</span>
<span class="w">        </span><span class="nx">mongoDbClient</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">GetTenantDBClient</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">,</span><span class="w"> </span><span class="nx">coreMongoDbClient</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span>
<span class="w">                </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Database connection failed&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">sessionStruct</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">sessionStruct</span><span class="p">.</span><span class="nx">Client</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mongoDbClient</span>
<span class="w">        </span><span class="nx">dbSession</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sessionStruct</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Build query</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">filter</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">utilsName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$in&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;active&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;draft&quot;</span><span class="p">}},</span>
<span class="w">            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">utilsName</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customutils&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$in&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;active&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;draft&quot;</span><span class="p">}},</span>
<span class="w">            </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;customutils&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Execute query</span>
<span class="w">    </span><span class="nx">utilsData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">CustomUtilsResponse</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">projection</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;displayname&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;createddate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updateddate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="c1">// ... other fields</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">options</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">Find</span><span class="p">().</span><span class="nx">SetProjection</span><span class="p">(</span><span class="nx">projection</span><span class="p">).</span><span class="nx">SetSort</span><span class="p">(</span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;updateddate&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">}})</span>
<span class="w">    </span><span class="nx">mongoDbClient</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;taskCollection&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mongoDbClient</span><span class="p">.</span><span class="nx">FindMultipleDocuments</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">utilsData</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">,</span>
<span class="w">            </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to retrieve utilities&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Calculate file hashes</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">utilsData</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">localUtils</span><span class="p">.</span><span class="nx">CalculateFileHash</span><span class="p">(</span>
<span class="w">            </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;customUtilsCodeDirectory&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;python/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">utilsData</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">FileName</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Unable to calculate file hash: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">utilsData</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">FileHash</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">hash</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">utilsData</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">utilsData</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">utilsData</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;No utilities found&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="middleware-implementation">Middleware Implementation</h3>
<h4 id="logging-middleware">Logging Middleware</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">MiddleWareData</span><span class="p">{}</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="p">.</span><span class="nx">LogRequestResponse</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">RequestResponseLog</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="p">.</span><span class="nx">DBSession</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span>

<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">MiddleWareForMongoDriver</span><span class="p">(</span><span class="nx">next</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="nx">constants</span><span class="p">.</span><span class="nx">SkipRoutes</span><span class="p">,</span><span class="w"> </span><span class="nx">constants</span><span class="p">.</span><span class="nx">SkipURI</span><span class="p">,</span><span class="w"> </span><span class="nx">middleWareData</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error in Middleware: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">            </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">common</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error in creating Tenant Session&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="security-implementation">Security Implementation</h2>
<h3 id="input-validation">Input Validation</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">validateUtilityName</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;utility name is required&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;utility name too long (max 50 characters)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check for valid characters (alphanumeric and underscore only)</span>
<span class="w">    </span><span class="nx">validName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`^[a-zA-Z0-9_]+$`</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">validName</span><span class="p">.</span><span class="nx">MatchString</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;utility name contains invalid characters&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Check for reserved names</span>
<span class="w">    </span><span class="nx">reservedNames</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;main&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;init&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;admin&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">reserved</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">reservedNames</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">reserved</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;utility name is reserved&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="code-validation-rules">Code Validation Rules</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ValidationRule</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">     </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Pattern</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Severity</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Message</span><span class="w">  </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">PythonValidationRules</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="nx">ValidationRule</span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;NoImportOS&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Pattern</span><span class="p">:</span><span class="w">  </span><span class="s">`import\s+os|from\s+os\s+import`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HIGH&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;OS module imports are not allowed for security reasons&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;NoSubprocess&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nx">Pattern</span><span class="p">:</span><span class="w">  </span><span class="s">`import\s+subprocess|from\s+subprocess\s+import`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HIGH&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Subprocess module is not allowed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;NoFileSystem&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Pattern</span><span class="p">:</span><span class="w">  </span><span class="s">`open\s*\(|file\s*\(`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MEDIUM&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Direct file operations should be reviewed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;NoNetwork&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Pattern</span><span class="p">:</span><span class="w">  </span><span class="s">`socket\.|urllib\.|requests\.`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;MEDIUM&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Network operations should be reviewed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;NoExec&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Pattern</span><span class="p">:</span><span class="w">  </span><span class="s">`exec\s*\(|eval\s*\(`</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HIGH&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;Dynamic code execution is not allowed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ValidateCode</span><span class="p">(</span><span class="nx">code</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="nx">ValidationResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">[]</span><span class="nx">ValidationResult</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rule</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">PythonValidationRules</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">matched</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MatchString</span><span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">Pattern</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">matched</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">results</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">ValidationResult</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Rule</span><span class="p">:</span><span class="w">     </span><span class="nx">rule</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Severity</span><span class="p">:</span><span class="w"> </span><span class="nx">rule</span><span class="p">.</span><span class="nx">Severity</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Message</span><span class="p">:</span><span class="w">  </span><span class="nx">rule</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Line</span><span class="p">:</span><span class="w">     </span><span class="nx">findLineNumber</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">rule</span><span class="p">.</span><span class="nx">Pattern</span><span class="p">),</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="encryption-implementation">Encryption Implementation</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">EncryptFileContent</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">aes</span><span class="p">.</span><span class="nx">NewCipher</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">gcm</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">NewGCM</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">nonce</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">NonceSize</span><span class="p">())</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadFull</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Reader</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">ciphertext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">Seal</span><span class="p">(</span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">content</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">base64</span><span class="p">.</span><span class="nx">StdEncoding</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">ciphertext</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">DecryptFileContent</span><span class="p">(</span><span class="nx">encryptedContent</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">base64</span><span class="p">.</span><span class="nx">StdEncoding</span><span class="p">.</span><span class="nx">DecodeString</span><span class="p">(</span><span class="nx">encryptedContent</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">block</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">aes</span><span class="p">.</span><span class="nx">NewCipher</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">gcm</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cipher</span><span class="p">.</span><span class="nx">NewGCM</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">nonceSize</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">NonceSize</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">nonceSize</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;ciphertext too short&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">data</span><span class="p">[:</span><span class="nx">nonceSize</span><span class="p">],</span><span class="w"> </span><span class="nx">data</span><span class="p">[</span><span class="nx">nonceSize</span><span class="p">:]</span>
<span class="w">    </span><span class="nx">plaintext</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gcm</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">ciphertext</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">plaintext</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="performance-implementation">Performance Implementation</h2>
<h3 id="caching-strategy">Caching Strategy</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">CacheManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">redisClient</span><span class="w"> </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span>
<span class="w">    </span><span class="nx">localCache</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Get</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Try L1 cache first (local memory)</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">localCache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Try L2 cache (Redis)</span>
<span class="w">    </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redisClient</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Store in L1 cache for faster access</span>
<span class="w">        </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">        </span><span class="nx">cm</span><span class="p">.</span><span class="nx">localCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<span class="w">        </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Set</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Store in both L1 and L2 cache</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">localCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Store in Redis with TTL</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">redisClient</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">).</span><span class="nx">Err</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="database-connection-pooling">Database Connection Pooling</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">InitMongoClient</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">Client</span><span class="p">().</span><span class="nx">ApplyURI</span><span class="p">(</span><span class="nx">mongoURI</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Connection pool settings</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="p">.</span><span class="nx">SetMaxPoolSize</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w">           </span><span class="c1">// Maximum connections</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="p">.</span><span class="nx">SetMinPoolSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">            </span><span class="c1">// Minimum connections</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="p">.</span><span class="nx">SetMaxConnIdleTime</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span><span class="w"> </span><span class="c1">// Idle timeout</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="p">.</span><span class="nx">SetConnectTimeout</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w">  </span><span class="c1">// Connection timeout</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="p">.</span><span class="nx">SetSocketTimeout</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w">   </span><span class="c1">// Socket timeout</span>

<span class="w">    </span><span class="c1">// Create client</span>
<span class="w">    </span><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">clientOptions</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Verify connection</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Ping</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="query-optimization">Query Optimization</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">GetUtilitiesOptimized</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">models</span><span class="p">.</span><span class="nx">CustomUtilsResponse</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Use aggregation pipeline for complex queries</span>
<span class="w">    </span><span class="nx">pipeline</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Match stage - filter documents</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$match&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;tenantcode&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">tenantCode</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;userid&quot;</span><span class="p">:</span><span class="w">     </span><span class="nx">userID</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;customutils&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">     </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$in&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;active&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;draft&quot;</span><span class="p">}},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// Project stage - select only needed fields</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$project&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">        </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;displayname&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">      </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;createddate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;updateddate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;category&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w">         </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// Sort stage - order by update date</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$sort&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;updateddate&quot;</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// Skip stage - for pagination</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$skip&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="c1">// Limit stage - limit results</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">limit</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">cursor</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">Aggregate</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">pipeline</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">Close</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">CustomUtilsResponse</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cursor</span><span class="p">.</span><span class="nx">All</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">results</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="error-handling-implementation">Error Handling Implementation</h2>
<h3 id="error-types-and-handling">Error Types and Handling</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ErrorType</span><span class="w"> </span><span class="kt">string</span>

<span class="kd">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">ValidationError</span><span class="w"> </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;VALIDATION_ERROR&quot;</span>
<span class="w">    </span><span class="nx">DatabaseError</span><span class="w">   </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;DATABASE_ERROR&quot;</span>
<span class="w">    </span><span class="nx">FileSystemError</span><span class="w"> </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;FILESYSTEM_ERROR&quot;</span>
<span class="w">    </span><span class="nx">SecurityError</span><span class="w">   </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;SECURITY_ERROR&quot;</span>
<span class="w">    </span><span class="nx">ContainerError</span><span class="w">  </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;CONTAINER_ERROR&quot;</span>
<span class="w">    </span><span class="nx">NetworkError</span><span class="w">    </span><span class="nx">ErrorType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;NETWORK_ERROR&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CustomError</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">        </span><span class="nx">ErrorType</span><span class="w"> </span><span class="s">`json:&quot;type&quot;`</span>
<span class="w">    </span><span class="nx">Code</span><span class="w">        </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;code&quot;`</span>
<span class="w">    </span><span class="nx">Message</span><span class="w">     </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;message&quot;`</span>
<span class="w">    </span><span class="nx">Details</span><span class="w">     </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;details&quot;`</span>
<span class="w">    </span><span class="nx">Timestamp</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`json:&quot;timestamp&quot;`</span>
<span class="w">    </span><span class="nx">RequestID</span><span class="w">   </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;request_id&quot;`</span>
<span class="w">    </span><span class="nx">UserMessage</span><span class="w"> </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;user_message&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomError</span><span class="p">)</span><span class="w"> </span><span class="nx">Error</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;[%s] %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Details</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewValidationError</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">details</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomError</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CustomError</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w">        </span><span class="nx">ValidationError</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Code</span><span class="p">:</span><span class="w">        </span><span class="nx">code</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">     </span><span class="nx">message</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Details</span><span class="p">:</span><span class="w">     </span><span class="nx">details</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">UserMessage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Please check your input and try again&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="error-handler-implementation">Error Handler Implementation</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">userMessage</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Success</span><span class="p">:</span><span class="w">        </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Time</span><span class="p">:</span><span class="w">           </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">        </span><span class="nx">DisplayMessage</span><span class="p">:</span><span class="w"> </span><span class="nx">userMessage</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Log the error</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error occurred: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>

<span class="w">    </span><span class="c1">// Determine error type and set appropriate response</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">err</span><span class="p">.(</span><span class="kd">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">CustomError</span><span class="p">:</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Code</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">ErrorPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Type</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">UserMessage</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">*</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">WriteError</span><span class="p">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">Code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">11000</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Duplicate key error</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;DUPLICATE_ENTRY&quot;</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;A utility with this name already exists&quot;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;DATABASE_ERROR&quot;</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Database operation failed&quot;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">Error</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;INTERNAL_ERROR&quot;</span>
<span class="w">        </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">userMessage</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="panic-recovery-middleware">Panic Recovery Middleware</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">RecoveryMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Panic recovered: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>

<span class="w">                </span><span class="c1">// Log stack trace</span>
<span class="w">                </span><span class="nx">debug</span><span class="p">.</span><span class="nx">PrintStack</span><span class="p">()</span>

<span class="w">                </span><span class="c1">// Return error response</span>
<span class="w">                </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="p">{</span>
<span class="w">                    </span><span class="nx">Success</span><span class="p">:</span><span class="w">        </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">Error</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;INTERNAL_ERROR&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">DisplayMessage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;An unexpected error occurred&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">Time</span><span class="p">:</span><span class="w">           </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span><span class="p">)</span>
<span class="w">                </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}()</span>

<span class="w">        </span><span class="nx">next</span><span class="p">.</span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="monitoring-and-logging-implementation">Monitoring and Logging Implementation</h2>
<h3 id="structured-logging">Structured Logging</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">LogEntry</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Timestamp</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">              </span><span class="s">`json:&quot;timestamp&quot;`</span>
<span class="w">    </span><span class="nx">Level</span><span class="w">       </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;level&quot;`</span>
<span class="w">    </span><span class="nx">Service</span><span class="w">     </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;service&quot;`</span>
<span class="w">    </span><span class="nx">Component</span><span class="w">   </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;component&quot;`</span>
<span class="w">    </span><span class="nx">Function</span><span class="w">    </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;function&quot;`</span>
<span class="w">    </span><span class="nx">Message</span><span class="w">     </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;message&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">  </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;tenant_code,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">      </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;user_id,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">RequestID</span><span class="w">   </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;request_id,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Duration</span><span class="w">    </span><span class="kt">float64</span><span class="w">                </span><span class="s">`json:&quot;duration_ms,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Metadata</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;metadata,omitempty&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">LogRequest</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span><span class="w"> </span><span class="nx">statusCode</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">entry</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">LogEntry</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">Level</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Service</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;zona-custom-utils&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Component</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTP&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Function</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;RequestHandler&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Message</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;HTTP request processed&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">RequestID</span><span class="p">:</span><span class="w"> </span><span class="nx">getRequestID</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Duration</span><span class="p">:</span><span class="w">  </span><span class="nb">float64</span><span class="p">(</span><span class="nx">duration</span><span class="p">.</span><span class="nx">Nanoseconds</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Metadata</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">            </span><span class="s">&quot;method&quot;</span><span class="p">:</span><span class="w">      </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;status_code&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">statusCode</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;user_agent&quot;</span><span class="p">:</span><span class="w">  </span><span class="nx">r</span><span class="p">.</span><span class="nx">UserAgent</span><span class="p">(),</span>
<span class="w">            </span><span class="s">&quot;remote_addr&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">logJSON</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">logJSON</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="metrics-collection">Metrics Collection</h3>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">requestDuration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">NewHistogramVec</span><span class="p">(</span>
<span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">HistogramOpts</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http_request_duration_seconds&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTP request duration in seconds&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Buckets</span><span class="p">:</span><span class="w"> </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">DefBuckets</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;method&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">activeConnections</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">NewGauge</span><span class="p">(</span>
<span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">GaugeOpts</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active_database_connections&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Number of active database connections&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">utilityExecutions</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">NewCounterVec</span><span class="p">(</span>
<span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">CounterOpts</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;utility_executions_total&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Total number of utility executions&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;tenant&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;utility&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">MustRegister</span><span class="p">(</span><span class="nx">requestDuration</span><span class="p">)</span>
<span class="w">    </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">MustRegister</span><span class="p">(</span><span class="nx">activeConnections</span><span class="p">)</span>
<span class="w">    </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">MustRegister</span><span class="p">(</span><span class="nx">utilityExecutions</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">MetricsMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>

<span class="w">        </span><span class="nx">wrapped</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">statusWriter</span><span class="p">{</span><span class="nx">ResponseWriter</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">statusCode</span><span class="p">:</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">}</span>
<span class="w">        </span><span class="nx">next</span><span class="p">.</span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>

<span class="w">        </span><span class="nx">duration</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>
<span class="w">        </span><span class="nx">requestDuration</span><span class="p">.</span><span class="nx">WithLabelValues</span><span class="p">(</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span>
<span class="w">            </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">),</span>
<span class="w">        </span><span class="p">).</span><span class="nx">Observe</span><span class="p">(</span><span class="nx">duration</span><span class="p">.</span><span class="nx">Seconds</span><span class="p">())</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="health-check-implementation">Health Check Implementation</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">HealthCheck</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">    </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">Timestamp</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">              </span><span class="s">`json:&quot;timestamp&quot;`</span>
<span class="w">    </span><span class="nx">Version</span><span class="w">   </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;version&quot;`</span>
<span class="w">    </span><span class="nx">Uptime</span><span class="w">    </span><span class="kt">string</span><span class="w">                 </span><span class="s">`json:&quot;uptime&quot;`</span>
<span class="w">    </span><span class="nx">Checks</span><span class="w">    </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">CheckResult</span><span class="w"> </span><span class="s">`json:&quot;checks&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CheckResult</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">  </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">Message</span><span class="w"> </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;message,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Latency</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span><span class="s">`json:&quot;latency_ms&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">HealthCheckHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">health</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">HealthCheck</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Status</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">Version</span><span class="p">:</span><span class="w">   </span><span class="nx">version</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Uptime</span><span class="p">:</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">).</span><span class="nx">String</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">Checks</span><span class="p">:</span><span class="w">    </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">CheckResult</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Database health check</span>
<span class="w">    </span><span class="nx">dbStart</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">checkDatabaseHealth</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;database&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;unhealthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">dbStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;unhealthy&quot;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;database&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">dbStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Cache health check</span>
<span class="w">    </span><span class="nx">cacheStart</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">checkCacheHealth</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;cache&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;unhealthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">cacheStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;degraded&quot;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;cache&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">cacheStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Docker health check</span>
<span class="w">    </span><span class="nx">dockerStart</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">checkDockerHealth</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;docker&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;unhealthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">dockerStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;degraded&quot;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="p">.</span><span class="nx">Checks</span><span class="p">[</span><span class="s">&quot;docker&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">CheckResult</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Latency</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">dockerStart</span><span class="p">),</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Set response status</span>
<span class="w">    </span><span class="nx">statusCode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">health</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;unhealthy&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">statusCode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusServiceUnavailable</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">WriteHeader</span><span class="p">(</span><span class="nx">statusCode</span><span class="p">)</span>
<span class="w">    </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">health</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="configuration-management">Configuration Management</h2>
<h3 id="configuration-structure">Configuration Structure</h3>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Config</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Server</span><span class="w">   </span><span class="nx">ServerConfig</span><span class="w">   </span><span class="s">`json:&quot;server&quot;`</span>
<span class="w">    </span><span class="nx">Database</span><span class="w"> </span><span class="nx">DatabaseConfig</span><span class="w"> </span><span class="s">`json:&quot;database&quot;`</span>
<span class="w">    </span><span class="nx">Cache</span><span class="w">    </span><span class="nx">CacheConfig</span><span class="w">    </span><span class="s">`json:&quot;cache&quot;`</span>
<span class="w">    </span><span class="nx">Security</span><span class="w"> </span><span class="nx">SecurityConfig</span><span class="w"> </span><span class="s">`json:&quot;security&quot;`</span>
<span class="w">    </span><span class="nx">Storage</span><span class="w">  </span><span class="nx">StorageConfig</span><span class="w">  </span><span class="s">`json:&quot;storage&quot;`</span>
<span class="w">    </span><span class="nx">Docker</span><span class="w">   </span><span class="nx">DockerConfig</span><span class="w">   </span><span class="s">`json:&quot;docker&quot;`</span>
<span class="w">    </span><span class="nx">Logging</span><span class="w">  </span><span class="nx">LoggingConfig</span><span class="w">  </span><span class="s">`json:&quot;logging&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ServerConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">                </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;port&quot;`</span>
<span class="w">    </span><span class="nx">ReadTimeout</span><span class="w">         </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;read_timeout&quot;`</span>
<span class="w">    </span><span class="nx">WriteTimeout</span><span class="w">        </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;write_timeout&quot;`</span>
<span class="w">    </span><span class="nx">IdleTimeout</span><span class="w">         </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;idle_timeout&quot;`</span>
<span class="w">    </span><span class="nx">MaxHeaderBytes</span><span class="w">      </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;max_header_bytes&quot;`</span>
<span class="w">    </span><span class="nx">LogRequestResponse</span><span class="w">  </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;log_request_response&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DatabaseConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Host</span><span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;host&quot;`</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">            </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;port&quot;`</span>
<span class="w">    </span><span class="nx">Database</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;database&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;username&quot;`</span>
<span class="w">    </span><span class="nx">Password</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;password&quot;`</span>
<span class="w">    </span><span class="nx">MaxPoolSize</span><span class="w">     </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;max_pool_size&quot;`</span>
<span class="w">    </span><span class="nx">MinPoolSize</span><span class="w">     </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;min_pool_size&quot;`</span>
<span class="w">    </span><span class="nx">ConnectTimeout</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;connect_timeout&quot;`</span>
<span class="w">    </span><span class="nx">SocketTimeout</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;socket_timeout&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="environment-based-configuration">Environment-based Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">LoadConfig</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Config</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Config</span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// Set defaults</span>
<span class="w">    </span><span class="nx">setDefaults</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Load from file if exists</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">configFile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;CONFIG_FILE&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">configFile</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">loadFromFile</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="nx">configFile</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Override with environment variables</span>
<span class="w">    </span><span class="nx">overrideWithEnv</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Validate configuration</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">validateConfig</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">config</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">overrideWithEnv</span><span class="p">(</span><span class="nx">config</span><span class="w"> </span><span class="o">*</span><span class="nx">Config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;SERVER_PORT&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">port</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">config</span><span class="p">.</span><span class="nx">Server</span><span class="p">.</span><span class="nx">Port</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">p</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;DB_HOST&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">config</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Host</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">host</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;DB_PASSWORD&quot;</span><span class="p">);</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">config</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Password</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">password</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ... additional environment variable overrides</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="development-guidelines">Development Guidelines</h2>
<h3 id="code-organization-standards">Code Organization Standards</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Package structure guidelines</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">controllers</span><span class="w">  </span><span class="c1">// HTTP request handlers</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">services</span><span class="w">     </span><span class="c1">// Business logic implementation</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">models</span><span class="w">       </span><span class="c1">// Data structures and types</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">utils</span><span class="w">        </span><span class="c1">// Utility functions and helpers</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">builders</span><span class="w">     </span><span class="c1">// Object construction patterns</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">handlers</span><span class="w">     </span><span class="c1">// Error handling utilities</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">constants</span><span class="w">    </span><span class="c1">// Application constants</span>

<span class="c1">// Naming conventions</span>
<span class="c1">// Constants: UPPER_SNAKE_CASE</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">MAX_FILE_SIZE</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">10485760</span>

<span class="c1">// Functions: PascalCase for exported, camelCase for private</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">CreateCustomUtils</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">validateInput</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>

<span class="c1">// Structs: PascalCase</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">CustomUtilsController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Variables: camelCase</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;zona_custom_utils&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="error-handling-patterns">Error Handling Patterns</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Always handle errors explicitly</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">someOperation</span><span class="p">()</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Operation failed: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User-friendly message&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Use structured error responses</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleDatabaseError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ResponseModel</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Success</span><span class="p">:</span><span class="w">        </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Error</span><span class="p">:</span><span class="w">          </span><span class="s">&quot;DATABASE_ERROR&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">DisplayMessage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Database operation failed&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ErrorPath</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;DatabaseLayer&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Time</span><span class="p">:</span><span class="w">           </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="security-best-practices">Security Best Practices</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Input validation example</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">validateInput</span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Check for SQL injection patterns</span>
<span class="w">    </span><span class="nx">sqlPatterns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;--&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xp_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sp_&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">pattern</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">sqlPatterns</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span><span class="w"> </span><span class="nx">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;potentially malicious input detected&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Length validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;input too long&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Character validation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">MustCompile</span><span class="p">(</span><span class="s">`^[a-zA-Z0-9\s\-_\.]+$`</span><span class="p">).</span><span class="nx">MatchString</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;invalid characters in input&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Secure file handling</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">secureFileOperation</span><span class="p">(</span><span class="nx">filename</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Prevent path traversal</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;..&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;path traversal attempt detected&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Validate file extension</span>
<span class="w">    </span><span class="nx">allowedExts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;.py&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.json&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">ext</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Ext</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
<span class="w">    </span><span class="nx">isAllowed</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">allowed</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">allowedExts</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">allowed</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">isAllowed</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">isAllowed</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;file type not allowed&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="unit-test-implementation">Unit Test Implementation</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestCreateCustomUtils</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Setup test environment</span>
<span class="w">    </span><span class="nx">mockDB</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">setupMockDatabase</span><span class="p">()</span>
<span class="w">    </span><span class="nx">mockConfig</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">setupMockConfig</span><span class="p">()</span>
<span class="w">    </span><span class="nx">service</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">services</span><span class="p">.</span><span class="nx">NewUtilsService</span><span class="p">(</span><span class="nx">mockDB</span><span class="p">,</span><span class="w"> </span><span class="nx">mockConfig</span><span class="p">)</span>

<span class="w">    </span><span class="nx">tests</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w">           </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">input</span><span class="w">          </span><span class="nx">CreateUtilRequest</span>
<span class="w">        </span><span class="nx">expectedResult</span><span class="w"> </span><span class="kt">bool</span>
<span class="w">        </span><span class="nx">expectedError</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}{</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Valid utility creation&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">input</span><span class="p">:</span><span class="w"> </span><span class="nx">CreateUtilRequest</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Title</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;test_utility&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test utility for unit testing&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                </span><span class="nx">TenantCode</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;test_tenant&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Code</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;def test_function():\n    return &#39;Hello World&#39;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">expectedResult</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">expectedError</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Invalid utility name&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">input</span><span class="p">:</span><span class="w"> </span><span class="nx">CreateUtilRequest</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Title</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test utility&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                </span><span class="nx">TenantCode</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;test_tenant&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Code</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;def test_function():\n    return &#39;Hello World&#39;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">expectedResult</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">expectedError</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;utility name is required&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Malicious code detection&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">input</span><span class="p">:</span><span class="w"> </span><span class="nx">CreateUtilRequest</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Title</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;malicious_utility&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Malicious utility&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="mi">1001</span><span class="p">,</span>
<span class="w">                </span><span class="nx">TenantCode</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;test_tenant&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Code</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;import os\nos.system(&#39;rm -rf /&#39;)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">expectedResult</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nx">expectedError</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;prohibited code patterns detected&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">t</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">CreateUtility</span><span class="p">(</span><span class="nx">tt</span><span class="p">.</span><span class="nx">input</span><span class="p">)</span>

<span class="w">            </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expectedResult</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Success</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expectedError</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">tt</span><span class="p">.</span><span class="nx">expectedError</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="integration-test-example">Integration Test Example</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestUtilityEndToEnd</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Setup test server</span>
<span class="w">    </span><span class="nx">testServer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">httptest</span><span class="p">.</span><span class="nx">NewServer</span><span class="p">(</span><span class="nx">setupTestApp</span><span class="p">())</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">testServer</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Test utility creation</span>
<span class="w">    </span><span class="nx">createPayload</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;title&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;integration_test_utility&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Integration test utility&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;userid&quot;</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;1001&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;tenantcode&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;test_tenant&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;category&quot;</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Testing&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">createBody</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">createPayload</span><span class="p">)</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Post</span><span class="p">(</span><span class="nx">testServer</span><span class="p">.</span><span class="nx">URL</span><span class="o">+</span><span class="s">&quot;/utils/v1/custom-utils&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;application/json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">createBody</span><span class="p">))</span>

<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test utility retrieval</span>
<span class="w">    </span><span class="nx">getResp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">testServer</span><span class="p">.</span><span class="nx">URL</span><span class="o">+</span><span class="s">&quot;/utils/v1/custom-utils/test_tenant/1001/integration_test_utility&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">getResp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Test utility deletion</span>
<span class="w">    </span><span class="nx">deletePayload</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;functionname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integration_test_utility&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;tenantcode&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;test_tenant&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;userid&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;1001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">deleteBody</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">deletePayload</span><span class="p">)</span>
<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;DELETE&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">testServer</span><span class="p">.</span><span class="nx">URL</span><span class="o">+</span><span class="s">&quot;/utils/v1/custom-utils&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">deleteBody</span><span class="p">))</span>
<span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">deleteResp</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>

<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">NoError</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">deleteResp</span><span class="p">.</span><span class="nx">StatusCode</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="deployment-implementation">Deployment Implementation</h2>
<h3 id="docker-configuration">Docker Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Multi-stage build for optimal image size</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.17-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>

<span class="c"># Install build dependencies</span>
<span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>--no-cache<span class="w"> </span>add<span class="w"> </span>make<span class="w"> </span>git<span class="w"> </span>bash<span class="w"> </span>ca-certificates<span class="w"> </span>curl

<span class="c"># Copy source code</span>
<span class="k">COPY</span><span class="w"> </span>./<span class="w"> </span>/project
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/project</span>

<span class="c"># Set Go module mode</span>
<span class="k">ENV</span><span class="w"> </span><span class="nv">GOFLAGS</span><span class="o">=</span><span class="s2">&quot;-mod=vendor&quot;</span>

<span class="c"># Build stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">builder</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
<span class="k">ARG</span><span class="w"> </span>GIT_REF
<span class="k">ARG</span><span class="w"> </span>GIT_BRANCH
<span class="k">ARG</span><span class="w"> </span>BUILD_NUMBER
<span class="k">ARG</span><span class="w"> </span>BUILD_VERSION
<span class="k">ARG</span><span class="w"> </span>TARGET

<span class="c"># Production stage</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span>

<span class="c"># Set build labels</span>
<span class="k">LABEL</span><span class="w"> </span><span class="nv">gitBranch</span><span class="o">=</span><span class="nv">$GIT_BRANCH</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">build</span><span class="o">=</span><span class="nv">$BUILD_NUMBER</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">gitRef</span><span class="o">=</span><span class="nv">$GIT_REF</span><span class="w"> </span><span class="se">\</span>
<span class="w">      </span><span class="nv">version</span><span class="o">=</span><span class="nv">$BUILD_VERSION</span>

<span class="c"># Copy binary from build stage</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build<span class="w"> </span>/project/build/<span class="nv">$TARGET</span><span class="w"> </span>/<span class="nv">$TARGET</span>

<span class="c"># Create run script</span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;#!/usr/bin/env sh&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>run.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;exec&#39;</span><span class="w"> </span><span class="s2">&quot;/</span><span class="nv">$TARGET</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>run.sh<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>run.sh

<span class="c"># Install runtime dependencies</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gnupg<span class="w"> </span>python3-pip<span class="w"> </span>software-properties-common

<span class="c"># Install Docker CLI</span>
<span class="k">RUN</span><span class="w"> </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>add-apt-repository<span class="w"> </span><span class="s2">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce-cli

<span class="c"># Create necessary directories</span>
<span class="k">VOLUME</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/opt/zona/&quot;</span><span class="p">]</span>
<span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/zona/logs

<span class="c"># Expose service port</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8109</span>

<span class="c"># Set startup command</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/run.sh&quot;</span><span class="p">]</span>
</code></pre></div>

<h3 id="cicd-pipeline-configuration">CI/CD Pipeline Configuration</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># .github/workflows/deploy.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build and Deploy</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Go</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-go@v2</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">go-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.17</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">go test -v ./...</span>
<span class="w">        </span><span class="no">go test -race -coverprofile=coverage.out ./...</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload coverage</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v1</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./coverage.out</span>

<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Docker image</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">docker build -t zona/custom-utils:${{ github.sha }} .</span>
<span class="w">        </span><span class="no">docker tag zona/custom-utils:${{ github.sha }} zona/custom-utils:latest</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Push to registry</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin</span>
<span class="w">        </span><span class="no">docker push zona/custom-utils:${{ github.sha }}</span>
<span class="w">        </span><span class="no">docker push zona/custom-utils:latest</span>

<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to production</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">docker stack deploy -c docker-compose.yml zona-custom-utils</span>
</code></pre></div>

<hr />
<p><em>This Low-Level Design document provides comprehensive technical implementation details for the Zona Custom Utils Service, covering code structure, database implementation, API details, security measures, performance optimizations, error handling, monitoring, configuration management, development guidelines, testing strategies, and deployment procedures.</em></p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 18, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
