<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Securaa Custom Utils - High Level Design - Securaa Platform Documentation</title>
    <link rel="stylesheet" href="assets/css/documentation.css">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.4/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header class="main-header">
        <h1>Securaa Platform Documentation</h1>
        <p>Comprehensive documentation for Securaa security platform services</p>
    </header>
    
    <nav class="documentation-nav">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="securaa-playbook-high-level-design.html">Securaa Playbook High Level Design</a></li>
            <li><a href="securaa-playbook-low-level-design.html">Securaa Playbook Low Level Design</a></li>
            <li><a href="optimization-guide.html">Optimization Guide</a></li>
            <li><a href="securaa-siem-high-level-design.html">Securaa SIEM High Level Design</a></li>
            <li><a href="securaa-siem-low-level-design.html">Securaa SIEM Low Level Design</a></li>
            <li><a href="securaa-platform-high-level-design.html">Securaa Platform</a></li>
            <li><a href="process-manager-high-level-design.html">Process Manager High Level Design</a></li>
            <li><a href="process-manager-low-level-design.html">Process Manager Low Level Design</a></li>
            <li><a href="securaa-user-high-level-design.html">Securaa User High Level Design</a></li>
            <li><a href="securaa-user-low-level-design.html">Securaa User Low Level Design</a></li>
            <li><a href="securaa-custom-services-high-level-design.html">Securaa Custom Services High Level Design</a></li>
            <li><a href="securaa-custom-services-low-level-design.html">Securaa Custom Services Low Level Design</a></li>
            <li><a href="securaa-custom-utils-high-level-design.html" class="active">Securaa Custom Utils High Level Design</a></li>
            <li><a href="securaa-custom-utils-low-level-design.html">Securaa Custom Utils Low Level Design</a></li>
        </ul>
    </nav>
    
    <main class="main-content">
        <h1>Zona Custom Utils Service - High-Level Design (HLD)</h1>

        <h2>Document Information</h2>
        <ul>
            <li><strong>Service Name</strong>: Zona Custom Utils Service</li>
            <li><strong>Version</strong>: 1.0</li>
            <li><strong>Date</strong>: December 2024</li>
            <li><strong>Author</strong>: Development Team</li>
            <li><strong>Related Documents</strong>: <a href="securaa-custom-utils-low-level-design.html">Low Level Design</a></li>
        </ul>
        
        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="openTab(event, 'overview')">Overview</button>
                <button class="tab-btn" onclick="openTab(event, 'architecture')">Architecture</button>
                <button class="tab-btn" onclick="openTab(event, 'components')">Components</button>
                <button class="tab-btn" onclick="openTab(event, 'data')">Data Model</button>
                <button class="tab-btn" onclick="openTab(event, 'security')">Security</button>
                <button class="tab-btn" onclick="openTab(event, 'performance')">Performance</button>
                <button class="tab-btn" onclick="openTab(event, 'deployment')">Deployment</button>
                <button class="tab-btn" onclick="openTab(event, 'flows')">Process Flows</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <h2>Executive Summary</h2>
                <p>The Zona Custom Utils Service is a microservice designed to enable users to create, manage, and execute custom utility functions in a secure, multi-tenant environment. The service supports Python-based transformers and scripts, providing isolated execution environments through containerization while maintaining comprehensive audit trails and performance optimization.</p>

                <h3>Key Business Value</h3>
                <ul>
                    <li><strong>Extensibility</strong>: Allows users to create custom data processing utilities</li>
                    <li><strong>Security</strong>: Provides secure code validation and isolated execution</li>
                    <li><strong>Multi-tenancy</strong>: Supports multiple tenants with data isolation</li>
                    <li><strong>Scalability</strong>: Designed for high-volume, concurrent operations</li>
                    <li><strong>Compliance</strong>: Comprehensive audit logging for regulatory requirements</li>
                </ul>

                <h3>Solution Approach</h3>
                <ul>
                    <li><strong>Microservice Architecture</strong>: Self-contained service with clear boundaries</li>
                    <li><strong>Container-based Execution</strong>: Docker containers for secure Python code execution</li>
                    <li><strong>Multi-tier Caching</strong>: Redis and in-memory caching for performance</li>
                    <li><strong>Multi-tenant Data Model</strong>: Isolated data storage per tenant</li>
                    <li><strong>Event-driven Processing</strong>: Asynchronous operations for non-critical tasks</li>
                </ul>

                <h2>System Overview</h2>
                <div class="mermaid">
graph TB
    subgraph "External Interfaces"
        WEB[Web UI]
        API[REST API Clients]
        MOBILE[Mobile Apps]
    end
    
    subgraph "API Gateway Layer"
        LB[Load Balancer]
        SSL[SSL Termination]
        AUTH[Authentication Gateway]
    end
    
    subgraph "Zona Custom Utils Service"
        APP[Application Layer]
        BL[Business Logic Layer]
        DATA[Data Access Layer]
        INFRA[Infrastructure Layer]
    end
    
    subgraph "Data Storage"
        MONGO[(MongoDB Cluster)]
        REDIS[(Redis Cluster)]
        FS[File System Storage]
    end
    
    subgraph "External Services"
        DOCKER[Docker Engine]
        LOGGING[Logging Service]
        MONITORING[Monitoring Service]
    end
    
    WEB --> LB
    API --> LB
    MOBILE --> LB
    
    LB --> SSL
    SSL --> AUTH
    AUTH --> APP
    
    APP --> BL
    BL --> DATA
    DATA --> INFRA
    
    DATA --> MONGO
    DATA --> REDIS
    INFRA --> FS
    INFRA --> DOCKER
    
    APP --> LOGGING
    APP --> MONITORING
                </div>

                <h3>System Context</h3>
                <p>The Zona Custom Utils Service operates within a larger ecosystem of microservices, providing custom utility management capabilities. It integrates with:</p>
                <ul>
                    <li><strong>Authentication Services</strong>: For user authentication and authorization</li>
                    <li><strong>Tenant Management</strong>: For multi-tenant configuration and isolation</li>
                    <li><strong>Container Orchestration</strong>: For isolated execution environments</li>
                    <li><strong>Monitoring Infrastructure</strong>: For observability and alerting</li>
                    <li><strong>Storage Services</strong>: For persistent data and file management</li>
                </ul>

                <h2>Business Requirements</h2>
                <h3>Functional Requirements</h3>
                <div class="requirements-grid">
                    <div class="requirement-card">
                        <h4>FR-001: Custom Utility Management</h4>
                        <ul>
                            <li>Users must be able to create custom Python utilities</li>
                            <li>System must validate Python syntax and security</li>
                            <li>Users must be able to update existing utilities</li>
                            <li>System must maintain version history</li>
                        </ul>
                    </div>
                    <div class="requirement-card">
                        <h4>FR-002: Code Validation and Security</h4>
                        <ul>
                            <li>System must validate Python syntax before saving</li>
                            <li>System must scan for prohibited code patterns</li>
                            <li>System must prevent execution of malicious code</li>
                            <li>System must provide detailed validation feedback</li>
                        </ul>
                    </div>
                    <div class="requirement-card">
                        <h4>FR-003: Utility Execution</h4>
                        <ul>
                            <li>Users must be able to execute their custom utilities</li>
                            <li>System must provide real-time execution output</li>
                            <li>System must support parameterized execution</li>
                            <li>System must handle execution timeouts gracefully</li>
                        </ul>
                    </div>
                    <div class="requirement-card">
                        <h4>FR-004: Multi-tenant Support</h4>
                        <ul>
                            <li>System must isolate data between tenants</li>
                            <li>System must support tenant-specific configurations</li>
                            <li>System must enable cross-tenant utility copying</li>
                            <li>System must maintain tenant-level audit trails</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Architecture Tab -->
            <div id="architecture" class="tab-content">
                <h2>Solution Architecture</h2>
                
                <h3>Architectural Principles</h3>
                <ol>
                    <li><strong>Single Responsibility</strong>: Each component has a well-defined purpose</li>
                    <li><strong>Loose Coupling</strong>: Components interact through well-defined interfaces</li>
                    <li><strong>High Cohesion</strong>: Related functionality is grouped together</li>
                    <li><strong>Separation of Concerns</strong>: Clear boundaries between different aspects</li>
                    <li><strong>Fail-Safe Design</strong>: Graceful degradation under failure conditions</li>
                </ol>

                <h3>Architecture Patterns</h3>
                <ul>
                    <li><strong>Layered Architecture</strong>: Clear separation between presentation, business, and data layers</li>
                    <li><strong>Repository Pattern</strong>: Abstracted data access layer</li>
                    <li><strong>Builder Pattern</strong>: Complex object construction</li>
                    <li><strong>Middleware Pattern</strong>: Cross-cutting concerns handling</li>
                    <li><strong>Circuit Breaker</strong>: Fault tolerance for external service calls</li>
                </ul>

                <h3>Technology Decisions</h3>
                <div class="tech-grid">
                    <div class="tech-card">
                        <h4>Programming Language: Go</h4>
                        <p><strong>Rationale</strong>:</p>
                        <ul>
                            <li>High performance and low latency</li>
                            <li>Excellent concurrency support</li>
                            <li>Strong ecosystem for microservices</li>
                            <li>Easy deployment and maintenance</li>
                        </ul>
                    </div>
                    <div class="tech-card">
                        <h4>Database: MongoDB</h4>
                        <p><strong>Rationale</strong>:</p>
                        <ul>
                            <li>Document-based model fits utility metadata</li>
                            <li>Horizontal scaling capabilities</li>
                            <li>Rich querying capabilities</li>
                            <li>Multi-tenant support</li>
                        </ul>
                    </div>
                    <div class="tech-card">
                        <h4>Cache: Redis</h4>
                        <p><strong>Rationale</strong>:</p>
                        <ul>
                            <li>High-performance in-memory storage</li>
                            <li>Advanced data structures</li>
                            <li>Pub/Sub capabilities</li>
                            <li>Clustering support</li>
                        </ul>
                    </div>
                    <div class="tech-card">
                        <h4>Container Runtime: Docker</h4>
                        <p><strong>Rationale</strong>:</p>
                        <ul>
                            <li>Isolated execution environment</li>
                            <li>Resource management</li>
                            <li>Portability across environments</li>
                            <li>Extensive ecosystem</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Components Tab -->
            <div id="components" class="tab-content">
                <h2>Component Architecture</h2>
                <div class="mermaid">
graph TB
    subgraph "Presentation Layer"
        HTTP[HTTP Router]
        MIDDLEWARE[Middleware Stack]
        CONTROLLERS[Controllers]
    end
    
    subgraph "Business Logic Layer"
        SERVICES[Services]
        BUILDERS[Builders]
        VALIDATORS[Validators]
    end
    
    subgraph "Data Access Layer"
        REPOSITORIES[Repositories]
        MODELS[Data Models]
        CACHE[Cache Layer]
    end
    
    subgraph "Infrastructure Layer"
        DOCKER_MGR[Container Manager]
        FILE_MGR[File Manager]
        AUDIT[Audit Logger]
        METRICS[Metrics Collector]
    end
    
    HTTP --> MIDDLEWARE
    MIDDLEWARE --> CONTROLLERS
    CONTROLLERS --> SERVICES
    SERVICES --> BUILDERS
    SERVICES --> VALIDATORS
    SERVICES --> REPOSITORIES
    REPOSITORIES --> MODELS
    REPOSITORIES --> CACHE
    SERVICES --> DOCKER_MGR
    SERVICES --> FILE_MGR
    SERVICES --> AUDIT
    SERVICES --> METRICS
                </div>

                <h3>Component Responsibilities</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>Presentation Layer</h4>
                        <ul>
                            <li><strong>HTTP Router</strong>: Route incoming requests to appropriate controllers</li>
                            <li><strong>Middleware Stack</strong>: Handle authentication, logging, and cross-cutting concerns</li>
                            <li><strong>Controllers</strong>: Process HTTP requests and generate responses</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Business Logic Layer</h4>
                        <ul>
                            <li><strong>Services</strong>: Implement core business logic and orchestrate operations</li>
                            <li><strong>Builders</strong>: Construct complex objects and configurations</li>
                            <li><strong>Validators</strong>: Validate input data and business rules</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Data Access Layer</h4>
                        <ul>
                            <li><strong>Repositories</strong>: Abstract data access operations</li>
                            <li><strong>Data Models</strong>: Define data structures and relationships</li>
                            <li><strong>Cache Layer</strong>: Provide high-performance data access</li>
                        </ul>
                    </div>
                    <div class="component-card">
                        <h4>Infrastructure Layer</h4>
                        <ul>
                            <li><strong>Container Manager</strong>: Manage Docker container lifecycle</li>
                            <li><strong>File Manager</strong>: Handle file system operations</li>
                            <li><strong>Audit Logger</strong>: Record audit trails and compliance data</li>
                            <li><strong>Metrics Collector</strong>: Gather performance and operational metrics</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Data Tab -->
            <div id="data" class="tab-content">
                <h2>Data Architecture</h2>
                
                <h3>Logical Data Model</h3>
                <div class="mermaid">
erDiagram
    TENANT {
        int id PK
        string tenantcode UK
        string name
        string status
        string db_host
        string connection_status
    }
    
    CUSTOM_UTIL {
        int id PK
        string name UK
        string tenantcode FK
        int userid FK
        string description
        string status
        string category
        text filecontents
        bigint createddate
        bigint updateddate
        text input_params
        text output_fields
        array playbook_names
    }
    
    TASK_EXECUTION {
        string id PK
        int taskid FK
        int userid FK
        string tenantcode FK
        bigint createddate
        text request
        text response
        string status
        float execution_time
    }
    
    AUDIT_LOG {
        string id PK
        string tenantcode FK
        int userid FK
        string action
        string resource
        bigint timestamp
        text details
    }
    
    TENANT ||--o{ CUSTOM_UTIL : contains
    CUSTOM_UTIL ||--o{ TASK_EXECUTION : executes
    TENANT ||--o{ AUDIT_LOG : generates
                </div>

                <h3>Data Storage Strategy</h3>
                <div class="storage-grid">
                    <div class="storage-card">
                        <h4>Primary Data Storage (MongoDB)</h4>
                        <ul>
                            <li><strong>Collections</strong>: Utilities, executions, audit logs, tenants</li>
                            <li><strong>Sharding Strategy</strong>: Shard by tenant code for horizontal scaling</li>
                            <li><strong>Replica Sets</strong>: 3-node replica sets for high availability</li>
                            <li><strong>Backup Strategy</strong>: Daily backups with point-in-time recovery</li>
                        </ul>
                    </div>
                    <div class="storage-card">
                        <h4>Cache Strategy (Redis)</h4>
                        <ul>
                            <li><strong>L1 Cache</strong>: Application-level caching (5 minutes TTL)</li>
                            <li><strong>L2 Cache</strong>: Redis caching (1 hour TTL)</li>
                            <li><strong>Cache Keys</strong>: Hierarchical naming convention</li>
                            <li><strong>Eviction Policy</strong>: LRU with memory limit enforcement</li>
                        </ul>
                    </div>
                    <div class="storage-card">
                        <h4>File Storage</h4>
                        <ul>
                            <li><strong>Code Files</strong>: Encrypted Python files on network storage</li>
                            <li><strong>Logs</strong>: Execution logs on distributed file system</li>
                            <li><strong>Backups</strong>: Compressed archives on object storage</li>
                        </ul>
                    </div>
                </div>

                <h3>Data Security</h3>
                <ul>
                    <li><strong>Encryption at Rest</strong>: AES-256 encryption for all stored data</li>
                    <li><strong>Encryption in Transit</strong>: TLS 1.3 for all network communication</li>
                    <li><strong>Data Masking</strong>: Sensitive data masked in logs and non-production environments</li>
                    <li><strong>Access Control</strong>: Role-based access with principle of least privilege</li>
                </ul>
            </div>

            <!-- Security Tab -->
            <div id="security" class="tab-content">
                <h2>Security Architecture</h2>
                
                <h3>Security Layers</h3>
                <div class="mermaid">
graph TB
    subgraph "Perimeter Security"
        WAF[Web Application Firewall]
        DDOS[DDoS Protection]
        FIREWALL[Network Firewall]
    end
    
    subgraph "Application Security"
        AUTH[Authentication]
        AUTHZ[Authorization]
        INPUT_VAL[Input Validation]
        CODE_SCAN[Code Scanning]
    end
    
    subgraph "Data Security"
        ENCRYPT[Data Encryption]
        MASKING[Data Masking]
        BACKUP_SEC[Secure Backup]
    end
    
    subgraph "Runtime Security"
        CONTAINER_SEC[Container Security]
        ISOLATION[Process Isolation]
        MONITORING[Security Monitoring]
    end
    
    WAF --> DDOS
    DDOS --> FIREWALL
    FIREWALL --> AUTH
    AUTH --> AUTHZ
    AUTHZ --> INPUT_VAL
    INPUT_VAL --> CODE_SCAN
    CODE_SCAN --> ENCRYPT
    ENCRYPT --> MASKING
    MASKING --> BACKUP_SEC
    BACKUP_SEC --> CONTAINER_SEC
    CONTAINER_SEC --> ISOLATION
    ISOLATION --> MONITORING
                </div>

                <h3>Authentication and Authorization</h3>
                <h4>Authentication Flow</h4>
                <ol>
                    <li>User provides credentials to authentication service</li>
                    <li>Authentication service validates credentials</li>
                    <li>JWT token issued with user claims and permissions</li>
                    <li>Token included in subsequent API requests</li>
                    <li>Service validates token and extracts user context</li>
                </ol>

                <h4>Authorization Model</h4>
                <ul>
                    <li><strong>Role-Based Access Control (RBAC)</strong></li>
                    <li><strong>Tenant-based isolation</strong></li>
                    <li><strong>Resource-level permissions</strong></li>
                    <li><strong>Operation-level granularity</strong></li>
                </ul>

                <h4>Permission Matrix</h4>
                <table class="permission-table">
                    <thead>
                        <tr>
                            <th>Role</th>
                            <th>Create Utils</th>
                            <th>Read Utils</th>
                            <th>Execute Utils</th>
                            <th>Delete Utils</th>
                            <th>Admin Functions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>User</td>
                            <td>Own</td>
                            <td>Own</td>
                            <td>Own</td>
                            <td>No</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>Creator</td>
                            <td>Own</td>
                            <td>Own</td>
                            <td>Own</td>
                            <td>Own</td>
                            <td>No</td>
                        </tr>
                        <tr>
                            <td>Admin</td>
                            <td>All</td>
                            <td>All</td>
                            <td>All</td>
                            <td>All</td>
                            <td>Limited</td>
                        </tr>
                        <tr>
                            <td>Super Admin</td>
                            <td>All</td>
                            <td>All</td>
                            <td>All</td>
                            <td>All</td>
                            <td>All</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Code Security</h3>
                <h4>Validation Rules</h4>
                <ul>
                    <li><strong>Syntax Validation</strong>: Python AST parsing</li>
                    <li><strong>Security Scanning</strong>: Pattern-based security checks</li>
                    <li><strong>Dependency Analysis</strong>: Package security assessment</li>
                    <li><strong>Resource Limits</strong>: Memory and CPU constraints</li>
                </ul>

                <h4>Prohibited Patterns</h4>
                <ul>
                    <li>File system access (<code>open()</code>, <code>file()</code>)</li>
                    <li>Network operations (<code>socket</code>, <code>urllib</code>, <code>requests</code>)</li>
                    <li>Process execution (<code>subprocess</code>, <code>os.system</code>)</li>
                    <li>System imports (<code>os</code>, <code>sys</code>, <code>subprocess</code>)</li>
                </ul>
            </div>

            <!-- Performance Tab -->
            <div id="performance" class="tab-content">
                <h2>Performance Architecture</h2>
                
                <h3>Performance Strategy</h3>
                <div class="mermaid">
graph TD
    REQUEST[Incoming Request] --> CACHE_L1{L1 Cache}
    CACHE_L1 -->|Hit| RETURN_FAST[Return Cached]
    CACHE_L1 -->|Miss| CACHE_L2{L2 Cache}
    CACHE_L2 -->|Hit| UPDATE_L1[Update L1]
    CACHE_L2 -->|Miss| DATABASE[Database Query]
    UPDATE_L1 --> RETURN_FAST
    DATABASE --> OPTIMIZE{Optimized Query?}
    OPTIMIZE -->|Yes| FAST_QUERY[Execute Fast Query]
    OPTIMIZE -->|No| SLOW_QUERY[Execute Slow Query]
    FAST_QUERY --> CACHE_UPDATE[Update Caches]
    SLOW_QUERY --> CACHE_UPDATE
    CACHE_UPDATE --> RETURN_RESULT[Return Result]
                </div>

                <h3>Performance Targets</h3>
                <h4>Response Time Requirements</h4>
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>Operation</th>
                            <th>Target</th>
                            <th>Maximum</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Get Utility List</td>
                            <td>&lt; 200ms</td>
                            <td>500ms</td>
                        </tr>
                        <tr>
                            <td>Create Utility</td>
                            <td>&lt; 1s</td>
                            <td>2s</td>
                        </tr>
                        <tr>
                            <td>Validate Code</td>
                            <td>&lt; 500ms</td>
                            <td>1s</td>
                        </tr>
                        <tr>
                            <td>Execute Utility</td>
                            <td>&lt; 10s</td>
                            <td>300s</td>
                        </tr>
                        <tr>
                            <td>Export/Import</td>
                            <td>&lt; 5s</td>
                            <td>30s</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Throughput Requirements</h4>
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Target</th>
                            <th>Peak</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Requests/Second</td>
                            <td>1000</td>
                            <td>5000</td>
                        </tr>
                        <tr>
                            <td>Concurrent Users</td>
                            <td>100</td>
                            <td>500</td>
                        </tr>
                        <tr>
                            <td>Utility Executions/Minute</td>
                            <td>60</td>
                            <td>300</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Optimization Strategies</h3>
                <div class="optimization-grid">
                    <div class="optimization-card">
                        <h4>Database Optimization</h4>
                        <ul>
                            <li><strong>Indexing Strategy</strong>: Compound indexes for common query patterns</li>
                            <li><strong>Query Optimization</strong>: Aggregation pipelines for complex queries</li>
                            <li><strong>Connection Pooling</strong>: Reuse database connections</li>
                            <li><strong>Read Replicas</strong>: Distribute read load across replicas</li>
                        </ul>
                    </div>
                    <div class="optimization-card">
                        <h4>Caching Strategy</h4>
                        <ul>
                            <li><strong>Multi-level Caching</strong>: Application, Redis, and database caching</li>
                            <li><strong>Cache Warming</strong>: Pre-populate frequently accessed data</li>
                            <li><strong>Cache Invalidation</strong>: Event-driven cache updates</li>
                            <li><strong>Cache Partitioning</strong>: Distribute cache load</li>
                        </ul>
                    </div>
                    <div class="optimization-card">
                        <h4>Application Optimization</h4>
                        <ul>
                            <li><strong>Goroutine Pooling</strong>: Reuse goroutines for concurrent operations</li>
                            <li><strong>Memory Management</strong>: Efficient memory allocation and garbage collection</li>
                            <li><strong>Compression</strong>: Compress large responses</li>
                            <li><strong>Connection Reuse</strong>: HTTP connection pooling</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Deployment Tab -->
            <div id="deployment" class="tab-content">
                <h2>Deployment Architecture</h2>
                
                <h3>Production Environment</h3>
                <div class="mermaid">
graph TB
    subgraph "Load Balancer Tier"
        LB1[Load Balancer 1]
        LB2[Load Balancer 2]
    end
    
    subgraph "Application Tier"
        APP1[App Instance 1]
        APP2[App Instance 2]
        APP3[App Instance 3]
    end
    
    subgraph "Data Tier"
        MONGO_P[MongoDB Primary]
        MONGO_S1[MongoDB Secondary 1]
        MONGO_S2[MongoDB Secondary 2]
        REDIS_M[Redis Master]
        REDIS_S[Redis Slave]
    end
    
    subgraph "Container Tier"
        DOCKER1[Docker Host 1]
        DOCKER2[Docker Host 2]
        DOCKER3[Docker Host 3]
    end
    
    INTERNET[Internet] --> LB1
    INTERNET --> LB2
    LB1 --> APP1
    LB1 --> APP2
    LB2 --> APP2
    LB2 --> APP3
    APP1 --> MONGO_P
    APP2 --> MONGO_P
    APP3 --> MONGO_P
    MONGO_P --> MONGO_S1
    MONGO_P --> MONGO_S2
    APP1 --> REDIS_M
    APP2 --> REDIS_M
    APP3 --> REDIS_M
    REDIS_M --> REDIS_S
    APP1 --> DOCKER1
    APP2 --> DOCKER2
    APP3 --> DOCKER3
                </div>

                <h3>Deployment Strategy</h3>
                <ul>
                    <li><strong>Blue-Green Deployment</strong>: Zero-downtime deployments</li>
                    <li><strong>Rolling Updates</strong>: Gradual rollout of new versions</li>
                    <li><strong>Canary Releases</strong>: Limited exposure testing</li>
                    <li><strong>Automated Rollback</strong>: Quick recovery from failed deployments</li>
                </ul>

                <h3>Environment Management</h3>
                <ul>
                    <li><strong>Development</strong>: Single instance for development and testing</li>
                    <li><strong>Staging</strong>: Production-like environment for validation</li>
                    <li><strong>Production</strong>: High-availability multi-instance deployment</li>
                    <li><strong>Disaster Recovery</strong>: Secondary region for business continuity</li>
                </ul>

                <h3>Integration Architecture</h3>
                <div class="mermaid">
graph LR
    subgraph "Zona Custom Utils"
        CORE[Core Service]
    end
    
    subgraph "Internal Services"
        AUTH_SVC[Authentication Service]
        TENANT_SVC[Tenant Management]
        AUDIT_SVC[Audit Service]
        NOTIFY_SVC[Notification Service]
    end
    
    subgraph "External Services"
        DOCKER_API[Docker Engine API]
        FILE_STORAGE[File Storage Service]
        MONITORING[Monitoring Service]
        LOGGING[Logging Service]
    end
    
    CORE <--> AUTH_SVC
    CORE <--> TENANT_SVC
    CORE --> AUDIT_SVC
    CORE --> NOTIFY_SVC
    CORE <--> DOCKER_API
    CORE <--> FILE_STORAGE
    CORE --> MONITORING
    CORE --> LOGGING
                </div>

                <h3>Integration Patterns</h3>
                <h4>Synchronous Integration</h4>
                <ul>
                    <li><strong>REST API</strong>: For real-time operations requiring immediate response</li>
                    <li><strong>Direct Database Access</strong>: For high-performance data operations</li>
                    <li><strong>File System Access</strong>: For code storage and retrieval</li>
                </ul>

                <h4>Asynchronous Integration</h4>
                <ul>
                    <li><strong>Event Publishing</strong>: For audit logging and notifications</li>
                    <li><strong>Message Queues</strong>: For long-running operations</li>
                    <li><strong>Batch Processing</strong>: For bulk operations and maintenance tasks</li>
                </ul>
            </div>

            <!-- Flows Tab -->
            <div id="flows" class="tab-content">
                <h2>Business Process Flows</h2>
                
                <h3>Custom Utility Creation Flow</h3>
                <div class="mermaid">
sequenceDiagram
    participant User
    participant UI
    participant API
    participant Service
    participant Validator
    participant Storage
    participant Docker
    
    User->>UI: Create Utility
    UI->>API: POST /custom-utils
    API->>Service: Process Request
    Service->>Validator: Validate Code
    Validator->>Service: Validation Results
    
    alt Validation Failed
        Service->>API: Error Response
        API->>UI: Validation Errors
        UI->>User: Show Errors
    else Validation Passed
        Service->>Storage: Save Utility
        Service->>Docker: Update Config
        Service->>API: Success Response
        API->>UI: Confirmation
        UI->>User: Success Message
    end
                </div>

                <h3>Utility Execution Flow</h3>
                <div class="mermaid">
sequenceDiagram
    participant User
    participant UI
    participant API
    participant Service
    participant Container
    participant Storage
    
    User->>UI: Execute Utility
    UI->>API: POST /execute
    API->>Service: Execute Request
    Service->>Container: Start Execution
    Container->>Container: Run Python Code
    Container->>Service: Stream Output
    Service->>API: Real-time Results
    API->>UI: Stream Response
    UI->>User: Show Output
    Container->>Service: Final Results
    Service->>Storage: Store Results
    Service->>API: Completion
    API->>UI: Execution Complete
                </div>

                <h3>Multi-Tenant Deployment Flow</h3>
                <div class="mermaid">
sequenceDiagram
    participant Admin
    participant Service
    participant MasterDB
    participant TenantDB
    participant Cache
    
    Admin->>Service: Deploy to New Tenant
    Service->>MasterDB: Get Source Utilities
    Service->>Service: Process Utilities
    
    loop For Each Utility
        Service->>TenantDB: Create Utility
        Service->>Cache: Clear Cache
        Service->>Service: Update Metadata
    end
    
    Service->>Admin: Deployment Complete
                </div>

                <h3>Non-Functional Requirements</h3>
                <div class="nfr-grid">
                    <div class="nfr-card">
                        <h4>Availability Requirements</h4>
                        <ul>
                            <li><strong>Uptime Target</strong>: 99.9% (8.76 hours downtime per year)</li>
                            <li><strong>Planned Maintenance</strong>: Maximum 4 hours per month</li>
                            <li><strong>Recovery Time Objective (RTO)</strong>: 15 minutes</li>
                            <li><strong>Recovery Point Objective (RPO)</strong>: 1 hour</li>
                        </ul>
                    </div>
                    <div class="nfr-card">
                        <h4>Scalability Requirements</h4>
                        <ul>
                            <li><strong>Horizontal Scaling</strong>: Auto-scaling based on load</li>
                            <li><strong>Vertical Scaling</strong>: Resource scaling for individual instances</li>
                            <li><strong>Database Scaling</strong>: Sharding and read replicas</li>
                            <li><strong>Cache Scaling</strong>: Redis clustering for distributed caching</li>
                        </ul>
                    </div>
                    <div class="nfr-card">
                        <h4>Reliability Requirements</h4>
                        <ul>
                            <li><strong>Mean Time Between Failures (MTBF)</strong>: > 720 hours</li>
                            <li><strong>Mean Time To Recovery (MTTR)</strong>: < 15 minutes</li>
                            <li><strong>Error Rate</strong>: < 0.1% for API requests</li>
                            <li><strong>Data Consistency</strong>: Eventual consistency for non-critical data</li>
                        </ul>
                    </div>
                    <div class="nfr-card">
                        <h4>Compliance Requirements</h4>
                        <ul>
                            <li><strong>Data Privacy</strong>: GDPR and CCPA compliance</li>
                            <li><strong>Security Standards</strong>: SOC 2 Type II certification</li>
                            <li><strong>Audit Logging</strong>: Complete audit trail for all operations</li>
                            <li><strong>Data Retention</strong>: Configurable retention policies per tenant</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="main-footer">
        <p>&copy; 2024 Securaa Platform. All rights reserved. | <a href="#" onclick="printPage()" style="color: #ecf0f1;">Print</a> | <a href="#" onclick="exportToPDF()" style="color: #ecf0f1;">Export PDF</a></p>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.4/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#1976d2',
                primaryTextColor: '#000000',
                primaryBorderColor: '#0d47a1',
                lineColor: '#1976d2',
                secondaryColor: '#f5f5f5',
                tertiaryColor: '#ffffff'
            }
        });

        function openTab(evt, tabName) {
            var i, tabcontent, tabbtns;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            tabbtns = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tabbtns.length; i++) {
                tabbtns[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        function printPage() {
            window.print();
        }

        function exportToPDF() {
            alert('PDF export functionality would be implemented here');
        }
    </script>
    <script src="assets/js/documentation.js"></script>
</body>
</html>