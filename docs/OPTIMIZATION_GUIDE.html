<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Optimization Guide">
    <title>Optimization Guide - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 18, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="securaa-playbook-service-performance-optimization-guide">Securaa Playbook Service - Performance Optimization Guide</h1>
<h2 id="document-information">Document Information</h2>
<ul>
<li><strong>Service</strong>: Securaa Playbook Service</li>
<li><strong>Target Audience</strong>: Development Team</li>
<li><strong>Priority</strong>: High Impact Performance Improvements</li>
<li><strong>Date</strong>: September 11, 2025</li>
<li><strong>Estimated Implementation Time</strong>: 4-6 weeks</li>
</ul>
<hr />
<h2 id="executive-summary">ðŸŽ¯ <strong>Executive Summary</strong></h2>
<p>This document provides specific, actionable optimization strategies for the Securaa Playbook Service that can deliver:
- <strong>5-10x query performance improvement</strong>
- <strong>3-4x concurrent request handling</strong>
- <strong>50-70% reduction in memory usage</strong>
- <strong>2-3x task execution throughput</strong></p>
<hr />
<h2 id="priority-1-database-optimizations-week-1-2">ðŸ“‹ <strong>Priority 1: Database Optimizations (Week 1-2)</strong></h2>
<h3 id="11-critical-index-creation"><strong>1.1 Critical Index Creation</strong></h3>
<p><strong>Impact</strong>: 5-10x query performance improvement<br />
<strong>Effort</strong>: 1 day<br />
<strong>Files to modify</strong>: Database migration scripts</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Add these indexes immediately - HIGH IMPACT</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">playbook_execution_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;tenant_code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;execution_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span>
<span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">playbook_execution_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span>
<span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">task_execution_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;peid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;task_seq&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">});</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">task_execution_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;tenant_code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;alert_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">playbook_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;tenant_code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="s2">&quot;category_id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">});</span>
<span class="c1">// Compound index for top playbooks query</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">playbook_execution_collection</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
<span class="w">    </span><span class="s2">&quot;execution_status&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;createddate&quot;</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;pid&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;playbook_runtime&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="12-query-optimization-in-averageplaybookruntimego"><strong>1.2 Query Optimization in averagePlaybookRunTime.go</strong></h3>
<p><strong>Current Issue</strong>: Inefficient aggregation pipeline<br />
<strong>File</strong>: <code>services/averagePlaybookRunTime.go</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// BEFORE (Current implementation around line 93):</span>
<span class="nx">topPlaybookAvrPipeline</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">A</span><span class="p">{</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$match&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">matchQuery</span><span class="p">}},</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$sort&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;createddate&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">}}}},</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$group&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$pid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$first&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$playbook_name&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;average&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$avg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$playbook_runtime&quot;</span><span class="p">}}}},</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$sort&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;average&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">}}}},</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}},</span>
<span class="p">}</span>
<span class="c1">// AFTER (Optimized version):</span>
<span class="nx">topPlaybookAvrPipeline</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">A</span><span class="p">{</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$match&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">matchQuery</span><span class="p">}},</span>
<span class="w">    </span><span class="c1">// Use $group first to reduce data volume</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$group&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$pid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$first&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$playbook_name&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;average&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$avg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$playbook_runtime&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$sum&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}}}},</span>
<span class="w">    </span><span class="c1">// Sort after grouping (smaller dataset)</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$sort&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;average&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">}}}},</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$limit&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">}},</span>
<span class="w">    </span><span class="c1">// Add projection to reduce network transfer</span>
<span class="w">    </span><span class="nx">bson</span><span class="p">.</span><span class="nx">D</span><span class="p">{{</span><span class="s">&quot;$project&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;average&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}}},</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="13-batch-operations-implementation"><strong>1.3 Batch Operations Implementation</strong></h3>
<p><strong>File</strong>: Create new <code>services/batchOperationService.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">services</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;go.mongodb.org/mongo-driver/bson&quot;</span>
<span class="w">    </span><span class="s">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span>
<span class="w">    </span><span class="s">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">BatchOperationService</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">collection</span><span class="w"> </span><span class="o">*</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Collection</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TaskStatusUpdate</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TaskRequestID</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">        </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Response</span><span class="w">      </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">UpdatedDate</span><span class="w">   </span><span class="kt">int64</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewBatchOperationService</span><span class="p">(</span><span class="nx">collection</span><span class="w"> </span><span class="o">*</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Collection</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">BatchOperationService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">BatchOperationService</span><span class="p">{</span><span class="nx">collection</span><span class="p">:</span><span class="w"> </span><span class="nx">collection</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">service</span><span class="w"> </span><span class="o">*</span><span class="nx">BatchOperationService</span><span class="p">)</span><span class="w"> </span><span class="nx">BatchUpdateTaskStatus</span><span class="p">(</span>
<span class="w">    </span><span class="nx">updates</span><span class="w"> </span><span class="p">[]</span><span class="nx">TaskStatusUpdate</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">batchSize</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">updates</span><span class="p">);</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">batchSize</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">end</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">batchSize</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">updates</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">end</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">updates</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">batch</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">updates</span><span class="p">[</span><span class="nx">i</span><span class="p">:</span><span class="nx">end</span><span class="p">]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">processBatch</span><span class="p">(</span><span class="nx">batch</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">service</span><span class="w"> </span><span class="o">*</span><span class="nx">BatchOperationService</span><span class="p">)</span><span class="w"> </span><span class="nx">processBatch</span><span class="p">(</span><span class="nx">batch</span><span class="w"> </span><span class="p">[]</span><span class="nx">TaskStatusUpdate</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">operations</span><span class="w"> </span><span class="p">[]</span><span class="nx">mongo</span><span class="p">.</span><span class="nx">WriteModel</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">batch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">filter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;task_request_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">update</span><span class="p">.</span><span class="nx">TaskRequestID</span><span class="p">}</span>
<span class="w">        </span><span class="nx">updateDoc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;$set&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span>
<span class="w">                </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w">       </span><span class="nx">update</span><span class="p">.</span><span class="nx">Status</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;response&quot;</span><span class="p">:</span><span class="w">     </span><span class="nx">update</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;updated_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">update</span><span class="p">.</span><span class="nx">UpdatedDate</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">operation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongo</span><span class="p">.</span><span class="nx">NewUpdateOneModel</span><span class="p">().</span>
<span class="w">            </span><span class="nx">SetFilter</span><span class="p">(</span><span class="nx">filter</span><span class="p">).</span>
<span class="w">            </span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">updateDoc</span><span class="p">)</span>

<span class="w">        </span><span class="nx">operations</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">operations</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Execute bulk write with unordered operations for better performance</span>
<span class="w">    </span><span class="nx">opts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">BulkWrite</span><span class="p">().</span><span class="nx">SetOrdered</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">BulkWrite</span><span class="p">(</span>
<span class="w">        </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">operations</span><span class="p">,</span>
<span class="w">        </span><span class="nx">opts</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="c1">// Usage in controllers:</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskController</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateMultipleTaskStatus</span><span class="p">(</span><span class="nx">updates</span><span class="w"> </span><span class="p">[]</span><span class="nx">TaskStatusUpdate</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">batchService</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewBatchOperationService</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">taskCollection</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">batchService</span><span class="p">.</span><span class="nx">BatchUpdateTaskStatus</span><span class="p">(</span><span class="nx">updates</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="priority-2-connection-pool-optimization-week-1">ðŸ“‹ <strong>Priority 2: Connection Pool Optimization (Week 1)</strong></h2>
<h3 id="21-mongodb-connection-pool-configuration"><strong>2.1 MongoDB Connection Pool Configuration</strong></h3>
<p><strong>File</strong>: <code>app.go</code> - Modify <code>InitMongoSession</code> function</p>
<div class="highlight"><pre><span></span><code><span class="c1">// BEFORE (Current implementation):</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">InitMongoSession</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Basic connection without optimization</span>
<span class="p">}</span>

<span class="c1">// AFTER (Optimized version):</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">InitMongoSession</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Optimized MongoDB connection configuration</span>
<span class="w">    </span><span class="nx">clientOptions</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">Client</span><span class="p">().</span>
<span class="w">        </span><span class="nx">ApplyURI</span><span class="p">(</span><span class="nx">configObject</span><span class="p">.</span><span class="nx">DatabaseConfig</span><span class="p">.</span><span class="nx">MongoURI</span><span class="p">).</span>
<span class="w">        </span><span class="nx">SetMaxPoolSize</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="w">                    </span><span class="c1">// Increase max connections</span>
<span class="w">        </span><span class="nx">SetMinPoolSize</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="w">                     </span><span class="c1">// Maintain minimum connections</span>
<span class="w">        </span><span class="nx">SetMaxConnIdleTime</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">).</span><span class="w">  </span><span class="c1">// Keep connections alive longer</span>
<span class="w">        </span><span class="nx">SetConnectTimeout</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">).</span><span class="w">   </span><span class="c1">// Connection timeout</span>
<span class="w">        </span><span class="nx">SetSocketTimeout</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">).</span><span class="w">    </span><span class="c1">// Socket timeout</span>
<span class="w">        </span><span class="nx">SetServerSelectionTimeout</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">).</span><span class="w"> </span><span class="c1">// Server selection timeout</span>
<span class="w">        </span><span class="nx">SetHeartbeatInterval</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">).</span><span class="w"> </span><span class="c1">// Health check interval</span>
<span class="w">        </span><span class="nx">SetRetryWrites</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="w">                   </span><span class="c1">// Enable retry writes</span>
<span class="w">        </span><span class="nx">SetRetryReads</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">                     </span><span class="c1">// Enable retry reads</span>

<span class="w">    </span><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongo</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">clientOptions</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;Failed to connect to MongoDB&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Test the connection</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Ping</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;Failed to ping MongoDB&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Store optimized client</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">MongoClient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;MongoDB connection pool initialized with optimized settings&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="22-redis-connection-pool-optimization"><strong>2.2 Redis Connection Pool Optimization</strong></h3>
<p><strong>File</strong>: Create new <code>cache/optimizedRedisClient.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">cache</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/go-redis/redis/v8&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">OptimizedRedisConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Host</span><span class="w">         </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Port</span><span class="w">         </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">Password</span><span class="w">     </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Database</span><span class="w">     </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">PoolSize</span><span class="w">     </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">MinIdleConns</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">IdleTimeout</span><span class="w">  </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="w">    </span><span class="nx">MaxRetries</span><span class="w">   </span><span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewOptimizedRedisClient</span><span class="p">(</span><span class="nx">config</span><span class="w"> </span><span class="nx">OptimizedRedisConfig</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Addr</span><span class="p">:</span><span class="w">         </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s:%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Port</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Password</span><span class="p">:</span><span class="w">     </span><span class="nx">config</span><span class="p">.</span><span class="nx">Password</span><span class="p">,</span>
<span class="w">        </span><span class="nx">DB</span><span class="p">:</span><span class="w">           </span><span class="nx">config</span><span class="p">.</span><span class="nx">Database</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PoolSize</span><span class="p">:</span><span class="w">     </span><span class="nx">config</span><span class="p">.</span><span class="nx">PoolSize</span><span class="p">,</span><span class="w">      </span><span class="c1">// Default: 30, Recommended: 50-100</span>
<span class="w">        </span><span class="nx">MinIdleConns</span><span class="p">:</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">MinIdleConns</span><span class="p">,</span><span class="w">  </span><span class="c1">// Default: 0, Recommended: 10-20</span>
<span class="w">        </span><span class="nx">IdleTimeout</span><span class="p">:</span><span class="w">  </span><span class="nx">config</span><span class="p">.</span><span class="nx">IdleTimeout</span><span class="p">,</span><span class="w">   </span><span class="c1">// Default: 5min, Recommended: 10-30min</span>
<span class="w">        </span><span class="nx">MaxRetries</span><span class="p">:</span><span class="w">   </span><span class="nx">config</span><span class="p">.</span><span class="nx">MaxRetries</span><span class="p">,</span><span class="w">    </span><span class="c1">// Default: 3, Recommended: 5</span>
<span class="w">        </span><span class="nx">DialTimeout</span><span class="p">:</span><span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ReadTimeout</span><span class="p">:</span><span class="w">  </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">        </span><span class="nx">WriteTimeout</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PoolTimeout</span><span class="p">:</span><span class="w">  </span><span class="mi">15</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Usage in cacheControllers/cacheController.go:</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">OptimizedRedisConfig</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Host</span><span class="p">:</span><span class="w">         </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;REDIS_HOST&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">Port</span><span class="p">:</span><span class="w">         </span><span class="mi">6379</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PoolSize</span><span class="p">:</span><span class="w">     </span><span class="mi">80</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MinIdleConns</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">        </span><span class="nx">IdleTimeout</span><span class="p">:</span><span class="w">  </span><span class="mi">20</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MaxRetries</span><span class="p">:</span><span class="w">   </span><span class="mi">5</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">redisClient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">NewOptimizedRedisClient</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="23-http-client-pool-configuration"><strong>2.3 HTTP Client Pool Configuration</strong></h3>
<p><strong>File</strong>: Create new <code>utils/httpClientPool.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;net/http&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">optimizedHTTPClient</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span>
<span class="w">    </span><span class="nx">once</span><span class="w">                </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">GetOptimizedHTTPClient</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">transport</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Transport</span><span class="p">{</span>
<span class="w">            </span><span class="nx">MaxIdleConns</span><span class="p">:</span><span class="w">        </span><span class="mi">100</span><span class="p">,</span><span class="w">               </span><span class="c1">// Total idle connections</span>
<span class="w">            </span><span class="nx">MaxIdleConnsPerHost</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">                </span><span class="c1">// Idle connections per host</span>
<span class="w">            </span><span class="nx">MaxConnsPerHost</span><span class="p">:</span><span class="w">     </span><span class="mi">50</span><span class="p">,</span><span class="w">                </span><span class="c1">// Max connections per host</span>
<span class="w">            </span><span class="nx">IdleConnTimeout</span><span class="p">:</span><span class="w">     </span><span class="mi">90</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w">  </span><span class="c1">// Keep connections alive</span>
<span class="w">            </span><span class="nx">TLSHandshakeTimeout</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w">  </span><span class="c1">// TLS handshake timeout</span>
<span class="w">            </span><span class="nx">DisableKeepAlives</span><span class="p">:</span><span class="w">   </span><span class="kc">false</span><span class="p">,</span><span class="w">             </span><span class="c1">// Enable keep-alive</span>
<span class="w">            </span><span class="nx">ForceAttemptHTTP2</span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span><span class="w">              </span><span class="c1">// Use HTTP/2 when possible</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">optimizedHTTPClient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Transport</span><span class="p">:</span><span class="w"> </span><span class="nx">transport</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Timeout</span><span class="p">:</span><span class="w">   </span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">,</span><span class="w"> </span><span class="c1">// Overall request timeout</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">optimizedHTTPClient</span>
<span class="p">}</span>

<span class="c1">// Usage in integration calls:</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">MakeAPICall</span><span class="p">(</span><span class="nx">url</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">client</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetOptimizedHTTPClient</span><span class="p">()</span>
<span class="w">    </span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewBuffer</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="priority-3-parallel-processing-implementation-week-2-3">ðŸ“‹ <strong>Priority 3: Parallel Processing Implementation (Week 2-3)</strong></h2>
<h3 id="31-worker-pool-for-task-execution"><strong>3.1 Worker Pool for Task Execution</strong></h3>
<p><strong>File</strong>: Create new <code>executionControllers/workerPool.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">executionControllers</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;securaa_services/securaa_playbook/executionModels&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TaskWorkerPool</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">taskQueue</span><span class="w">   </span><span class="kd">chan</span><span class="w"> </span><span class="nx">executionModels</span><span class="p">.</span><span class="nx">PlayBookTask</span>
<span class="w">    </span><span class="nx">resultQueue</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="nx">TaskResult</span>
<span class="w">    </span><span class="nx">errorQueue</span><span class="w">  </span><span class="kd">chan</span><span class="w"> </span><span class="kt">error</span>
<span class="w">    </span><span class="nx">stopSignal</span><span class="w">  </span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">workers</span><span class="w">     </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">wg</span><span class="w">          </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
<span class="w">    </span><span class="nx">controller</span><span class="w">  </span><span class="o">*</span><span class="nx">PlaybookExecutionController</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">TaskResult</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">TaskSeq</span><span class="w">  </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">Success</span><span class="w">  </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">Response</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Error</span><span class="w">    </span><span class="kt">error</span>
<span class="w">    </span><span class="nx">Duration</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewTaskWorkerPool</span><span class="p">(</span><span class="nx">workers</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferSize</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">*</span><span class="nx">PlaybookExecutionController</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">TaskWorkerPool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">taskQueue</span><span class="p">:</span><span class="w">   </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">executionModels</span><span class="p">.</span><span class="nx">PlayBookTask</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferSize</span><span class="p">),</span>
<span class="w">        </span><span class="nx">resultQueue</span><span class="p">:</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">TaskResult</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferSize</span><span class="p">),</span>
<span class="w">        </span><span class="nx">errorQueue</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">bufferSize</span><span class="p">),</span>
<span class="w">        </span><span class="nx">stopSignal</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}),</span>
<span class="w">        </span><span class="nx">workers</span><span class="p">:</span><span class="w">     </span><span class="nx">workers</span><span class="p">,</span>
<span class="w">        </span><span class="nx">controller</span><span class="p">:</span><span class="w">  </span><span class="nx">controller</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">Start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">workers</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pool</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">worker</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">worker</span><span class="p">(</span><span class="nx">workerID</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">pool</span><span class="p">.</span><span class="nx">taskQueue</span><span class="p">:</span>
<span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">processTask</span><span class="p">(</span><span class="nx">task</span><span class="p">,</span><span class="w"> </span><span class="nx">workerID</span><span class="p">)</span>
<span class="w">            </span><span class="nx">pool</span><span class="p">.</span><span class="nx">resultQueue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">result</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">pool</span><span class="p">.</span><span class="nx">stopSignal</span><span class="p">:</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Worker stopping&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;worker_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">workerID</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">processTask</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="nx">executionModels</span><span class="p">.</span><span class="nx">PlayBookTask</span><span class="p">,</span><span class="w"> </span><span class="nx">workerID</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="nx">TaskResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">startTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>

<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">recover</span><span class="p">();</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">pool</span><span class="p">.</span><span class="nx">errorQueue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;worker %d panicked: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">workerID</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}()</span>

<span class="w">    </span><span class="c1">// Process the task using existing controller logic</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">ProcessSingleTask</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">TaskResult</span><span class="p">{</span>
<span class="w">        </span><span class="nx">TaskSeq</span><span class="p">:</span><span class="w">  </span><span class="nx">task</span><span class="p">.</span><span class="nx">TaskSeq</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Success</span><span class="p">:</span><span class="w">  </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Error</span><span class="p">:</span><span class="w">    </span><span class="nx">err</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Duration</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">startTime</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">SubmitTask</span><span class="p">(</span><span class="nx">task</span><span class="w"> </span><span class="nx">executionModels</span><span class="p">.</span><span class="nx">PlayBookTask</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">taskQueue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">task</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// Task submitted successfully</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Task submission timeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;task_seq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">.</span><span class="nx">TaskSeq</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">Stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">stopSignal</span><span class="p">)</span>
<span class="w">    </span><span class="nx">pool</span><span class="p">.</span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">taskQueue</span><span class="p">)</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">resultQueue</span><span class="p">)</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">pool</span><span class="p">.</span><span class="nx">errorQueue</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">GetResults</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;-</span><span class="kd">chan</span><span class="w"> </span><span class="nx">TaskResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">resultQueue</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pool</span><span class="w"> </span><span class="o">*</span><span class="nx">TaskWorkerPool</span><span class="p">)</span><span class="w"> </span><span class="nx">GetErrors</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;-</span><span class="kd">chan</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">errorQueue</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="32-parallel-execution-in-playbookexecutioncontroller"><strong>3.2 Parallel Execution in PlaybookExecutionController</strong></h3>
<p><strong>File</strong>: <code>executionControllers/playbookExecutionController.go</code></p>
<p>Add this method to the PlaybookExecutionController struct:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Add this method to PlaybookExecutionController</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">executionController</span><span class="w"> </span><span class="o">*</span><span class="nx">PlaybookExecutionController</span><span class="p">)</span><span class="w"> </span><span class="nx">ExecuteTasksInParallel</span><span class="p">(</span>
<span class="w">    </span><span class="nx">tasks</span><span class="w"> </span><span class="p">[]</span><span class="nx">executionModels</span><span class="p">.</span><span class="nx">PlayBookTask</span><span class="p">,</span>
<span class="w">    </span><span class="nx">maxWorkers</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Determine optimal number of workers</span>
<span class="w">    </span><span class="nx">workerCount</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maxWorkers</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">maxWorkers</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">workerCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create worker pool</span>
<span class="w">    </span><span class="nx">pool</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewTaskWorkerPool</span><span class="p">(</span><span class="nx">workerCount</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">tasks</span><span class="p">),</span><span class="w"> </span><span class="nx">executionController</span><span class="p">)</span>
<span class="w">    </span><span class="nx">pool</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">pool</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Submit all tasks</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">pool</span><span class="p">.</span><span class="nx">SubmitTask</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Collect results</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="p">[]</span><span class="kt">error</span>
<span class="w">    </span><span class="nx">resultsCollected</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">resultsCollected</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">tasks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">pool</span><span class="p">.</span><span class="nx">GetResults</span><span class="p">():</span>
<span class="w">            </span><span class="nx">resultsCollected</span><span class="o">++</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">result</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">errors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">errors</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Task completed&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="s">&quot;task_seq&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">TaskSeq</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;success&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Success</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;duration&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span>
<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">pool</span><span class="p">.</span><span class="nx">GetErrors</span><span class="p">():</span>
<span class="w">            </span><span class="nx">errors</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">errors</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">            </span><span class="nx">resultsCollected</span><span class="o">++</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="mi">30</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">):</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;timeout waiting for task results&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Return first error if any</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">errors</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Usage in existing execution flow:</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">executionController</span><span class="w"> </span><span class="o">*</span><span class="nx">PlaybookExecutionController</span><span class="p">)</span><span class="w"> </span><span class="nx">ProcessAndExecuteTasksParallel</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Get tasks that can be executed in parallel</span>
<span class="w">    </span><span class="nx">parallelTasks</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">executionController</span><span class="p">.</span><span class="nx">getParallelExecutableTasks</span><span class="p">()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">parallelTasks</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Execute in parallel</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">executionController</span><span class="p">.</span><span class="nx">ExecuteTasksInParallel</span><span class="p">(</span><span class="nx">parallelTasks</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Execute sequentially for single task or dependent tasks</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">executionController</span><span class="p">.</span><span class="nx">executeTasksSequentially</span><span class="p">(</span><span class="nx">parallelTasks</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="priority-4-caching-strategy-implementation-week-3-4">ðŸ“‹ <strong>Priority 4: Caching Strategy Implementation (Week 3-4)</strong></h2>
<h3 id="41-multi-level-cache-manager"><strong>4.1 Multi-Level Cache Manager</strong></h3>
<p><strong>File</strong>: Create new <code>cache/multiLevelCache.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">cache</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/go-redis/redis/v8&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">MultiLevelCacheManager</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">l1Cache</span><span class="w">     </span><span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="w">                 </span><span class="c1">// In-memory L1 cache</span>
<span class="w">    </span><span class="nx">l2Cache</span><span class="w">     </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span><span class="w">             </span><span class="c1">// Redis L2 cache</span>
<span class="w">    </span><span class="nx">ttlMap</span><span class="w">      </span><span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="w">                 </span><span class="c1">// TTL tracking for L1</span>
<span class="w">    </span><span class="nx">cleanupStop</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">mutex</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">CacheItem</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="w">     </span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">ExpiresAt</span><span class="w"> </span><span class="kt">int64</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewMultiLevelCacheManager</span><span class="p">(</span><span class="nx">redisClient</span><span class="w"> </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">manager</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MultiLevelCacheManager</span><span class="p">{</span>
<span class="w">        </span><span class="nx">l1Cache</span><span class="p">:</span><span class="w">     </span><span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="p">{},</span>
<span class="w">        </span><span class="nx">l2Cache</span><span class="p">:</span><span class="w">     </span><span class="nx">redisClient</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ttlMap</span><span class="p">:</span><span class="w">      </span><span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="p">{},</span>
<span class="w">        </span><span class="nx">cleanupStop</span><span class="p">:</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Start cleanup goroutine</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">manager</span><span class="p">.</span><span class="nx">startCleanupRoutine</span><span class="p">()</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">manager</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Get</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Check L1 cache first</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">cacheItem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">item</span><span class="p">.(</span><span class="nx">CacheItem</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">cacheItem</span><span class="p">.</span><span class="nx">ExpiresAt</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">cacheItem</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Expired, remove from L1</span>
<span class="w">            </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Fall back to L2 cache (Redis)</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l2Cache</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">).</span><span class="nx">Result</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">value</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Promote to L1 cache with shorter TTL</span>
<span class="w">            </span><span class="nx">cm</span><span class="p">.</span><span class="nx">setL1Cache</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Set</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Store in L1 cache</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">setL1Cache</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Store in L2 cache (Redis)</span>
<span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l2Cache</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">).</span><span class="nx">Err</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">setL1Cache</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expiresAt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="nx">ttl</span><span class="p">).</span><span class="nx">Unix</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">CacheItem</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Value</span><span class="p">:</span><span class="w">     </span><span class="nx">value</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ExpiresAt</span><span class="p">:</span><span class="w"> </span><span class="nx">expiresAt</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l2Cache</span><span class="p">.</span><span class="nx">Del</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">key</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">startCleanupRoutine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">ticker</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
<span class="w">            </span><span class="nx">cm</span><span class="p">.</span><span class="nx">cleanupExpiredL1Items</span><span class="p">()</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">cm</span><span class="p">.</span><span class="nx">cleanupStop</span><span class="p">:</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">cleanupExpiredL1Items</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Range</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">item</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">value</span><span class="p">.(</span><span class="nx">CacheItem</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">ExpiresAt</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cm</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cm</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCacheManager</span><span class="p">)</span><span class="w"> </span><span class="nx">Stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">cm</span><span class="p">.</span><span class="nx">cleanupStop</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="42-cache-integration-in-controllers"><strong>4.2 Cache Integration in Controllers</strong></h3>
<p><strong>File</strong>: Modify <code>controllers/playbookcontroller.go</code></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Add caching to playbook operations</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">cacheManager</span><span class="w"> </span><span class="o">*</span><span class="nx">cache</span><span class="p">.</span><span class="nx">MultiLevelCacheManager</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">redisClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">GetOptimizedRedisClient</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cacheManager</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">NewMultiLevelCacheManager</span><span class="p">(</span><span class="nx">redisClient</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Modify GetPlaybookByName function to use cache</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pc</span><span class="w"> </span><span class="nx">PlaybookController</span><span class="p">)</span><span class="w"> </span><span class="nx">GetPlaybookByName</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">,</span><span class="w"> </span><span class="nx">playbookName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;playbook:%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantCode</span><span class="p">,</span><span class="w"> </span><span class="nx">playbookName</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Try cache first</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">cached</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cacheManager</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">);</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">playbook</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cached</span><span class="p">.(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="s">&quot;Playbook retrieved from cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheKey</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">playbook</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Cache miss - get from database</span>
<span class="w">    </span><span class="nx">playbook</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">getPlaybookFromDatabase</span><span class="p">(</span><span class="nx">tenantCode</span><span class="p">,</span><span class="w"> </span><span class="nx">playbookName</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Store in cache for 1 hour</span>
<span class="w">    </span><span class="nx">cacheManager</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="nx">playbook</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">)</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="s">&quot;Playbook stored in cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheKey</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">playbook</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Cache invalidation when playbook is updated</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pc</span><span class="w"> </span><span class="nx">PlaybookController</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdatePlaybook</span><span class="p">(</span><span class="nx">playbook</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pc</span><span class="p">.</span><span class="nx">updatePlaybookInDatabase</span><span class="p">(</span><span class="nx">playbook</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Invalidate cache</span>
<span class="w">    </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;playbook:%s:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">playbook</span><span class="p">.</span><span class="nx">TenantCode</span><span class="p">,</span><span class="w"> </span><span class="nx">playbook</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cacheManager</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="priority-5-memory-management-optimizations-week-4">ðŸ“‹ <strong>Priority 5: Memory Management Optimizations (Week 4)</strong></h2>
<h3 id="51-object-pooling-implementation"><strong>5.1 Object Pooling Implementation</strong></h3>
<p><strong>File</strong>: Create new <code>utils/objectPool.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;sync&quot;</span>
<span class="w">    </span><span class="s">&quot;securaa_services/securaa_playbook/models&quot;</span>
<span class="p">)</span>

<span class="c1">// Object pools for frequently allocated objects</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">taskRequestPool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">New</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskRequest</span><span class="p">{}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">playbookObjectPool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">New</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">{}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">responsePool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">New</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">{}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">stringBuilderPool</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Pool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">New</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span><span class="p">{}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>

<span class="c1">// TaskRequest pool functions</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetTaskRequest</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskRequest</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">taskRequestPool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskRequest</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Reset the object</span>
<span class="w">    </span><span class="o">*</span><span class="nx">req</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskRequest</span><span class="p">{}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">req</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">PutTaskRequest</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">taskRequestPool</span><span class="p">.</span><span class="nx">Put</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// PlaybookObject pool functions</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetPlaybookObject</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">pb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">playbookObjectPool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Reset the object</span>
<span class="w">    </span><span class="o">*</span><span class="nx">pb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">{}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pb</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">PutPlaybookObject</span><span class="p">(</span><span class="nx">pb</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PlaybookObject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">playbookObjectPool</span><span class="p">.</span><span class="nx">Put</span><span class="p">(</span><span class="nx">pb</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Response pool functions</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetResponse</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resp</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">responsePool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// Reset the object</span>
<span class="w">    </span><span class="o">*</span><span class="nx">resp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">{}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">resp</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">PutResponse</span><span class="p">(</span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">responsePool</span><span class="p">.</span><span class="nx">Put</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// StringBuilder pool functions</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">GetStringBuilder</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">stringBuilderPool</span><span class="p">.</span><span class="nx">Get</span><span class="p">().(</span><span class="o">*</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">Reset</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sb</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">PutStringBuilder</span><span class="p">(</span><span class="nx">sb</span><span class="w"> </span><span class="o">*</span><span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">stringBuilderPool</span><span class="p">.</span><span class="nx">Put</span><span class="p">(</span><span class="nx">sb</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Usage example in JSON response building</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">BuildJSONResponse</span><span class="p">(</span><span class="nx">status</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetStringBuilder</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">PutStringBuilder</span><span class="p">(</span><span class="nx">sb</span><span class="p">)</span>

<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">`{&quot;status&quot;:&quot;`</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">`&quot;,&quot;message&quot;:&quot;`</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">`&quot;,&quot;data&quot;:`</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">dataBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sb</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">dataBytes</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;null&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">sb</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;}&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sb</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="52-memory-optimized-json-processing"><strong>5.2 Memory-Optimized JSON Processing</strong></h3>
<p><strong>File</strong>: Create new <code>utils/jsonOptimizer.go</code></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">utils</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;encoding/json&quot;</span>
<span class="w">    </span><span class="s">&quot;io&quot;</span>
<span class="w">    </span><span class="s">&quot;bytes&quot;</span>
<span class="p">)</span>

<span class="c1">// StreamingJSONProcessor for large JSON data</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">StreamingJSONProcessor</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">decoder</span><span class="w"> </span><span class="o">*</span><span class="nx">json</span><span class="p">.</span><span class="nx">Decoder</span>
<span class="w">    </span><span class="nx">buffer</span><span class="w">  </span><span class="o">*</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewStreamingJSONProcessor</span><span class="p">(</span><span class="nx">reader</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">Reader</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">StreamingJSONProcessor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">StreamingJSONProcessor</span><span class="p">{</span>
<span class="w">        </span><span class="nx">decoder</span><span class="p">:</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">reader</span><span class="p">),</span>
<span class="w">        </span><span class="nx">buffer</span><span class="p">:</span><span class="w">  </span><span class="o">&amp;</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span><span class="p">{},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">processor</span><span class="w"> </span><span class="o">*</span><span class="nx">StreamingJSONProcessor</span><span class="p">)</span><span class="w"> </span><span class="nx">ProcessLargeJSON</span><span class="p">(</span><span class="nx">callback</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="nx">decoder</span><span class="p">.</span><span class="nx">More</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="nx">decoder</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">item</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Optimized JSON marshaling with buffer reuse</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">MarshalJSONOptimized</span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">buffer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">GetStringBuilder</span><span class="p">()</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">PutStringBuilder</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>

<span class="w">    </span><span class="nx">encoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span>
<span class="w">    </span><span class="nx">encoder</span><span class="p">.</span><span class="nx">SetEscapeHTML</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="c1">// Faster encoding</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">encoder</span><span class="p">.</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Remove trailing newline added by Encode</span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buffer</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">result</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">result</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// Schema validation with caching</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">schemaCache</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">ValidateJSONWithCachedSchema</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nx">schemaName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">schemaCache</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">schemaName</span><span class="p">);</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">validateWithSchema</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">schema</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">schema</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">loadSchema</span><span class="p">(</span><span class="nx">schemaName</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">schemaCache</span><span class="p">.</span><span class="nx">Store</span><span class="p">(</span><span class="nx">schemaName</span><span class="p">,</span><span class="w"> </span><span class="nx">schema</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">validateWithSchema</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">schema</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="implementation-timeline-testing-strategy">ðŸ“‹ <strong>Implementation Timeline &amp; Testing Strategy</strong></h2>
<h3 id="implementation-roadmap">Implementation Roadmap</h3>
<div class="mermaid">
gantt
    title Performance Optimization Implementation Timeline
    dateFormat X
    axisFormat %d

    section Week 1: Database & Connections
    Database Indexes           :active, db-idx, 0, 2
    Query Performance Testing  :db-test, after db-idx, 1
    Connection Pool Setup      :conn-pool, 2, 3
    Load Testing              :load-test1, after conn-pool, 1

    section Week 2: Parallel Processing
    Worker Pool Implementation :worker-pool, 7, 3
    Sequential vs Parallel Testing :parallel-test, after worker-pool, 1
    Controller Integration    :controller-int, 10, 2
    Resource Monitoring      :resource-mon, after controller-int, 1

    section Week 3: Caching & Memory
    Multi-level Cache        :cache-impl, 14, 3
    Cache Integration        :cache-int, after cache-impl, 1
    Object Pooling          :obj-pool, 17, 2
    Memory Profiling        :mem-prof, after obj-pool, 1

    section Week 4: Testing & Monitoring
    Load Test Scenarios     :load-scenarios, 21, 3
    Performance Benchmarking :perf-bench, after load-scenarios, 1
    Monitoring Setup        :monitoring, 24, 2
    Documentation          :docs, after monitoring, 1
</div>

<h3 id="week-1-database-connection-optimizations"><strong>Week 1: Database &amp; Connection Optimizations</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Day 1-2: Database indexes</span>
-<span class="w"> </span>Create<span class="w"> </span>index<span class="w"> </span>scripts
-<span class="w"> </span>Test<span class="w"> </span>query<span class="w"> </span>performance<span class="w"> </span>before/after
-<span class="w"> </span>Monitor<span class="w"> </span>slow<span class="w"> </span>query<span class="w"> </span>logs

<span class="c1"># Day 3-5: Connection pool optimization</span>
-<span class="w"> </span>Implement<span class="w"> </span>MongoDB<span class="w"> </span>connection<span class="w"> </span>pooling
-<span class="w"> </span>Configure<span class="w"> </span>Redis<span class="w"> </span>connection<span class="w"> </span>optimization
-<span class="w"> </span>Load<span class="w"> </span><span class="nb">test</span><span class="w"> </span>with<span class="w"> </span>concurrent<span class="w"> </span>requests
</code></pre></div>

<h3 id="week-2-parallel-processing-foundation"><strong>Week 2: Parallel Processing Foundation</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Day 1-3: Worker pool implementation</span>
-<span class="w"> </span>Create<span class="w"> </span>worker<span class="w"> </span>pool<span class="w"> </span>structure
-<span class="w"> </span>Test<span class="w"> </span>with<span class="w"> </span>sample<span class="w"> </span>tasks
-<span class="w"> </span>Benchmark<span class="w"> </span>sequential<span class="w"> </span>vs<span class="w"> </span>parallel

<span class="c1"># Day 4-5: Integration with execution controller</span>
-<span class="w"> </span>Modify<span class="w"> </span>existing<span class="w"> </span>execution<span class="w"> </span>flow
-<span class="w"> </span>Test<span class="w"> </span>parallel<span class="w"> </span>task<span class="w"> </span>execution
-<span class="w"> </span>Monitor<span class="w"> </span>resource<span class="w"> </span>usage
</code></pre></div>

<h3 id="week-3-caching-memory-management"><strong>Week 3: Caching &amp; Memory Management</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Day 1-3: Multi-level cache implementation</span>
-<span class="w"> </span>Implement<span class="w"> </span>cache<span class="w"> </span>manager
-<span class="w"> </span>Integrate<span class="w"> </span>with<span class="w"> </span>controllers
-<span class="w"> </span>Test<span class="w"> </span>cache<span class="w"> </span>hit/miss<span class="w"> </span>ratios

<span class="c1"># Day 4-5: Object pooling</span>
-<span class="w"> </span>Implement<span class="w"> </span>object<span class="w"> </span>pools
-<span class="w"> </span>Integrate<span class="w"> </span>with<span class="w"> </span>request<span class="w"> </span>processing
-<span class="w"> </span>Memory<span class="w"> </span>profiling<span class="w"> </span>and<span class="w"> </span>optimization
</code></pre></div>

<h3 id="week-4-performance-testing-monitoring"><strong>Week 4: Performance Testing &amp; Monitoring</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Day 1-3: Load testing</span>
-<span class="w"> </span>Create<span class="w"> </span>load<span class="w"> </span><span class="nb">test</span><span class="w"> </span>scenarios
-<span class="w"> </span>Test<span class="w"> </span>optimized<span class="w"> </span>vs<span class="w"> </span>original<span class="w"> </span>code
-<span class="w"> </span>Measure<span class="w"> </span>performance<span class="w"> </span>improvements

<span class="c1"># Day 4-5: Monitoring implementation</span>
-<span class="w"> </span>Add<span class="w"> </span>performance<span class="w"> </span>metrics
-<span class="w"> </span>Create<span class="w"> </span>dashboards
-<span class="w"> </span>Set<span class="w"> </span>up<span class="w"> </span>alerting
</code></pre></div>

<hr />
<h2 id="performance-optimization-workflow">ðŸ“Š <strong>Performance Optimization Workflow</strong></h2>
<div class="mermaid">
flowchart TD
    START([Start Optimization]) --> ANALYZE[Analyze Current Performance]
    ANALYZE --> IDENTIFY{Identify Bottlenecks}

    IDENTIFY --> DB_SLOW[Database Queries Slow]
    IDENTIFY --> MEM_HIGH[High Memory Usage]
    IDENTIFY --> CONC_LOW[Low Concurrency]
    IDENTIFY --> CACHE_MISS[Cache Misses]

    DB_SLOW --> DB_OPT[Database Optimization]
    MEM_HIGH --> MEM_OPT[Memory Management]
    CONC_LOW --> PARALLEL_OPT[Parallel Processing]
    CACHE_MISS --> CACHE_OPT[Caching Strategy]

    DB_OPT --> IMPL1[Implement Indexes & Query Optimization]
    MEM_OPT --> IMPL2[Implement Object Pooling]
    PARALLEL_OPT --> IMPL3[Implement Worker Pools]
    CACHE_OPT --> IMPL4[Implement Multi-level Cache]

    IMPL1 --> TEST1[Performance Testing]
    IMPL2 --> TEST1
    IMPL3 --> TEST1
    IMPL4 --> TEST1

    TEST1 --> MEASURE{Performance Improved?}
    MEASURE -->|Yes| MONITOR[Setup Monitoring]
    MEASURE -->|No| IDENTIFY

    MONITOR --> DEPLOY[Deploy to Production]
    DEPLOY --> END([Optimization Complete])

    style START fill:#e1f5fe
    style END fill:#e8f5e8
    style MEASURE fill:#fff3e0
    style DB_OPT fill:#f3e5f5
    style MEM_OPT fill:#f3e5f5
    style PARALLEL_OPT fill:#f3e5f5
    style CACHE_OPT fill:#f3e5f5
</div>

<hr />
<h2 id="performance-benchmarking-commands">ðŸ“‹ <strong>Performance Benchmarking Commands</strong></h2>
<h3 id="database-performance-testing"><strong>Database Performance Testing</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Before optimization</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>BenchmarkQueryPlaybooks<span class="w"> </span>-count<span class="o">=</span><span class="m">5</span><span class="w"> </span>-benchmem

<span class="c1"># After optimization (should show 5-10x improvement)</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>BenchmarkQueryPlaybooksOptimized<span class="w"> </span>-count<span class="o">=</span><span class="m">5</span><span class="w"> </span>-benchmem
</code></pre></div>

<h3 id="concurrency-testing"><strong>Concurrency Testing</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Test parallel execution</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-bench<span class="o">=</span>BenchmarkParallelExecution<span class="w"> </span>-count<span class="o">=</span><span class="m">5</span><span class="w"> </span>-benchmem

<span class="c1"># Load testing with hey tool</span>
hey<span class="w"> </span>-n<span class="w"> </span><span class="m">1000</span><span class="w"> </span>-c<span class="w"> </span><span class="m">50</span><span class="w"> </span>-m<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;playbook_name&quot;:&quot;test&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>http://localhost:8040/runplaybook/
</code></pre></div>

<h3 id="memory-profiling"><strong>Memory Profiling</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Enable pprof in main.go</span>
import<span class="w"> </span>_<span class="w"> </span><span class="s2">&quot;net/http/pprof&quot;</span>

<span class="c1"># Memory profiling</span>
go<span class="w"> </span>tool<span class="w"> </span>pprof<span class="w"> </span>http://localhost:6060/debug/pprof/heap

<span class="c1"># CPU profiling during load test</span>
go<span class="w"> </span>tool<span class="w"> </span>pprof<span class="w"> </span>http://localhost:6060/debug/pprof/profile?seconds<span class="o">=</span><span class="m">30</span>
</code></pre></div>

<hr />
<h2 id="monitoring-metrics">ðŸ” <strong>Monitoring &amp; Metrics</strong></h2>
<h3 id="key-performance-indicators-to-track"><strong>Key Performance Indicators to Track</strong></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Add these metrics to your monitoring</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">PerformanceMetrics</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">DatabaseQueryTime</span><span class="w">     </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="w">    </span><span class="nx">CacheHitRatio</span><span class="w">        </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">ConcurrentExecutions</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">MemoryUsage</span><span class="w">          </span><span class="kt">int64</span>
<span class="w">    </span><span class="nx">TaskThroughput</span><span class="w">       </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">ErrorRate</span><span class="w">            </span><span class="kt">float64</span>
<span class="p">}</span>

<span class="c1">// Example metrics collection</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">collectMetrics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Database query time</span>
<span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// ... database query</span>
<span class="w">    </span><span class="nx">dbQueryTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Cache metrics</span>
<span class="w">    </span><span class="nx">cacheHits</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getCacheHits</span><span class="p">()</span>
<span class="w">    </span><span class="nx">cacheMisses</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getCacheMisses</span><span class="p">()</span>
<span class="w">    </span><span class="nx">hitRatio</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">cacheHits</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">float64</span><span class="p">(</span><span class="nx">cacheHits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">cacheMisses</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Memory usage</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">MemStats</span>
<span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">ReadMemStats</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">)</span>
<span class="w">    </span><span class="nx">memoryUsage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">Alloc</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Log metrics</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Performance metrics&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;db_query_time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dbQueryTime</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;cache_hit_ratio&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">hitRatio</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;memory_usage_mb&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">memoryUsage</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<hr />
<h2 id="implementation-notes-warnings">âš ï¸ <strong>Implementation Notes &amp; Warnings</strong></h2>
<h3 id="database-optimizations"><strong>Database Optimizations</strong></h3>
<ul>
<li><strong>Index Creation</strong>: Run during maintenance window, can be resource intensive</li>
<li><strong>Connection Pools</strong>: Monitor connection usage, adjust pool sizes based on load</li>
<li><strong>Batch Operations</strong>: Test batch sizes, larger isn't always better</li>
</ul>
<h3 id="concurrency-optimizations"><strong>Concurrency Optimizations</strong></h3>
<ul>
<li><strong>Worker Pool Size</strong>: Start with CPU count * 2, adjust based on I/O vs CPU bound tasks</li>
<li><strong>Channel Buffer Sizes</strong>: Balance memory usage vs throughput</li>
<li><strong>Context Cancellation</strong>: Always implement proper cancellation to prevent goroutine leaks</li>
</ul>
<h3 id="memory-management"><strong>Memory Management</strong></h3>
<ul>
<li><strong>Object Pools</strong>: Only beneficial for frequently allocated objects</li>
<li><strong>Cache Sizes</strong>: Monitor memory usage, implement cache eviction policies</li>
<li><strong>Garbage Collection</strong>: Profile GC pressure, adjust GOGC if needed</li>
</ul>
<h3 id="testing-requirements"><strong>Testing Requirements</strong></h3>
<ul>
<li><strong>Load Testing</strong>: Test with production-like data volumes</li>
<li><strong>Race Condition Testing</strong>: Use <code>go test -race</code> for all concurrent code</li>
<li><strong>Memory Leak Testing</strong>: Run long-duration tests with memory monitoring</li>
</ul>
<hr />
<h2 id="expected-performance-improvements">ðŸ“ˆ <strong>Expected Performance Improvements</strong></h2>
<h3 id="performance-metrics-comparison">Performance Metrics Comparison</h3>
<div class="mermaid">
xychart-beta
    title "Performance Improvement Metrics"
    x-axis ["Database Queries", "Concurrent Requests", "Memory Usage", "Task Execution", "Cache Performance"]
    y-axis "Improvement Factor" 0 --> 10
    bar [5, 3, 2, 7, 9]
</div>

<h3 id="detailed-performance-comparison">Detailed Performance Comparison</h3>
<table>
<thead>
<tr>
<th><strong>Optimization</strong></th>
<th><strong>Metric</strong></th>
<th><strong>Current</strong></th>
<th><strong>Optimized</strong></th>
<th><strong>Improvement</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Database Queries</td>
<td>Response Time</td>
<td>500-2000ms</td>
<td>50-200ms</td>
<td><strong>5-10x faster</strong></td>
</tr>
<tr>
<td>Concurrent Requests</td>
<td>Throughput</td>
<td>100 req/sec</td>
<td>300-400 req/sec</td>
<td><strong>3-4x increase</strong></td>
</tr>
<tr>
<td>Memory Usage</td>
<td>Heap Allocation</td>
<td>100MB</td>
<td>30-50MB</td>
<td><strong>50-70% reduction</strong></td>
</tr>
<tr>
<td>Task Execution</td>
<td>Parallel Tasks</td>
<td>Sequential</td>
<td>5-10 parallel</td>
<td><strong>5-10x throughput</strong></td>
</tr>
<tr>
<td>Cache Hit Ratio</td>
<td>Cache Performance</td>
<td>0%</td>
<td>80-90%</td>
<td><strong>80-90% cache hits</strong></td>
</tr>
</tbody>
</table>
<h3 id="performance-impact-timeline">Performance Impact Timeline</h3>
<div class="mermaid">
gantt
    title Expected Performance Impact Over Time
    dateFormat X
    axisFormat Week %d

    section Database Optimization
    Query Performance        :db-perf, 0, 7
    Index Creation Impact    :milestone, db-milestone, 7, 0

    section Concurrency
    Connection Pool Setup    :conn-setup, 7, 7
    Parallel Processing      :parallel, 14, 7
    Throughput Milestone     :milestone, throughput-milestone, 21, 0

    section Memory & Caching
    Object Pooling          :obj-pool, 14, 7
    Cache Implementation    :cache, 21, 7
    Memory Optimization     :milestone, mem-milestone, 28, 0
</div>

<hr />
<h2 id="getting-started-checklist">ðŸš€ <strong>Getting Started Checklist</strong></h2>
<ul>
<li>[ ] <strong>Week 1</strong>: Create database indexes and test query performance</li>
<li>[ ] <strong>Week 1</strong>: Implement connection pool optimizations</li>
<li>[ ] <strong>Week 2</strong>: Create worker pool for parallel task execution</li>
<li>[ ] <strong>Week 2</strong>: Integrate parallel processing with existing controllers</li>
<li>[ ] <strong>Week 3</strong>: Implement multi-level caching strategy</li>
<li>[ ] <strong>Week 3</strong>: Add object pooling for memory optimization</li>
<li>[ ] <strong>Week 4</strong>: Comprehensive load testing and performance validation</li>
<li>[ ] <strong>Week 4</strong>: Set up monitoring and alerting for optimized metrics</li>
</ul>
<hr />
<p><strong>Questions or need clarification on any optimization? Contact the development team lead or create an issue in the project repository.</strong></p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 18, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
