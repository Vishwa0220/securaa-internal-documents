<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Securaa User Service - Low Level Design - Securaa Platform Documentation</title>
    <link rel="stylesheet" href="assets/css/documentation.css">
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.4/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <header class="main-header">
        <h1>Securaa Platform Documentation</h1>
        <p>Comprehensive documentation for Securaa security platform services</p>
    </header>
    <nav class="documentation-nav">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="securaa-playbook-high-level-design.html">Securaa Playbook High Level Design</a></li>
            <li><a href="securaa-playbook-low-level-design.html">Securaa Playbook Low Level Design</a></li>
            <li><a href="optimization-guide.html">Optimization Guide</a></li>
            <li><a href="securaa-siem-high-level-design.html">Securaa SIEM High Level Design</a></li>
            <li><a href="securaa-platform-high-level-design.html">Securaa Platform</a></li>
            <li><a href="process-manager-high-level-design.html">Process Manager High Level Design</a></li>
            <li><a href="process-manager-low-level-design.html">Process Manager Low Level Design</a></li>
            <li><a href="securaa-user-high-level-design.html">Securaa User High Level Design</a></li>
            <li><a href="securaa-user-low-level-design.html">Securaa User Low Level Design</a></li>
        </ul>
    </nav>
    <main class="main-content">
        <h1>Securaa User Service - Low Level Design Document</h1>
        <h2>Document Information</h2>
        <ul>
            <li><strong>Service Name</strong>: Securaa User Service</li>
            <li><strong>Version</strong>: 1.0</li>
            <li><strong>Date</strong>: September 18, 2025</li>
            <li><strong>Author</strong>: Development Team</li>
            <li><strong>Related Documents</strong>: ZONA_USER_LLD.md</li>
        </ul>
        
        <h2>Table of Contents</h2>
        <ol>
            <li><a href="#technical-architecture">Technical Architecture Overview</a></li>
            <li><a href="#database-design">Database Design & Data Models</a></li>
            <li><a href="#api-design">API Design & Endpoint Specifications</a></li>
            <li><a href="#security-implementation">Security Implementation Details</a></li>
            <li><a href="#deployment-infrastructure">Deployment & Infrastructure Implementation</a></li>
            <li><a href="#monitoring-observability">Monitoring & Observability Implementation</a></li>
            <li><a href="#testing-strategy">Testing Strategy & Implementation</a></li>
            <li><a href="#performance-optimization">Performance Optimization Strategies</a></li>
            <li><a href="#error-handling">Error Handling & Recovery</a></li>
            <li><a href="#integration-details">Integration Implementation Details</a></li>
        </ol>
        <hr>
        
        <h2 id="technical-architecture">üîß Technical Architecture Overview</h2>
        
        <h3>Service Implementation Architecture</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Go Application Layer"
        subgraph "HTTP Server"
            MAIN[main.go<br/>Application Bootstrap]
            APP[app.go<br/>Router & Middleware]
            TLS_CONFIG[TLS Configuration<br/>Certificate Management]
            GRACEFUL_SHUTDOWN[Graceful Shutdown<br/>Signal Handling]
        end
        
        subgraph "Middleware Stack"
            CORS[CORS Handler<br/>Cross-Origin Requests]
            AUTH_MW[Authentication Middleware<br/>JWT Validation]
            AUTHZ_MW[Authorization Middleware<br/>Permission Checks]
            RATE_LIMIT[Rate Limiting<br/>Request Throttling]
            AUDIT_MW[Audit Middleware<br/>Request Logging]
            SECURITY_HEADERS[Security Headers<br/>OWASP Compliance]
        end
        
        subgraph "Controller Layer"
            USER_CTRL[User Controller<br/>User Management]
            AUTH_CTRL[Auth Controller<br/>Authentication]
            ROLE_CTRL[Role Controller<br/>RBAC Management]
            TENANT_CTRL[Tenant Controller<br/>Multi-tenancy]
            NOTIFICATION_CTRL[Notification Controller<br/>Real-time Events]
            ADMIN_CTRL[Admin Controller<br/>System Management]
        end
        
        subgraph "Service Layer"
            USER_SVC[User Service<br/>Business Logic]
            AUTH_SVC[Auth Service<br/>Authentication Logic]
            ROLE_SVC[Role Service<br/>Permission Logic]
            TENANT_SVC[Tenant Service<br/>Isolation Logic]
            NOTIFICATION_SVC[Notification Service<br/>Event Processing]
            CACHE_SVC[Cache Service<br/>Redis Operations]
        end
        
        subgraph "Repository Layer"
            USER_REPO[User Repository<br/>Data Access]
            ROLE_REPO[Role Repository<br/>RBAC Data]
            TENANT_REPO[Tenant Repository<br/>Tenant Data]
            AUDIT_REPO[Audit Repository<br/>Compliance Data]
            NOTIFICATION_REPO[Notification Repository<br/>Event Data]
        end
    end
    
    subgraph "Data Storage"
        MONGODB[(MongoDB<br/>Primary Data Store)]
        REDIS[(Redis<br/>Cache & Sessions)]
    end
    
    subgraph "External Services"
        SMTP[SMTP Service<br/>Email Delivery]
        SMS_GATEWAY[SMS Gateway<br/>2FA Messages]
        LDAP[LDAP/AD<br/>Corporate Directory]
    end
    
    MAIN --> APP
    APP --> TLS_CONFIG
    APP --> GRACEFUL_SHUTDOWN
    
    APP --> CORS
    CORS --> AUTH_MW
    AUTH_MW --> AUTHZ_MW
    AUTHZ_MW --> RATE_LIMIT
    RATE_LIMIT --> AUDIT_MW
    AUDIT_MW --> SECURITY_HEADERS
    
    SECURITY_HEADERS --> USER_CTRL
    SECURITY_HEADERS --> AUTH_CTRL
    SECURITY_HEADERS --> ROLE_CTRL
    SECURITY_HEADERS --> TENANT_CTRL
    SECURITY_HEADERS --> NOTIFICATION_CTRL
    SECURITY_HEADERS --> ADMIN_CTRL
    
    USER_CTRL --> USER_SVC
    AUTH_CTRL --> AUTH_SVC
    ROLE_CTRL --> ROLE_SVC
    TENANT_CTRL --> TENANT_SVC
    NOTIFICATION_CTRL --> NOTIFICATION_SVC
    ADMIN_CTRL --> CACHE_SVC
    
    USER_SVC --> USER_REPO
    AUTH_SVC --> USER_REPO
    ROLE_SVC --> ROLE_REPO
    TENANT_SVC --> TENANT_REPO
    NOTIFICATION_SVC --> AUDIT_REPO
    CACHE_SVC --> NOTIFICATION_REPO
    
    USER_REPO --> MONGODB
    ROLE_REPO --> MONGODB
    TENANT_REPO --> MONGODB
    AUDIT_REPO --> MONGODB
    NOTIFICATION_REPO --> MONGODB
    
    CACHE_SVC --> REDIS
    AUTH_SVC --> REDIS
    
    NOTIFICATION_SVC --> SMTP
    NOTIFICATION_SVC --> SMS_GATEWAY
    AUTH_SVC --> LDAP
        </div>

        <h3>Code Structure & Package Organization</h3>
        
        <div class="mermaid">
graph LR
    subgraph "Project Root"
        MAIN[main.go]
        APP[app.go]
        CONFIG[config/]
        DOCS[docs/]
    end
    
    subgraph "Controllers Package"
        USER_CTRL[controllers/user.go]
        AUTH_CTRL[controllers/auth.go]
        ROLE_CTRL[controllers/role.go]
        TENANT_CTRL[controllers/tenant.go]
        NOTIFICATION_CTRL[controllers/notification.go]
        ADMIN_CTRL[controllers/admin.go]
    end
    
    subgraph "Services Package"
        USER_SVC[services/user.go]
        AUTH_SVC[services/auth.go]
        ROLE_SVC[services/role.go]
        TENANT_SVC[services/tenant.go]
        NOTIFICATION_SVC[services/notification.go]
        CACHE_SVC[services/cache.go]
    end
    
    subgraph "Models Package"
        USER_MODEL[models/user.go]
        ROLE_MODEL[models/role.go]
        TENANT_MODEL[models/tenant.go]
        SESSION_MODEL[models/session.go]
        NOTIFICATION_MODEL[models/notification.go]
    end
    
    subgraph "Repository Package"
        USER_REPO[repository/user.go]
        ROLE_REPO[repository/role.go]
        TENANT_REPO[repository/tenant.go]
        AUDIT_REPO[repository/audit.go]
        NOTIFICATION_REPO[repository/notification.go]
    end
    
    subgraph "Middleware Package"
        AUTH_MW[middleware/auth.go]
        AUTHZ_MW[middleware/authz.go]
        CORS_MW[middleware/cors.go]
        RATE_MW[middleware/rate_limit.go]
        AUDIT_MW[middleware/audit.go]
    end
    
    subgraph "Utils Package"
        JWT_UTIL[utils/jwt.go]
        CRYPTO_UTIL[utils/crypto.go]
        VALIDATION_UTIL[utils/validation.go]
        EMAIL_UTIL[utils/email.go]
        DB_UTIL[utils/database.go]
    end
    
    MAIN --> CONFIG
    APP --> USER_CTRL
    USER_CTRL --> USER_SVC
    USER_SVC --> USER_MODEL
    USER_MODEL --> USER_REPO
    AUTH_MW --> JWT_UTIL
    CRYPTO_UTIL --> VALIDATION_UTIL
        </div>

        <h4>Package Responsibilities:</h4>
        <ul>
            <li><strong>Controllers</strong>: HTTP request handling, input validation, response formatting</li>
            <li><strong>Services</strong>: Business logic implementation, data processing, external integrations</li>
            <li><strong>Models</strong>: Data structures, validation rules, serialization/deserialization</li>
            <li><strong>Repository</strong>: Database operations, query optimization, data access patterns</li>
            <li><strong>Middleware</strong>: Cross-cutting concerns, security, logging, rate limiting</li>
            <li><strong>Utils</strong>: Shared utilities, helper functions, common operations</li>
        </ul>

        <h2 id="database-design">üèóÔ∏è Database Design & Data Models</h2>
        
        <h3>MongoDB Collection Schema Architecture</h3>
        
        <div class="mermaid">
erDiagram
    USERS ||--o{ USER_SESSIONS : "creates"
    USERS }o--|| TENANTS : "belongs_to"
    USERS ||--o{ USER_ROLES : "assigned"
    USERS ||--o{ NOTIFICATIONS : "receives"
    USERS ||--o{ AUDIT_LOGS : "generates"
    
    ROLES ||--o{ USER_ROLES : "assigned_to"
    ROLES ||--o{ ROLE_PERMISSIONS : "contains"
    ROLES }o--|| TENANTS : "scoped_to"
    
    TENANTS ||--o{ TENANT_CONFIGS : "configured_by"
    TENANTS ||--o{ TENANT_QUOTAS : "limited_by"
    
    PERMISSIONS ||--o{ ROLE_PERMISSIONS : "assigned_to"
    
    NOTIFICATIONS ||--o{ NOTIFICATION_CHANNELS : "delivered_via"
    NOTIFICATIONS }o--|| TENANTS : "scoped_to"
    
    USERS {
        ObjectId _id PK
        string email UK
        string username UK
        string password_hash
        string tenant_code FK
        string first_name
        string last_name
        string phone
        boolean is_active
        boolean email_verified
        datetime created_at
        datetime updated_at
        datetime last_login
        string[] roles
        object profile_data
        object security_settings
        object preferences
    }
    
    TENANTS {
        ObjectId _id PK
        string tenant_code UK
        string name
        string domain
        object configuration
        object security_policy
        object resource_quotas
        boolean is_active
        datetime created_at
        datetime updated_at
        string billing_plan
        object integrations
    }
    
    ROLES {
        ObjectId _id PK
        string name UK
        string tenant_code FK
        string description
        string[] permissions
        boolean is_system_role
        object metadata
        datetime created_at
        datetime updated_at
    }
    
    PERMISSIONS {
        ObjectId _id PK
        string name UK
        string resource
        string action
        string description
        object constraints
        boolean is_system_permission
    }
    
    USER_SESSIONS {
        ObjectId _id PK
        string session_id UK
        ObjectId user_id FK
        string tenant_code FK
        string jwt_token_hash
        string device_info
        string ip_address
        string geo_location
        datetime created_at
        datetime expires_at
        datetime last_accessed
        boolean is_active
    }
    
    NOTIFICATIONS {
        ObjectId _id PK
        string tenant_code FK
        ObjectId user_id FK
        string type
        string title
        string message
        object data
        string priority
        string[] channels
        object delivery_status
        datetime created_at
        datetime scheduled_at
        boolean is_read
    }
        </div>

        <h4>Collection Design Principles:</h4>
        <ul>
            <li><strong>Multi-Tenancy</strong>: All collections include tenant_code for data isolation</li>
            <li><strong>Indexing Strategy</strong>: Compound indexes on tenant_code + other query fields</li>
            <li><strong>Document Embedding</strong>: Nested objects for related data to reduce joins</li>
            <li><strong>Schema Validation</strong>: MongoDB schema validation for data integrity</li>
        </ul>

        <h3>Redis Cache Schema Design</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Session Storage"
        SESSION_KEY[session:{session_id}]
        SESSION_DATA[User ID, Tenant, Permissions, Expires]
    end
    
    subgraph "User Cache"
        USER_KEY[user:{tenant}:{user_id}]
        USER_DATA[Profile, Roles, Preferences]
    end
    
    subgraph "Role Cache"
        ROLE_KEY[role:{tenant}:{role_id}]
        ROLE_DATA[Permissions, Metadata]
    end
    
    subgraph "Rate Limiting"
        RATE_KEY[rate:{ip}:{endpoint}]
        RATE_DATA[Request Count, Window Start]
    end
    
    subgraph "Tenant Cache"
        TENANT_KEY[tenant:{tenant_code}]
        TENANT_DATA[Configuration, Quotas, Policies]
    end
    
    SESSION_KEY --> SESSION_DATA
    USER_KEY --> USER_DATA
    ROLE_KEY --> ROLE_DATA
    RATE_KEY --> RATE_DATA
    TENANT_KEY --> TENANT_DATA
        </div>

        <h4>Cache Strategy:</h4>
        <ul>
            <li><strong>TTL Management</strong>: Different expiration times based on data sensitivity</li>
            <li><strong>Cache Invalidation</strong>: Event-driven cache updates on data changes</li>
            <li><strong>Memory Optimization</strong>: Compressed storage for large objects</li>
            <li><strong>High Availability</strong>: Redis clustering for fault tolerance</li>
        </ul>

        <h2 id="api-design">üîó API Design & Endpoint Specifications</h2>
        
        <h3>RESTful API Architecture</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Authentication APIs"
        AUTH_LOGIN[POST /auth/login]
        AUTH_LOGOUT[POST /auth/logout]
        AUTH_REFRESH[POST /auth/refresh]
        AUTH_MFA[POST /auth/mfa/verify]
        AUTH_RESET[POST /auth/reset-password]
    end
    
    subgraph "User Management APIs"
        USER_LIST[GET /users]
        USER_GET[GET /users/{id}]
        USER_CREATE[POST /users]
        USER_UPDATE[PUT /users/{id}]
        USER_DELETE[DELETE /users/{id}]
        USER_PROFILE[GET /users/profile]
    end
    
    subgraph "Role & Permission APIs"
        ROLE_LIST[GET /roles]
        ROLE_CREATE[POST /roles]
        ROLE_UPDATE[PUT /roles/{id}]
        ROLE_DELETE[DELETE /roles/{id}]
        ROLE_ASSIGN[POST /users/{id}/roles]
        PERM_LIST[GET /permissions]
    end
    
    subgraph "Tenant Management APIs"
        TENANT_LIST[GET /tenants]
        TENANT_GET[GET /tenants/{code}]
        TENANT_CREATE[POST /tenants]
        TENANT_UPDATE[PUT /tenants/{code}]
        TENANT_CONFIG[PUT /tenants/{code}/config]
    end
    
    subgraph "Notification APIs"
        NOTIF_LIST[GET /notifications]
        NOTIF_SEND[POST /notifications]
        NOTIF_READ[PUT /notifications/{id}/read]
        NOTIF_PREF[GET /notifications/preferences]
        NOTIF_SUB[POST /notifications/subscribe]
    end
    
    subgraph "Admin APIs"
        ADMIN_STATS[GET /admin/stats]
        ADMIN_AUDIT[GET /admin/audit]
        ADMIN_HEALTH[GET /admin/health]
        ADMIN_CONFIG[PUT /admin/config]
        ADMIN_BACKUP[POST /admin/backup]
    end
        </div>

        <h4>API Design Principles:</h4>
        <ul>
            <li><strong>RESTful Design</strong>: Standard HTTP methods and status codes</li>
            <li><strong>Consistent Response Format</strong>: Unified JSON response structure</li>
            <li><strong>Pagination Support</strong>: Cursor-based pagination for large datasets</li>
            <li><strong>Filtering & Sorting</strong>: Query parameters for data manipulation</li>
            <li><strong>Versioning Strategy</strong>: URL versioning for backward compatibility</li>
        </ul>

        <h3>API Request/Response Flow Diagram</h3>
        
        <div class="mermaid">
sequenceDiagram
    participant Client
    participant LoadBalancer
    participant UserService
    participant AuthMiddleware
    participant AuthzMiddleware
    participant Controller
    participant Service
    participant Repository
    participant MongoDB
    participant Redis
    
    Client->>LoadBalancer: HTTP Request
    LoadBalancer->>UserService: Route Request
    UserService->>AuthMiddleware: Validate JWT
    AuthMiddleware->>Redis: Check Session
    Redis-->>AuthMiddleware: Session Data
    AuthMiddleware->>AuthzMiddleware: Check Permissions
    AuthzMiddleware->>Redis: Get User Roles
    Redis-->>AuthzMiddleware: Role Data
    AuthzMiddleware->>Controller: Process Request
    Controller->>Service: Business Logic
    Service->>Repository: Data Operation
    Repository->>MongoDB: Database Query
    MongoDB-->>Repository: Query Result
    Repository-->>Service: Domain Objects
    Service-->>Controller: Business Result
    Controller-->>UserService: JSON Response
    UserService-->>LoadBalancer: HTTP Response
    LoadBalancer-->>Client: Final Response
        </div>

        <h2 id="security-implementation">üîí Security Implementation Details</h2>
        
        <h3>Authentication & Authorization Flow</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Authentication Layer"
        LOGIN[Login Request]
        CREDENTIAL_CHECK[Credential Validation]
        MFA_CHECK[MFA Verification]
        JWT_GENERATE[JWT Token Generation]
        SESSION_CREATE[Session Creation]
    end
    
    subgraph "Authorization Layer"
        JWT_VALIDATE[JWT Validation]
        PERMISSION_CHECK[Permission Evaluation]
        RESOURCE_ACCESS[Resource Access Control]
        AUDIT_LOG[Audit Logging]
    end
    
    subgraph "Security Controls"
        RATE_LIMITING[Rate Limiting]
        IP_FILTERING[IP Filtering]
        DEVICE_TRUST[Device Trust]
        ANOMALY_DETECTION[Anomaly Detection]
    end
    
    LOGIN --> CREDENTIAL_CHECK
    CREDENTIAL_CHECK --> MFA_CHECK
    MFA_CHECK --> JWT_GENERATE
    JWT_GENERATE --> SESSION_CREATE
    
    SESSION_CREATE --> JWT_VALIDATE
    JWT_VALIDATE --> PERMISSION_CHECK
    PERMISSION_CHECK --> RESOURCE_ACCESS
    RESOURCE_ACCESS --> AUDIT_LOG
    
    JWT_VALIDATE --> RATE_LIMITING
    PERMISSION_CHECK --> IP_FILTERING
    RESOURCE_ACCESS --> DEVICE_TRUST
    AUDIT_LOG --> ANOMALY_DETECTION
        </div>

        <h3>JWT Token Management Implementation</h3>
        
        <div class="mermaid">
graph LR
    subgraph "Token Generation"
        USER_DATA[User Claims]
        PAYLOAD[JWT Payload]
        SIGN[RS256 Signing]
        TOKEN[Access Token]
    end
    
    subgraph "Token Validation"
        INCOMING_TOKEN[Incoming Token]
        SIGNATURE_VERIFY[Signature Verification]
        CLAIMS_EXTRACT[Claims Extraction]
        EXPIRY_CHECK[Expiry Validation]
    end
    
    subgraph "Token Refresh"
        REFRESH_TOKEN[Refresh Token]
        REFRESH_VALIDATE[Refresh Validation]
        NEW_TOKEN[New Access Token]
        SESSION_UPDATE[Session Update]
    end
    
    USER_DATA --> PAYLOAD
    PAYLOAD --> SIGN
    SIGN --> TOKEN
    
    INCOMING_TOKEN --> SIGNATURE_VERIFY
    SIGNATURE_VERIFY --> CLAIMS_EXTRACT
    CLAIMS_EXTRACT --> EXPIRY_CHECK
    
    REFRESH_TOKEN --> REFRESH_VALIDATE
    REFRESH_VALIDATE --> NEW_TOKEN
    NEW_TOKEN --> SESSION_UPDATE
        </div>

        <h4>JWT Implementation Details:</h4>
        <ul>
            <li><strong>Algorithm</strong>: RS256 with 2048-bit RSA keys</li>
            <li><strong>Claims</strong>: User ID, tenant, roles, permissions, device fingerprint</li>
            <li><strong>Expiration</strong>: Configurable TTL (default 1 hour for access, 7 days for refresh)</li>
            <li><strong>Key Rotation</strong>: Automated key rotation every 90 days</li>
        </ul>

        <h3>Role-Based Access Control (RBAC) Implementation</h3>
        
        <div class="mermaid">
graph TB
    subgraph "RBAC Components"
        USERS[Users]
        ROLES[Roles]
        PERMISSIONS[Permissions]
        RESOURCES[Resources]
    end
    
    subgraph "Assignment Relationships"
        USER_ROLE[User-Role Assignment]
        ROLE_PERMISSION[Role-Permission Assignment]
        PERMISSION_RESOURCE[Permission-Resource Mapping]
    end
    
    subgraph "Evaluation Engine"
        CONTEXT[Request Context]
        POLICY_ENGINE[Policy Evaluation]
        DECISION[Access Decision]
        ENFORCEMENT[Policy Enforcement]
    end
    
    USERS --> USER_ROLE
    ROLES --> USER_ROLE
    ROLES --> ROLE_PERMISSION
    PERMISSIONS --> ROLE_PERMISSION
    PERMISSIONS --> PERMISSION_RESOURCE
    RESOURCES --> PERMISSION_RESOURCE
    
    USER_ROLE --> CONTEXT
    ROLE_PERMISSION --> CONTEXT
    PERMISSION_RESOURCE --> CONTEXT
    
    CONTEXT --> POLICY_ENGINE
    POLICY_ENGINE --> DECISION
    DECISION --> ENFORCEMENT
        </div>

        <h4>RBAC Features:</h4>
        <ul>
            <li><strong>Hierarchical Roles</strong>: Role inheritance and delegation</li>
            <li><strong>Fine-grained Permissions</strong>: Resource and action-level controls</li>
            <li><strong>Dynamic Evaluation</strong>: Runtime permission checking</li>
            <li><strong>Tenant Isolation</strong>: Complete role separation per tenant</li>
        </ul>

        <h2 id="deployment-infrastructure">üöÄ Deployment & Infrastructure Implementation</h2>
        
        <h3>Traditional Server Deployment Architecture</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Load Balancer Tier"
        LB1[HAProxy Primary]
        LB2[HAProxy Secondary]
        VIP[Virtual IP]
    end
    
    subgraph "Application Tier"
        APP1[User Service Instance 1<br/>Primary Server]
        APP2[User Service Instance 2<br/>Secondary Server]
        APP3[User Service Instance 3<br/>Worker Server]
    end
    
    subgraph "Database Tier"
        MONGO_PRIMARY[MongoDB Primary<br/>Write Operations]
        MONGO_SEC1[MongoDB Secondary 1<br/>Read Replica]
        MONGO_SEC2[MongoDB Secondary 2<br/>Read Replica]
        MONGO_ARBITER[MongoDB Arbiter<br/>Election Participant]
    end
    
    subgraph "Cache Tier"
        REDIS_MASTER[Redis Master<br/>Session Store]
        REDIS_SLAVE1[Redis Slave 1<br/>Read Replica]
        REDIS_SLAVE2[Redis Slave 2<br/>Read Replica]
    end
    
    subgraph "External Services"
        SMTP_SERVER[SMTP Server<br/>Email Delivery]
        SMS_GATEWAY[SMS Gateway<br/>2FA Messages]
        LDAP_SERVER[LDAP Server<br/>Corporate Directory]
    end
    
    VIP --> LB1
    VIP --> LB2
    LB1 --> APP1
    LB1 --> APP2
    LB1 --> APP3
    LB2 --> APP1
    LB2 --> APP2
    LB2 --> APP3
    
    APP1 --> MONGO_PRIMARY
    APP2 --> MONGO_SEC1
    APP3 --> MONGO_SEC2
    
    MONGO_PRIMARY --> MONGO_SEC1
    MONGO_PRIMARY --> MONGO_SEC2
    MONGO_PRIMARY --> MONGO_ARBITER
    
    APP1 --> REDIS_MASTER
    APP2 --> REDIS_SLAVE1
    APP3 --> REDIS_SLAVE2
    
    REDIS_MASTER --> REDIS_SLAVE1
    REDIS_MASTER --> REDIS_SLAVE2
    
    APP1 --> SMTP_SERVER
    APP2 --> SMS_GATEWAY
    APP3 --> LDAP_SERVER
        </div>

        <h4>Deployment Specifications:</h4>
        <ul>
            <li><strong>High Availability</strong>: Redundant components with automatic failover</li>
            <li><strong>Load Distribution</strong>: HAProxy with health checks and session affinity</li>
            <li><strong>Database Replication</strong>: MongoDB replica set with automated elections</li>
            <li><strong>Cache Replication</strong>: Redis master-slave setup with sentinel monitoring</li>
        </ul>

        <h3>Production Deployment Configuration</h3>
        
        <div class="mermaid">
graph TB
    subgraph "System Configuration"
        OS_CONFIG[OS Hardening<br/>CIS Benchmarks]
        FIREWALL_CONFIG[Firewall Rules<br/>iptables/ufw]
        USER_CONFIG[Service Users<br/>Least Privilege]
        CRON_CONFIG[Scheduled Tasks<br/>Backup/Cleanup]
    end
    
    subgraph "Application Configuration"
        APP_CONFIG[Application Config<br/>Environment Variables]
        LOG_CONFIG[Logging Config<br/>Structured Logging]
        MONITOR_CONFIG[Monitoring Config<br/>Metrics Collection]
        SECURITY_CONFIG[Security Config<br/>TLS/Certificates]
    end
    
    subgraph "Database Configuration"
        MONGO_CONFIG[MongoDB Config<br/>Replica Set]
        REDIS_CONFIG[Redis Config<br/>Memory Optimization]
        BACKUP_CONFIG[Backup Config<br/>Automated Backups]
        RESTORE_CONFIG[Restore Config<br/>Recovery Procedures]
    end
    
    subgraph "Network Configuration"
        DNS_CONFIG[DNS Configuration<br/>Service Discovery]
        PROXY_CONFIG[Proxy Configuration<br/>Load Balancing]
        SSL_CONFIG[SSL Configuration<br/>Certificate Management]
        VPN_CONFIG[VPN Configuration<br/>Secure Access]
    end
    
    OS_CONFIG --> APP_CONFIG
    FIREWALL_CONFIG --> MONITOR_CONFIG
    USER_CONFIG --> LOG_CONFIG
    CRON_CONFIG --> SECURITY_CONFIG
    
    APP_CONFIG --> MONGO_CONFIG
    LOG_CONFIG --> REDIS_CONFIG
    MONITOR_CONFIG --> BACKUP_CONFIG
    SECURITY_CONFIG --> RESTORE_CONFIG
    
    MONGO_CONFIG --> DNS_CONFIG
    REDIS_CONFIG --> PROXY_CONFIG
    BACKUP_CONFIG --> SSL_CONFIG
    RESTORE_CONFIG --> VPN_CONFIG
        </div>

        <h2 id="monitoring-observability">üìä Monitoring & Observability Implementation</h2>
        
        <h3>Comprehensive Monitoring Architecture</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Application Metrics"
        APP_METRICS[Application Metrics<br/>Custom Metrics]
        HTTP_METRICS[HTTP Metrics<br/>Request/Response]
        BUSINESS_METRICS[Business Metrics<br/>User Actions]
        ERROR_METRICS[Error Metrics<br/>Exception Tracking]
    end
    
    subgraph "Infrastructure Metrics"
        SYSTEM_METRICS[System Metrics<br/>CPU/Memory/Disk]
        NETWORK_METRICS[Network Metrics<br/>Bandwidth/Latency]
        DATABASE_METRICS[Database Metrics<br/>Query Performance]
        CACHE_METRICS[Cache Metrics<br/>Hit/Miss Ratios]
    end
    
    subgraph "Log Aggregation"
        APP_LOGS[Application Logs<br/>Structured JSON]
        ACCESS_LOGS[Access Logs<br/>HTTP Requests]
        AUDIT_LOGS[Audit Logs<br/>Security Events]
        ERROR_LOGS[Error Logs<br/>Exception Details]
    end
    
    subgraph "Monitoring Stack"
        PROMETHEUS[Prometheus<br/>Metrics Storage]
        GRAFANA[Grafana<br/>Visualization]
        ALERTMANAGER[AlertManager<br/>Alert Routing]
        ELK_STACK[ELK Stack<br/>Log Analysis]
    end
    
    APP_METRICS --> PROMETHEUS
    HTTP_METRICS --> PROMETHEUS
    BUSINESS_METRICS --> PROMETHEUS
    ERROR_METRICS --> PROMETHEUS
    
    SYSTEM_METRICS --> PROMETHEUS
    NETWORK_METRICS --> PROMETHEUS
    DATABASE_METRICS --> PROMETHEUS
    CACHE_METRICS --> PROMETHEUS
    
    APP_LOGS --> ELK_STACK
    ACCESS_LOGS --> ELK_STACK
    AUDIT_LOGS --> ELK_STACK
    ERROR_LOGS --> ELK_STACK
    
    PROMETHEUS --> GRAFANA
    PROMETHEUS --> ALERTMANAGER
    ELK_STACK --> GRAFANA
        </div>

        <h4>Monitoring Capabilities:</h4>
        <ul>
            <li><strong>Real-Time Metrics</strong>: Live dashboards with custom metrics</li>
            <li><strong>Alerting System</strong>: Threshold-based and anomaly detection alerts</li>
            <li><strong>Log Correlation</strong>: Centralized logging with request tracing</li>
            <li><strong>Performance Analytics</strong>: Query optimization and bottleneck identification</li>
        </ul>

        <h2 id="testing-strategy">üß™ Testing Strategy & Implementation</h2>
        
        <h3>Comprehensive Testing Pyramid</h3>
        
        <div class="mermaid">
graph TB
    subgraph "Manual Testing"
        MANUAL[Manual Testing<br/>Exploratory Testing]
        UAT[User Acceptance Testing<br/>Business Validation]
    end
    
    subgraph "End-to-End Testing"
        E2E[E2E Testing<br/>Full Workflow Testing]
        API_E2E[API E2E Testing<br/>Integration Scenarios]
    end
    
    subgraph "Integration Testing"
        SERVICE_INT[Service Integration<br/>Component Testing]
        DB_INT[Database Integration<br/>Data Layer Testing]
        EXTERNAL_INT[External Integration<br/>Third-party APIs]
    end
    
    subgraph "Unit Testing"
        UNIT_TESTS[Unit Tests<br/>Function Level Testing]
        MOCK_TESTS[Mock Testing<br/>Dependency Isolation]
        TABLE_TESTS[Table-driven Tests<br/>Multiple Scenarios]
    end
    
    MANUAL --> E2E
    UAT --> API_E2E
    E2E --> SERVICE_INT
    API_E2E --> DB_INT
    SERVICE_INT --> UNIT_TESTS
    DB_INT --> MOCK_TESTS
    EXTERNAL_INT --> TABLE_TESTS
        </div>

        <h4>Testing Implementation:</h4>
        <ul>
            <li><strong>Test Coverage</strong>: 80%+ code coverage with quality metrics</li>
            <li><strong>Automated Testing</strong>: CI/CD pipeline integration with automated test execution</li>
            <li><strong>Performance Testing</strong>: Load testing and stress testing scenarios</li>
            <li><strong>Security Testing</strong>: Vulnerability scanning and penetration testing</li>
        </ul>

        <h2>Summary</h2>
        <p>The Securaa User Service Low Level Design provides comprehensive technical specifications for implementing a robust, scalable, and secure identity management platform. The detailed architecture, database schemas, API specifications, and deployment configurations ensure successful implementation and operation.</p>
        
        <p>Key implementation highlights include Go-based microservice architecture, MongoDB with Redis caching, comprehensive security controls, and extensive monitoring capabilities. The modular design and clear separation of concerns facilitate maintenance, testing, and future enhancements.</p>
        
        <p>This low-level design serves as a detailed blueprint for development teams to build, deploy, and maintain the Securaa User Service according to enterprise standards and best practices.</p>
    </main>
</body>
</html>