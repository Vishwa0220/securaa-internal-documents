<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Securaa Platform Documentation - Securaa Custom Services - Low Level Design">
    <title>Securaa Custom Services - Low Level Design - Securaa Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>

:root {
    --primary-color: #4f46e5;
    --primary-dark: #3730a3;
    --primary-light: #818cf8;
    --secondary-color: #06b6d4;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
}

/* Header */
.main-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow-lg);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-logo {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.025em;
}

.header-logo span {
    color: var(--secondary-color);
}

/* Navigation */
.documentation-nav {
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    padding: 0.75rem 2rem;
    position: sticky;
    top: 60px;
    z-index: 999;
    box-shadow: var(--shadow-sm);
}

.nav-links {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.nav-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.nav-links a:hover {
    color: var(--primary-color);
    background: var(--bg-tertiary);
}

/* Main Content */
.main-content {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2.5rem;
    background: var(--bg-primary);
    border-radius: 1rem;
    box-shadow: var(--shadow-md);
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
    color: var(--text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--primary-color);
    margin-top: 0;
}

h2 {
    font-size: 1.875rem;
    color: var(--primary-dark);
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 0.5rem;
}

h3 {
    font-size: 1.5rem;
    color: var(--text-primary);
}

h4 {
    font-size: 1.25rem;
    color: var(--text-secondary);
}

h5 {
    font-size: 1.125rem;
}

h6 {
    font-size: 1rem;
    color: var(--text-muted);
}

p {
    margin-bottom: 1rem;
    color: var(--text-primary);
}

/* Links */
a {
    color: var(--primary-color);
    text-decoration: none;
    transition: color 0.2s ease;
}

a:hover {
    color: var(--primary-dark);
    text-decoration: underline;
}

/* Lists */
ul, ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
}

li {
    margin-bottom: 0.5rem;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0;
}

/* Code Blocks */
pre {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    font-size: 0.875rem;
    line-height: 1.6;
    box-shadow: var(--shadow-md);
}

code {
    font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
    font-size: 0.875em;
}

:not(pre) > code {
    background: var(--bg-tertiary);
    color: var(--primary-dark);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

/* Tables */
table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
    border-radius: 0.5rem;
    overflow: hidden;
}

thead {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
}

th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}

td {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

tr:nth-child(even) {
    background: var(--bg-secondary);
}

tr:hover {
    background: var(--bg-tertiary);
}

/* Blockquotes */
blockquote {
    border-left: 4px solid var(--primary-color);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    background: var(--bg-secondary);
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    color: var(--text-secondary);
}

blockquote p:last-child {
    margin-bottom: 0;
}

/* Mermaid Diagrams - Enhanced Styling */
.mermaid {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
    overflow-y: visible;
    min-height: 200px;
}

.mermaid svg {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}

/* Ensure diagrams scale properly */
.mermaid[data-processed="true"] {
    min-height: auto;
}

/* Diagram container for better control */
.diagram-container {
    width: 100%;
    overflow-x: auto;
    padding: 1rem 0;
}

/* HR Styling */
hr {
    border: none;
    border-top: 2px solid var(--border-color);
    margin: 2.5rem 0;
}

/* Table of Contents */
.toc {
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
}

.toc-title {
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.125rem;
}

.toc ul {
    list-style: none;
    padding-left: 0;
}

.toc li {
    margin-bottom: 0.5rem;
}

.toc a {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.toc a:hover {
    color: var(--primary-color);
}

/* Document Info Box */
.doc-info {
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
    font-size: 0.875rem;
}

.doc-info strong {
    color: var(--primary-color);
}

/* Footer */
.footer {
    text-align: center;
    padding: 2rem;
    background: var(--bg-tertiary);
    color: var(--text-muted);
    font-size: 0.875rem;
    margin-top: 2rem;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
    background: var(--text-muted);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* Print Styles */
@media print {
    .main-header, .documentation-nav, .footer {
        display: none !important;
    }

    .main-content {
        max-width: none;
        margin: 0;
        padding: 20px;
        box-shadow: none;
        border-radius: 0;
    }

    body {
        background: white;
        font-size: 11pt;
    }

    h1 {
        font-size: 24pt;
        -webkit-text-fill-color: var(--primary-dark);
        page-break-after: avoid;
    }

    h2, h3, h4 {
        page-break-after: avoid;
    }

    pre {
        background: #f5f5f5 !important;
        color: #333 !important;
        border: 1px solid #ddd;
        page-break-inside: avoid;
        font-size: 9pt;
    }

    table {
        page-break-inside: avoid;
    }

    .mermaid {
        page-break-inside: avoid;
        background: white !important;
        border: 1px solid #ddd;
        max-width: 100% !important;
    }

    .mermaid svg {
        max-width: 100% !important;
        max-height: 700px !important;
    }

    a {
        color: var(--primary-dark) !important;
        text-decoration: none !important;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin: 1rem;
        padding: 1.5rem;
        border-radius: 0.5rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .nav-links {
        gap: 0.75rem;
    }

    .nav-links a {
        font-size: 0.75rem;
        padding: 0.375rem 0.5rem;
    }

    pre {
        font-size: 0.8rem;
        padding: 1rem;
    }

    table {
        font-size: 0.8rem;
    }

    th, td {
        padding: 0.5rem;
    }
}

/* Animation for smooth transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.main-content {
    animation: fadeIn 0.3s ease-out;
}

/* Index-specific styles */
.hero {
    text-align: center;
    padding: 3rem 0;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    border-radius: 1rem;
    margin-bottom: 3rem;
}

.hero h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
    border: none;
    padding: 0;
}

.hero p {
    font-size: 1.25rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
}

.doc-sections {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.doc-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-sm);
}

.doc-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-light);
}

.doc-card h3 {
    color: var(--primary-color);
    font-size: 1.25rem;
    margin-top: 0;
    margin-bottom: 0.75rem;
}

.doc-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.doc-card .links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.doc-card .links a {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.doc-card .links a:hover {
    background: var(--primary-color);
    color: white;
    text-decoration: none;
}

.section-title {
    font-size: 1.75rem;
    color: var(--primary-dark);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border-color);
}

    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">Securaa<span>Docs</span></div>
            <div class="header-meta">
                <span>Generated: December 18, 2025</span>
            </div>
        </div>
    </header>

    <nav class="documentation-nav">
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="securaa-platform-high-level-design.html">Platform</a>
            <a href="securaa-playbook-high-level-design.html">Playbook</a>
            <a href="securaa-siem-high-level-design.html">SIEM</a>
            <a href="securaa-user-high-level-design.html">User Service</a>
            <a href="securaa-custom-services-high-level-design.html">Custom Services</a>
            <a href="sia-service-high-level-design.html">SIA Service</a>
            <a href="securaa-ris-high-level-design.html">RIS</a>
        </div>
    </nav>

    <main class="main-content">
        <h1 id="low-level-design-low-level-design-securaa-custom-services">Low-Level Design (Low Level Design) - Securaa Custom Services</h1>
<h2 id="1-implementation-overview">1. Implementation Overview</h2>
<h3 id="11-technology-stack">1.1 Technology Stack</h3>
<ul>
<li><strong>Language</strong>: Go 1.17</li>
<li><strong>Web Framework</strong>: Gorilla Mux</li>
<li><strong>Database</strong>: MongoDB with official Go driver</li>
<li><strong>Cache</strong>: Redis</li>
<li><strong>Authentication</strong>: JWT tokens with SAML integration</li>
<li><strong>Encryption</strong>: AES encryption for sensitive data</li>
<li><strong>Containerization</strong>: Docker</li>
<li><strong>Build System</strong>: Make with custom Makefile</li>
</ul>
<h3 id="12-project-structure-analysis">1.2 Project Structure Analysis</h3>
<div class="highlight"><pre><span></span><code><span class="n">zona_custom</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">go</span><span class="w">                 </span><span class="c1"># Application entry point</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app</span><span class="o">.</span><span class="n">go</span><span class="w">                  </span><span class="c1"># Application initialization and routing</span>
<span class="err">├──</span><span class="w"> </span><span class="n">go</span><span class="o">.</span><span class="n">mod</span><span class="w">                  </span><span class="c1"># Go module dependencies</span>
<span class="err">├──</span><span class="w"> </span><span class="n">Dockerfile</span><span class="w">             </span><span class="c1"># Container configuration</span>
<span class="err">├──</span><span class="w"> </span><span class="n">Makefile</span><span class="w">              </span><span class="c1"># Build automation</span>
<span class="err">├──</span><span class="w"> </span><span class="n">constants</span><span class="o">/</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">constants</span><span class="o">.</span><span class="n">go</span><span class="w">       </span><span class="c1"># Application constants</span>
<span class="err">├──</span><span class="w"> </span><span class="n">controllers</span><span class="o">/</span><span class="w">           </span><span class="c1"># HTTP request handlers</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">customAppController</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">genericAppController</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">exportController</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">integrationController</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">eventsController</span><span class="o">.</span><span class="n">go</span>
<span class="err">├──</span><span class="w"> </span><span class="n">handlers</span><span class="o">/</span><span class="w">              </span><span class="c1"># Error handling</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">errorHandler</span><span class="o">.</span><span class="n">go</span>
<span class="err">├──</span><span class="w"> </span><span class="n">models</span><span class="o">/</span><span class="w">                </span><span class="c1"># Data structures</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Response</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="k">export</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">process</span><span class="o">.</span><span class="n">go</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">customtaskhandler</span><span class="o">.</span><span class="n">go</span>
<span class="err">└──</span><span class="w"> </span><span class="n">services</span><span class="o">/</span><span class="w">              </span><span class="c1"># Business logic</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">exportservice</span><span class="o">.</span><span class="n">go</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">importservice</span><span class="o">.</span><span class="n">go</span>
<span class="w">    </span><span class="err">├──</span><span class="w"> </span><span class="n">integrationservice</span><span class="o">.</span><span class="n">go</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">eventsService</span><span class="o">.</span><span class="n">go</span>
</code></pre></div>

<h2 id="2-detailed-component-design">2. Detailed Component Design</h2>
<h3 id="21-application-bootstrap-maingo-appgo">2.1 Application Bootstrap (<code>main.go</code> &amp; <code>app.go</code>)</h3>
<h4 id="211-main-function-flow">2.1.1 Main Function Flow</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">Init</span><span class="p">(</span><span class="s">&quot;CORE_SERVICE_LOGS&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Initialize logging</span>
<span class="w">    </span><span class="nx">app</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">App</span><span class="p">{}</span><span class="w">                          </span><span class="c1">// Create app instance</span>
<span class="w">    </span><span class="nx">app</span><span class="p">.</span><span class="nx">Initialize</span><span class="p">()</span><span class="w">                      </span><span class="c1">// Setup dependencies</span>
<span class="w">    </span><span class="nx">app</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="s">&quot;:8063&quot;</span><span class="p">)</span><span class="w">                     </span><span class="c1">// Start HTTP server</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="212-app-structure-design">2.1.2 App Structure Design</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Router</span><span class="w">             </span><span class="o">*</span><span class="nx">mux</span><span class="p">.</span><span class="nx">Router</span><span class="w">                    </span><span class="c1">// HTTP router</span>
<span class="w">    </span><span class="nx">AccessTokenHashMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int64</span><span class="w">               </span><span class="c1">// Token cache</span>
<span class="w">    </span><span class="nx">DBSession</span><span class="w">          </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="w"> </span><span class="c1">// DB connections</span>
<span class="w">    </span><span class="nx">ConfigObject</span><span class="w">       </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="w">           </span><span class="c1">// Configuration</span>
<span class="w">    </span><span class="nx">BuildType</span><span class="w">          </span><span class="kt">string</span><span class="w">                        </span><span class="c1">// Deployment type</span>
<span class="w">    </span><span class="nx">RequestResponseLog</span><span class="w"> </span><span class="kt">bool</span><span class="w">                          </span><span class="c1">// Logging flag</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="213-initialization-sequence">2.1.3 Initialization Sequence</h4>
<div class="mermaid">
sequenceDiagram
    participant Main
    participant App
    participant Config
    participant MongoDB
    participant Router
    participant Cache

    Main->>App: Initialize()
    App->>Config: InitConfig()
    Config-->>App: Configuration loaded
    App->>MongoDB: InitMongoClient()
    MongoDB-->>App: Database connections established
    App->>Router: initializeRoutes()
    Router-->>App: Routes configured
    App->>Cache: CacheHealthCheck()
    Cache-->>App: Cache initialized
    App-->>Main: Initialization complete
    Main->>App: Run(":8063")
    App->>Router: http.ListenAndServe()
</div>

<h3 id="22-database-connection-management">2.2 Database Connection Management</h3>
<h4 id="221-multi-tenant-connection-strategy">2.2.1 Multi-Tenant Connection Strategy</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">InitMongoClient</span><span class="p">(</span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Initialize core database connection</span>
<span class="w">    </span><span class="nx">mongoDbClient</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">NewMongoClientWrapper</span><span class="p">(</span><span class="nx">configObject</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="w">    </span><span class="nx">clientStruct</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">{</span>
<span class="w">        </span><span class="nx">DBName</span><span class="p">:</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;mongoDB&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="nx">Client</span><span class="p">:</span><span class="w"> </span><span class="nx">mongoDbClient</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">[</span><span class="s">&quot;localhost&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">clientStruct</span>

<span class="w">    </span><span class="c1">// Initialize tenant-specific connections</span>
<span class="w">    </span><span class="nx">tenantsList</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">GetAllTenants2</span><span class="p">(</span><span class="nx">mongoDbClient</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">tenantsList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">BuildType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mssp&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">tenantData</span><span class="p">.</span><span class="nx">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// MSSP: Each tenant has separate database</span>
<span class="w">            </span><span class="nx">tenantDBClient</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">NewMongoClientWrapper</span><span class="p">(</span><span class="nx">configObject</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantData</span><span class="p">)</span>
<span class="w">            </span><span class="nx">clientStruct</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">{</span>
<span class="w">                </span><span class="nx">DBName</span><span class="p">:</span><span class="w"> </span><span class="nx">tenantDBClient</span><span class="p">.</span><span class="nx">DBName</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Client</span><span class="p">:</span><span class="w"> </span><span class="nx">tenantDBClient</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">clientStruct</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Single tenant: Shared database with tenant isolation</span>
<span class="w">            </span><span class="c1">// Implementation for single-tenant architecture</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="222-connection-pool-management">2.2.2 Connection Pool Management</h4>
<div class="mermaid">
graph TB
    subgraph "Connection Pool Strategy"
        MAIN_POOL[Main Connection Pool<br/>localhost]
        TENANT1_POOL[Tenant 1 Pool<br/>tenant-1-db]
        TENANT2_POOL[Tenant 2 Pool<br/>tenant-2-db]
        TENANT_N_POOL[Tenant N Pool<br/>tenant-n-db]
    end

    subgraph "Pool Configuration"
        MIN_CONN[Min Connections: 5]
        MAX_CONN[Max Connections: 100]
        IDLE_TIMEOUT[Idle Timeout: 10m]
        CONN_TIMEOUT[Connection Timeout: 30s]
    end

    MAIN_POOL --> MIN_CONN
    TENANT1_POOL --> MAX_CONN
    TENANT2_POOL --> IDLE_TIMEOUT
    TENANT_N_POOL --> CONN_TIMEOUT
</div>

<h3 id="23-middleware-implementation">2.3 Middleware Implementation</h3>
<h4 id="231-logging-middleware">2.3.1 Logging Middleware</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">middleWareData</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">MiddleWareData</span><span class="p">{</span>
<span class="w">            </span><span class="nx">LogRequestResponse</span><span class="p">:</span><span class="w">   </span><span class="nx">a</span><span class="p">.</span><span class="nx">RequestResponseLog</span><span class="p">,</span>
<span class="w">            </span><span class="nx">DBSession</span><span class="p">:</span><span class="w">          </span><span class="nx">a</span><span class="p">.</span><span class="nx">DBSession</span><span class="p">,</span>
<span class="w">            </span><span class="nx">ConfigObject</span><span class="p">:</span><span class="w">       </span><span class="nx">a</span><span class="p">.</span><span class="nx">ConfigObject</span><span class="p">,</span>
<span class="w">            </span><span class="nx">AccessTokenHashMap</span><span class="p">:</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">common</span><span class="p">.</span><span class="nx">MiddleWareForMongoDriver</span><span class="p">(</span><span class="nx">next</span><span class="p">,</span><span class="w"> </span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="nx">constants</span><span class="p">.</span><span class="nx">SkipRoutes</span><span class="p">,</span><span class="w"> </span><span class="nx">constants</span><span class="p">.</span><span class="nx">SkipURI</span><span class="p">,</span><span class="w"> </span><span class="nx">middleWareData</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error in Middleware : &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">            </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">common</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error in creating Tenant Session&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="232-middleware-processing-flow">2.3.2 Middleware Processing Flow</h4>
<div class="mermaid">
flowchart TD
    A[HTTP Request] --> B[Logging Middleware]
    B --> C{Skip Routes Check}
    C -->|Skip| D[Direct Route]
    C -->|Process| E[Token Validation]
    E --> F{Valid Token?}
    F -->|No| G[Return 401]
    F -->|Yes| H[Tenant Resolution]
    H --> I{Tenant Valid?}
    I -->|No| J[Return 403]
    I -->|Yes| K[Session Creation]
    K --> L[Request Logging]
    L --> M[Forward to Controller]
    M --> N[Response Logging]
    N --> O[HTTP Response]

    G --> O
    J --> O
    D --> O
</div>

<h3 id="24-controller-layer-implementation">2.4 Controller Layer Implementation</h3>
<h4 id="241-custom-app-controller">2.4.1 Custom App Controller</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">CustomAppController</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">gc</span><span class="w"> </span><span class="nx">CustomAppController</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteApp</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">deleteAppRequest</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">DeleteApp</span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// Step 1: Decode request</span>
<span class="w">    </span><span class="nx">decoder</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">decoder</span><span class="p">.</span><span class="nx">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">deleteAppRequest</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error in Reading Request&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Step 2: Get database client</span>
<span class="w">    </span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">[</span><span class="nx">deleteAppRequest</span><span class="p">.</span><span class="nx">TenantCode</span><span class="p">].</span><span class="nx">Client</span>

<span class="w">    </span><span class="c1">// Step 3: Business logic execution</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">deleteAppRequest</span><span class="p">.</span><span class="nx">UpdateTasksStatus</span><span class="p">(</span><span class="nx">mongoDBClient</span><span class="p">,</span><span class="w"> </span><span class="nx">configObject</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="nx">handlers</span><span class="p">.</span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error in updating task status&quot;</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Step 4: Update database</span>
<span class="w">    </span><span class="nx">colQuerier</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;integration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">deleteAppRequest</span><span class="p">.</span><span class="nx">IntegrationID</span><span class="p">}</span>
<span class="w">    </span><span class="nx">change</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$set&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;deleted&quot;</span><span class="p">}}</span>
<span class="w">    </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;mongoIntegartionCollection&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">UpdateSingleDocument</span><span class="p">(</span><span class="nx">colQuerier</span><span class="p">,</span><span class="w"> </span><span class="nx">change</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Step 5: Cache invalidation</span>
<span class="w">    </span><span class="nx">RemoveAppListingCache</span><span class="p">(</span><span class="nx">deleteAppRequest</span><span class="p">.</span><span class="nx">TenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="nx">RemoveActiveInstanceCache</span><span class="p">(</span><span class="nx">deleteAppRequest</span><span class="p">.</span><span class="nx">TenantCode</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Step 6: Response</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;App Deleted&quot;</span>
<span class="w">    </span><span class="nx">utils</span><span class="p">.</span><span class="nx">RespondWithJSON</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="242-generic-app-controller-upsertgenericapp">2.4.2 Generic App Controller - UpsertGenericApp</h4>
<div class="mermaid">
flowchart TD
    A[UpsertGenericApp Request] --> B[Parse Multipart Form]
    B --> C{Logo File Present?}
    C -->|Yes| D[Process Logo Upload]
    C -->|No| E[Use Default Logo]
    D --> F[Parse Form Fields]
    E --> F
    F --> G[Decrypt Credentials]
    G --> H{Integration ID = 0?}
    H -->|Yes| I[Create New Integration]
    H -->|No| J[Update Existing Integration]

    I --> K[Check Name Availability]
    K --> L{Name Available?}
    L -->|No| M[Return Error]
    L -->|Yes| N[Generate Integration ID]
    N --> O[Insert Database]

    J --> P[Update Active Instances]
    P --> Q[Update Integration Data]
    Q --> R{Logo Updated?}
    R -->|Yes| S[Update Task Logos]
    R -->|No| T[Skip Logo Update]
    S --> T

    O --> U{Add Instance?}
    T --> U
    U -->|No| V[Cache Invalidation]
    U -->|Yes| W[Check Trial Limits]
    W --> X{Limit Exceeded?}
    X -->|Yes| Y[Return Limit Error]
    X -->|No| Z[Create Active Instance]
    Z --> AA[Update Trial Count]
    AA --> V
    V --> BB[Return Success]

    M --> BB
    Y --> BB
</div>

<h3 id="25-service-layer-implementation">2.5 Service Layer Implementation</h3>
<h4 id="251-export-service-architecture">2.5.1 Export Service Architecture</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">ExportIntegration</span><span class="p">(</span><span class="nx">dbSession</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">common</span><span class="p">.</span><span class="nx">SessionStruct</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Config</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ExportAppInputStruct</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">integrations</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">ExportObject</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">apps</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">AppData</span>

<span class="w">    </span><span class="nx">tenantCode</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Tenantcode</span>
<span class="w">    </span><span class="nx">mongoDBClient</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dbSession</span><span class="p">[</span><span class="nx">tenantCode</span><span class="p">].</span><span class="nx">Client</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">eachIntegrationID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">IntegrationIds</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">integrationObj</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">AppData</span>

<span class="w">        </span><span class="c1">// Step 1: Fetch integration data</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">appObj</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">GenericIntegrationObject</span>
<span class="w">        </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;mongoIntegartionCollection&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">FindSingleDocument</span><span class="p">(</span>
<span class="w">            </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;integration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">eachIntegrationID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="p">},</span><span class="w"> </span>
<span class="w">            </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">appObj</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 2: Sanitize sensitive data</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">updatedFields</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">Field</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">eachfield</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">appObj</span><span class="p">.</span><span class="nx">Fields</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">eachfield</span><span class="p">.</span><span class="nx">Value</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1">// Remove sensitive values</span>
<span class="w">            </span><span class="nx">updatedFields</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">updatedFields</span><span class="p">,</span><span class="w"> </span><span class="nx">eachfield</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Step 3: Fetch related tasks</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">tasksResponse</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">TaskData</span>
<span class="w">        </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;taskCollection&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">mongoDBClient</span><span class="p">.</span><span class="nx">FindMultipleDocuments</span><span class="p">(</span>
<span class="w">            </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;integration_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">integrationID</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&quot;$in&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">status</span><span class="p">}},</span><span class="w"> </span>
<span class="w">            </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">tasksResponse</span><span class="p">)</span>

<span class="w">        </span><span class="c1">// Step 4: Process tasks and dependencies</span>
<span class="w">        </span><span class="nx">altTasksResponse</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">processTasks</span><span class="p">(</span><span class="nx">tasksResponse</span><span class="p">)</span>

<span class="w">        </span><span class="nx">integrationObj</span><span class="p">.</span><span class="nx">App</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">appObj</span>
<span class="w">        </span><span class="nx">integrationObj</span><span class="p">.</span><span class="nx">Tasks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">altTasksResponse</span>
<span class="w">        </span><span class="nx">apps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">apps</span><span class="p">,</span><span class="w"> </span><span class="nx">integrationObj</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">integrations</span><span class="p">.</span><span class="nx">Apps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">apps</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">Data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">integrations</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="252-task-dependency-mapping">2.5.2 Task Dependency Mapping</h4>
<div class="mermaid">
graph TB
    subgraph "Task Processing Pipeline"
        A[Fetch Tasks] --> B[Build Task Name Map]
        B --> C[Process Non-Ingestion Tasks]
        B --> D[Process Case Ingestion Tasks]

        C --> E[Sanitize Task Data]
        D --> F[Map Dependent Tasks]
        D --> G[Map Events API Tasks]

        E --> H[Replace Task IDs with Names]
        F --> H
        G --> H

        H --> I[Generate Export Object]
    end

    subgraph "Dependency Resolution"
        J[Task ID] --> K[Task Name Lookup]
        K --> L[Replace in Config JSON]
        L --> M[Update Dependencies]
    end

    subgraph "Data Sanitization"
        N[Remove Sensitive Data]
        O[Reset IDs to 0]
        P[Clear Tenant Info]
        Q[Clear Task Handlers]
    end

    E --> N
    E --> O
    E --> P
    E --> Q
</div>

<h3 id="26-data-models-implementation">2.6 Data Models Implementation</h3>
<h4 id="261-core-data-structures">2.6.1 Core Data Structures</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Response model - Standard API response</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Success</span><span class="w">        </span><span class="kt">bool</span><span class="w">        </span><span class="s">`json:&quot;success&quot;`</span>
<span class="w">    </span><span class="nx">Data</span><span class="w">           </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;data,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Error</span><span class="w">          </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;error,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Time</span><span class="w">           </span><span class="kt">int64</span><span class="w">       </span><span class="s">`json:&quot;time,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">DisplayMessage</span><span class="w"> </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;displaymessage,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">         </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;status,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">ErrorPath</span><span class="w">      </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;errorpath,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">SessionExpired</span><span class="w"> </span><span class="kt">bool</span><span class="w">        </span><span class="s">`json:&quot;sessionexpired,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">FileName</span><span class="w">       </span><span class="kt">string</span><span class="w">      </span><span class="s">`json:&quot;filename,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Field</span><span class="w">          </span><span class="p">[]</span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;field,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Count</span><span class="w">          </span><span class="kt">int</span><span class="w">         </span><span class="s">`json:&quot;count,omitempty&quot;`</span>
<span class="p">}</span>

<span class="c1">// GenericIntegrationObject - Integration data structure</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">GenericIntegrationObject</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">IntegrationID</span><span class="w"> </span><span class="kt">int</span><span class="w">           </span><span class="s">`json:&quot;integration_id&quot; bson:&quot;integration_id&quot;`</span>
<span class="w">    </span><span class="nx">Title</span><span class="w">         </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;title&quot; bson:&quot;title&quot;`</span>
<span class="w">    </span><span class="nx">Description</span><span class="w">   </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;description&quot; bson:&quot;description&quot;`</span>
<span class="w">    </span><span class="nx">Version</span><span class="w">       </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;version&quot; bson:&quot;version&quot;`</span>
<span class="w">    </span><span class="nx">Category</span><span class="w">      </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;category&quot; bson:&quot;category&quot;`</span>
<span class="w">    </span><span class="nx">TenantCode</span><span class="w">    </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;tenant_code&quot; bson:&quot;tenant_code&quot;`</span>
<span class="w">    </span><span class="nx">Fields</span><span class="w">        </span><span class="p">[]</span><span class="nx">Field</span><span class="w">       </span><span class="s">`json:&quot;fields&quot; bson:&quot;fields&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">        </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">Logo</span><span class="w">          </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;logo&quot; bson:&quot;logo&quot;`</span>
<span class="w">    </span><span class="nx">GenericApp</span><span class="w">    </span><span class="kt">bool</span><span class="w">          </span><span class="s">`json:&quot;generic_app&quot; bson:&quot;generic_app&quot;`</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">        </span><span class="kt">int</span><span class="w">           </span><span class="s">`json:&quot;user_id&quot; bson:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">AddInstance</span><span class="w">   </span><span class="kt">bool</span><span class="w">          </span><span class="s">`json:&quot;add_instance&quot; bson:&quot;add_instance&quot;`</span>
<span class="p">}</span>

<span class="c1">// TaskData - Task information structure</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">TaskData</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">                  </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;id&quot; bson:&quot;id&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">                </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot; bson:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">TasksTag</span><span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;tasks_tag&quot; bson:&quot;tasks_tag&quot;`</span>
<span class="w">    </span><span class="nx">TaskHandler</span><span class="w">         </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;task_handler&quot; bson:&quot;task_handler&quot;`</span>
<span class="w">    </span><span class="nx">IntegrationID</span><span class="w">       </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;integration_id&quot; bson:&quot;integration_id&quot;`</span>
<span class="w">    </span><span class="nx">Fields</span><span class="w">              </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;fields&quot; bson:&quot;fields&quot;`</span>
<span class="w">    </span><span class="nx">Status</span><span class="w">              </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;status&quot; bson:&quot;status&quot;`</span>
<span class="w">    </span><span class="nx">Tenantcode</span><span class="w">          </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;tenantcode&quot; bson:&quot;tenantcode&quot;`</span>
<span class="w">    </span><span class="nx">IngestCases</span><span class="w">         </span><span class="kt">bool</span><span class="w">   </span><span class="s">`json:&quot;ingest_cases&quot; bson:&quot;ingest_cases&quot;`</span>
<span class="w">    </span><span class="nx">CaseIngestionConfig</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;case_ingestion_config&quot; bson:&quot;case_ingestion_config&quot;`</span>
<span class="w">    </span><span class="nx">EventsAPIConfig</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;events_api_config&quot; bson:&quot;events_api_config&quot;`</span>
<span class="w">    </span><span class="nx">LogoPath</span><span class="w">            </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;logo_path&quot; bson:&quot;logo_path&quot;`</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="262-data-validation-transformation">2.6.2 Data Validation &amp; Transformation</h4>
<div class="mermaid">
flowchart LR
    subgraph "Input Validation"
        A[Raw Input] --> B[JSON Decode]
        B --> C[Structure Validation]
        C --> D[Business Rules Check]
        D --> E[Sanitization]
    end

    subgraph "Data Transformation"
        F[Database Model] --> G[Field Encryption]
        G --> H[Tenant Mapping]
        H --> I[Timestamp Addition]
        I --> J[ID Generation]
    end

    subgraph "Output Serialization"
        K[Internal Model] --> L[Response Model]
        L --> M[JSON Encode]
        M --> N[HTTP Response]
    end

    E --> F
    J --> K
</div>

<h3 id="27-error-handling-strategy">2.7 Error Handling Strategy</h3>
<h4 id="271-error-handler-implementation">2.7.1 Error Handler Implementation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">HandleError</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Response</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Success</span><span class="p">:</span><span class="w">        </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Error</span><span class="p">:</span><span class="w">          </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">DisplayMessage</span><span class="p">:</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Time</span><span class="p">:</span><span class="w">           </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Log error details</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Error: %s, Message: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="272-error-flow-hierarchy">2.7.2 Error Flow Hierarchy</h4>
<div class="mermaid">
graph TB
    A[Request Processing] --> B{Validation Error?}
    B -->|Yes| C[Return 400 Bad Request]
    B -->|No| D[Business Logic]

    D --> E{Database Error?}
    E -->|Yes| F[Log Error]
    F --> G[Return 500 Internal Server Error]
    E -->|No| H[Processing Success]

    D --> I{Business Logic Error?}
    I -->|Yes| J[Log Warning]
    J --> K[Return 200 with Error Flag]
    I -->|No| H

    H --> L[Return 200 Success]

    subgraph "Error Types"
        M[Validation Errors]
        N[Database Errors]
        O[Business Logic Errors]
        P[System Errors]
    end

    C --> M
    G --> N
    K --> O
    G --> P
</div>

<h3 id="28-authentication-authorization">2.8 Authentication &amp; Authorization</h3>
<h4 id="281-token-management">2.8.1 Token Management</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">AccessTokenHashMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int64</span><span class="w">  </span><span class="c1">// Token -&gt; Expiry mapping</span>
<span class="w">    </span><span class="c1">// ... other fields</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateUserSessionExpiryTime</span><span class="p">(</span><span class="nx">accessToken</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">expiryTime</span><span class="w"> </span><span class="kt">int64</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">a</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span><span class="p">[</span><span class="nx">accessToken</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">expiryTime</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="w"> </span><span class="o">*</span><span class="nx">App</span><span class="p">)</span><span class="w"> </span><span class="nx">ValidateToken</span><span class="p">(</span><span class="nx">token</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">expiryTime</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">AccessTokenHashMap</span><span class="p">[</span><span class="nx">token</span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">currentTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">currentTime</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">expiryTime</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="282-security-flow">2.8.2 Security Flow</h4>
<div class="mermaid">
sequenceDiagram
    participant Client
    participant Middleware
    participant TokenStore
    participant Database
    participant Controller

    Client->>Middleware: Request with Token
    Middleware->>TokenStore: Validate Token
    TokenStore-->>Middleware: Token Valid/Invalid

    alt Token Invalid
        Middleware-->>Client: 401 Unauthorized
    else Token Valid
        Middleware->>Database: Get Tenant Info
        Database-->>Middleware: Tenant Details
        Middleware->>Controller: Forward Request
        Controller-->>Middleware: Process Response
        Middleware-->>Client: Success Response
    end
</div>

<h3 id="29-caching-strategy">2.9 Caching Strategy</h3>
<h4 id="291-cache-implementation">2.9.1 Cache Implementation</h4>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">RemoveAppListingCache</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;app_listing_%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">RemoveActiveInstanceCache</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;active_instances_%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">GetAppListingFromCache</span><span class="p">(</span><span class="nx">tenantCode</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">models</span><span class="p">.</span><span class="nx">AppData</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">cacheKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;app_listing_%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantCode</span><span class="p">)</span>
<span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">cacheKey</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">apps</span><span class="w"> </span><span class="p">[]</span><span class="nx">models</span><span class="p">.</span><span class="nx">AppData</span>
<span class="w">        </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">apps</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">apps</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="292-cache-invalidation-strategy">2.9.2 Cache Invalidation Strategy</h4>
<div class="mermaid">
graph TB
    subgraph "Cache Operations"
        A[Create/Update Operation] --> B[Invalidate Related Cache]
        C[Delete Operation] --> D[Invalidate Related Cache]
        E[Read Operation] --> F{Cache Hit?}
        F -->|Yes| G[Return Cached Data]
        F -->|No| H[Fetch from DB]
        H --> I[Store in Cache]
        I --> J[Return Data]
    end

    subgraph "Cache Keys"
        K[app_listing_{tenant}]
        L[active_instances_{tenant}]
        M[integration_list_{tenant}]
    end

    B --> K
    B --> L
    D --> K
    D --> L
</div>

<h3 id="210-configuration-management">2.10 Configuration Management</h3>
<h4 id="2101-configuration-structure">2.10.1 Configuration Structure</h4>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ConfigStruct</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ConfigFilePath</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">ConfigData</span><span class="w">     </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">InitConfig</span><span class="p">()</span><span class="w"> </span><span class="nx">ConfigStruct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">config</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">ConfigStruct</span><span class="p">{</span>
<span class="w">        </span><span class="nx">ConfigFilePath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/opt/securaa/conf/securaa.conf&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ConfigData</span><span class="p">:</span><span class="w">     </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Load configuration from file</span>
<span class="w">    </span><span class="nx">configData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ReadConfig</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Failed to load configuration: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">configData</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">config</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2102-configuration-flow">2.10.2 Configuration Flow</h4>
<div class="mermaid">
flowchart TD
    A[Application Start] --> B[Load Config File]
    B --> C[Parse Configuration]
    C --> D[Validate Required Keys]
    D --> E{Validation OK?}
    E -->|No| F[Exit with Error]
    E -->|Yes| G[Store in ConfigObject]
    G --> H[Pass to Components]

    subgraph "Config Categories"
        I[Database Settings]
        J[Cache Settings]
        K[Security Settings]
        L[Logging Settings]
        M[Business Logic Settings]
    end

    H --> I
    H --> J
    H --> K
    H --> L
    H --> M
</div>

<h3 id="211-database-operations">2.11 Database Operations</h3>
<h4 id="2111-crud-operations-pattern">2.11.1 CRUD Operations Pattern</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Generic database operation wrapper</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">DatabaseOperations</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Client</span><span class="w">         </span><span class="nx">mongo_driver</span><span class="p">.</span><span class="nx">MongoClientWrapper</span>
<span class="w">    </span><span class="nx">CollectionName</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseOperations</span><span class="p">)</span><span class="w"> </span><span class="nx">Create</span><span class="p">(</span><span class="nx">document</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">CollectionName</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">InsertSingleDocument</span><span class="p">(</span><span class="nx">document</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseOperations</span><span class="p">)</span><span class="w"> </span><span class="nx">Read</span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">CollectionName</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">FindSingleDocument</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseOperations</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">CollectionName</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">UpdateSingleDocument</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">DatabaseOperations</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">filter</span><span class="w"> </span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">CollectionName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">CollectionName</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Client</span><span class="p">.</span><span class="nx">DeleteSingleDocument</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2112-transaction-management">2.11.2 Transaction Management</h4>
<div class="mermaid">
sequenceDiagram
    participant Service
    participant DBClient
    participant MongoDB

    Service->>DBClient: Start Transaction
    DBClient->>MongoDB: Begin Transaction

    loop Database Operations
        Service->>DBClient: Execute Operation
        DBClient->>MongoDB: Execute Query
        MongoDB-->>DBClient: Operation Result
        DBClient-->>Service: Result
    end

    alt All Operations Successful
        Service->>DBClient: Commit Transaction
        DBClient->>MongoDB: Commit
        MongoDB-->>DBClient: Success
        DBClient-->>Service: Transaction Complete
    else Any Operation Failed
        Service->>DBClient: Rollback Transaction
        DBClient->>MongoDB: Rollback
        MongoDB-->>DBClient: Rollback Complete
        DBClient-->>Service: Transaction Rolled Back
    end
</div>

<h3 id="212-logging-implementation">2.12 Logging Implementation</h3>
<h4 id="2121-structured-logging">2.12.1 Structured Logging</h4>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">logger</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">securaalog</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;zona_custom&quot;</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">LogRequest</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Request received&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;method&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;url&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span>
<span class="w">        </span><span class="s">&quot;remote_addr&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">RemoteAddr</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;user_agent&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">UserAgent</span><span class="p">(),</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">LogError</span><span class="p">(</span><span class="nx">operation</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="s">&quot;Operation failed&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;operation&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">        </span><span class="s">&quot;context&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">LogPerformance</span><span class="p">(</span><span class="nx">operation</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;Operation completed&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;operation&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;duration_ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="p">.</span><span class="nx">Milliseconds</span><span class="p">(),</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="2122-log-levels-categories">2.12.2 Log Levels &amp; Categories</h4>
<div class="mermaid">
graph TB
    subgraph "Log Levels"
        A[DEBUG - Development Info]
        B[INFO - General Information]
        C[WARN - Warning Conditions]
        D[ERROR - Error Conditions]
        E[FATAL - Critical Errors]
    end

    subgraph "Log Categories"
        F[REQUEST_RESPONSE - HTTP Traffic]
        G[DATABASE - DB Operations]
        H[BUSINESS_LOGIC - Application Logic]
        I[SECURITY - Auth/Authorization]
        J[PERFORMANCE - Performance Metrics]
    end

    subgraph "Log Destinations"
        K[Console Output]
        L[File System]
        M[Centralized Logging]
        N[Monitoring Systems]
    end

    A --> F
    B --> G
    C --> H
    D --> I
    E --> J

    F --> K
    G --> L
    H --> M
    I --> N
</div>

<h2 id="3-performance-considerations">3. Performance Considerations</h2>
<h3 id="31-optimization-strategies">3.1 Optimization Strategies</h3>
<h4 id="311-database-query-optimization">3.1.1 Database Query Optimization</h4>
<ul>
<li>Use appropriate indexes on frequently queried fields</li>
<li>Implement query result caching for read-heavy operations</li>
<li>Use batch operations for bulk data manipulation</li>
<li>Implement connection pooling for database efficiency</li>
</ul>
<h4 id="312-memory-management">3.1.2 Memory Management</h4>
<ul>
<li>Implement proper cleanup of temporary objects</li>
<li>Use connection pooling to avoid resource leaks</li>
<li>Monitor goroutine lifecycle for concurrent operations</li>
<li>Implement request timeout mechanisms</li>
</ul>
<h4 id="313-network-optimization">3.1.3 Network Optimization</h4>
<ul>
<li>Compress HTTP responses for large payloads</li>
<li>Implement request/response caching</li>
<li>Use HTTP/2 where supported</li>
<li>Minimize JSON payload sizes</li>
</ul>
<h3 id="32-scalability-considerations">3.2 Scalability Considerations</h3>
<div class="mermaid">
graph LR
    subgraph "Horizontal Scaling"
        A[Load Balancer] --> B[Instance 1]
        A --> C[Instance 2]
        A --> D[Instance N]
    end

    subgraph "Vertical Scaling"
        E[CPU Scaling]
        F[Memory Scaling]
        G[Storage Scaling]
    end

    subgraph "Database Scaling"
        H[Read Replicas]
        I[Sharding]
        J[Connection Pooling]
    end

    B --> H
    C --> I
    D --> J
</div>

<h2 id="4-testing-strategy">4. Testing Strategy</h2>
<h3 id="41-unit-testing-structure">4.1 Unit Testing Structure</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">TestDeleteApp</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="nx">controller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewCustomAppController</span><span class="p">()</span>
<span class="w">    </span><span class="nx">mockDBSession</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">createMockDBSession</span><span class="p">()</span>
<span class="w">    </span><span class="nx">mockConfig</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">createMockConfig</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="nx">response</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">DeleteApp</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">createMockRequest</span><span class="p">(),</span><span class="w"> </span><span class="nx">mockDBSession</span><span class="p">,</span><span class="w"> </span><span class="nx">mockConfig</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">True</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">Success</span><span class="p">)</span>
<span class="w">    </span><span class="nx">assert</span><span class="p">.</span><span class="nx">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;App Deleted&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">DisplayMessage</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="42-integration-testing">4.2 Integration Testing</h3>
<div class="mermaid">
flowchart TD
    A[Integration Test Suite] --> B[Database Tests]
    A --> C[API Endpoint Tests]
    A --> D[Cache Integration Tests]
    A --> E[External Service Tests]

    B --> F[CRUD Operations]
    B --> G[Transaction Tests]

    C --> H[Authentication Tests]
    C --> I[Authorization Tests]
    C --> J[Input Validation Tests]

    D --> K[Cache Hit/Miss Tests]
    D --> L[Cache Invalidation Tests]

    E --> M[MongoDB Integration]
    E --> N[Redis Integration]
    E --> O[External API Integration]
</div>

<h2 id="5-security-implementation">5. Security Implementation</h2>
<h3 id="51-data-encryption">5.1 Data Encryption</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">EncryptSensitiveFields</span><span class="p">(</span><span class="nx">fields</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ConfigStruct</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">encryptedFields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
<span class="w">    </span><span class="nx">encryptionKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">config</span><span class="p">[</span><span class="s">&quot;zonaCredentialsEncryptDecryptKey&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">isSensitiveField</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">encryptedValue</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">utils</span><span class="p">.</span><span class="nx">CredentialsEncrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">encryptionKey</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">encryptedFields</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">encryptedValue</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">encryptedFields</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">encryptedFields</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">isSensitiveField</span><span class="p">(</span><span class="nx">fieldName</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sensitiveFields</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;api_key&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;secret&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;token&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">sensitive</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">sensitiveFields</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">ToLower</span><span class="p">(</span><span class="nx">fieldName</span><span class="p">),</span><span class="w"> </span><span class="nx">sensitive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="52-input-sanitization">5.2 Input Sanitization</h3>
<div class="mermaid">
flowchart TD
    A[User Input] --> B[Input Validation]
    B --> C{Valid Format?}
    C -->|No| D[Return Validation Error]
    C -->|Yes| E[SQL Injection Check]
    E --> F{Safe?}
    F -->|No| G[Return Security Error]
    F -->|Yes| H[XSS Prevention]
    H --> I[Sanitized Input]
    I --> J[Business Logic Processing]
</div>

<h2 id="6-deployment-operations">6. Deployment &amp; Operations</h2>
<h3 id="61-build-process">6.1 Build Process</h3>
<div class="highlight"><pre><span></span><code><span class="c"># Build configuration from Makefile</span>
<span class="nf">build</span><span class="o">:</span><span class="w"> </span><span class="n">builddir</span>
<span class="w">    </span><span class="k">$(</span>BUILD_ENV<span class="k">)</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-mod<span class="w"> </span>vendor<span class="w"> </span><span class="k">$(</span>BUILD_FLAGS<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span>build/<span class="k">$(</span>TARGET<span class="k">)</span>

<span class="nf">image_ecr</span><span class="o">:</span><span class="w"> </span><span class="n">builddir</span>
<span class="w">    </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>--pull<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span><span class="k">$(</span>RUNTIME_DOCKER_IMAGE_ECR<span class="k">)</span>:latest<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">TARGET</span><span class="o">=</span><span class="k">$(</span>TARGET<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">GIT_REF</span><span class="o">=</span><span class="k">$(</span>GIT_REF<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--build-arg<span class="w"> </span><span class="nv">BUILD_VERSION</span><span class="o">=</span><span class="k">$(</span>BUILD_VERSION<span class="k">)</span><span class="w"> </span>.
</code></pre></div>

<h3 id="62-health-monitoring">6.2 Health Monitoring</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">HealthCheck</span><span class="p">()</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">health</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">Status</span><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;status&quot;`</span>
<span class="w">            </span><span class="nx">Database</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;database&quot;`</span>
<span class="w">            </span><span class="nx">Cache</span><span class="w">     </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;cache&quot;`</span>
<span class="w">            </span><span class="nx">Version</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;version&quot;`</span>
<span class="w">            </span><span class="nx">Timestamp</span><span class="w"> </span><span class="kt">int64</span><span class="w">  </span><span class="s">`json:&quot;timestamp&quot;`</span>
<span class="w">        </span><span class="p">}{</span>
<span class="w">            </span><span class="nx">Status</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;healthy&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Database</span><span class="p">:</span><span class="w">  </span><span class="nx">checkDatabaseHealth</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">Cache</span><span class="p">:</span><span class="w">     </span><span class="nx">checkCacheHealth</span><span class="p">(),</span>
<span class="w">            </span><span class="nx">Version</span><span class="p">:</span><span class="w">   </span><span class="nx">BuildVersion</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Timestamp</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Unix</span><span class="p">(),</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Content-Type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;application/json&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nx">json</span><span class="p">.</span><span class="nx">NewEncoder</span><span class="p">(</span><span class="nx">w</span><span class="p">).</span><span class="nx">Encode</span><span class="p">(</span><span class="nx">health</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>This comprehensive Low-Level Design document provides detailed implementation specifications for the Securaa Custom Services application, covering all major components, data flows, and architectural decisions at the code level.</p>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Securaa Security Platform. All rights reserved.</p>
        <p>Documentation generated on December 18, 2025</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#818cf8',
                lineColor: '#6b7280',
                secondaryColor: '#f3f4f6',
                tertiaryColor: '#e5e7eb',
                background: '#ffffff',
                mainBkg: '#f9fafb',
                secondBkg: '#f3f4f6',
                border1: '#e5e7eb',
                border2: '#d1d5db',
                fontFamily: 'Inter, sans-serif',
                fontSize: '14px',
                nodeBorder: '#4f46e5',
                clusterBkg: '#f0f4f8',
                clusterBorder: '#818cf8',
                edgeLabelBackground: '#ffffff'
            },
            flowchart: {
                htmlLabels: true,
                useMaxWidth: true,
                curve: 'basis',
                padding: 15,
                nodeSpacing: 50,
                rankSpacing: 50
            },
            sequence: {
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            },
            er: {
                useMaxWidth: true,
                entityPadding: 15,
                fontSize: 12
            },
            class: {
                useMaxWidth: true,
                padding: 10
            },
            gantt: {
                useMaxWidth: true,
                barHeight: 20,
                barGap: 4,
                topPadding: 50,
                leftPadding: 75
            },
            pie: {
                useMaxWidth: true,
                textPosition: 0.5
            },
            mindmap: {
                useMaxWidth: true,
                padding: 10
            },
            securityLevel: 'loose',
            logLevel: 'error'
        });

        // Re-render mermaid diagrams after page load for better sizing
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelectorAll('.mermaid').forEach(function(el) {
                    if (el.getAttribute('data-processed') !== 'true') {
                        mermaid.init(undefined, el);
                    }
                });
            }, 100);
        });
    </script>
</body>
</html>
